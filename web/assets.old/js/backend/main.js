if(function(t){"use strict";var e={},i={},s={touch:!1},n={"menu-parent":[{target:"menu-parent",source:"menu-id",relationship:"parent",action:"match",hidden:!0,limit:8}],"menu-weight":{1:{target:"menu-weight",source:"menu-weight",relationship:"sibling",action:"order",hidden:!0,limit:0}}},r={tableDragChangedMarker:function(){return'<abbr class="warning tabledrag-changed" title="'+i.t("Changed")+'">*</abbr>'},tableDragIndentation:function(){return'<div class="indentation">&nbsp;</div>'},tableDragChangedWarning:function(){return'<div class="tabledrag-changed-warning messages messages--warning" role="alert">'+i.theme("tableDragChangedMarker")+" "+i.t("You have unsaved changes.")+"</div>"}};i.attachBehaviors=function(){},i.detachBehaviors=function(){},i.theme=function(t){return r[t].call()},i.t=function(t){return t};var a=!1;i.tableDrag=function(e,n){var r=this,a=t(e);this.$table=t(e),this.table=e,this.tableSettings=n,this.dragObject=null,this.rowObject=null,this.oldRowElement=null,this.oldY=0,this.changed=!1,this.maxDepth=0,this.rtl="rtl"===t(this.table).css("direction")?-1:1,this.scrollSettings={amount:4,interval:50,trigger:70},this.scrollInterval=null,this.scrollY=0,this.windowHeight=0,this.indentEnabled=!1;for(var o in n)if(n.hasOwnProperty(o))for(var l in n[o])n[o].hasOwnProperty(l)&&("parent"===n[o][l].relationship&&(this.indentEnabled=!0),n[o][l].limit>0&&(this.maxDepth=n[o][l].limit));if(this.indentEnabled){this.indentCount=1;var h=i.theme("tableDragIndentation"),c=t("<tr/>").addClass("draggable").appendTo(e),d=t("<td/>").appendTo(c).prepend(h).prepend(h),p=d.find(".indentation");this.indentAmount=p.get(1).offsetLeft-p.get(0).offsetLeft,c.remove()}a.find("> tr.draggable, > tbody > tr.draggable").each(function(){r.makeDraggable(this)}),r.initColumns(),s.touch?(t(document).on("touchmove",function(t){return r.dragRow(t.originalEvent.touches[0],r)}),t(document).on("touchend",function(t){return r.dropRow(t.originalEvent.touches[0],r)})):(t(document).on("mousemove",function(t){return r.dragRow(t,r)}),t(document).on("mouseup",function(t){return r.dropRow(t,r)}))},i.tableDrag.prototype.initColumns=function(){var t,e,i,s=this.$table;for(var n in this.tableSettings)if(this.tableSettings.hasOwnProperty(n)){for(var r in this.tableSettings[n])if(this.tableSettings[n].hasOwnProperty(r)){var o=s.find("."+this.tableSettings[n][r].target+":first");if(o.length&&this.tableSettings[n][r].hidden){t=this.tableSettings[n][r].hidden,e=o.closest("td");break}}t&&e[0]&&(i=e.parent().find("> td").index(e.get(0))+1,s.find("> thead > tr, > tbody > tr, > tr").each(this.addColspanClass(i)))}this.displayColumns(a)},i.tableDrag.prototype.addColspanClass=function(e){return function(){var i,s=t(this),n=e,r=s.children();r.each(function(t){n>t&&this.colSpan&&this.colSpan>1&&(n-=this.colSpan-1)}),n>0&&(i=r.filter(":nth-child("+n+")"),i[0].colSpan&&i[0].colSpan>1?i.addClass("tabledrag-has-colspan"):i.addClass("tabledrag-hide"))}},i.tableDrag.prototype.displayColumns=function(e){e?this.showColumns():this.hideColumns(),t("table.tabledrag-processed").trigger("columnschange",!!e)},i.tableDrag.prototype.hideColumns=function(){var e=t("table.tabledrag-processed");e.find(".tabledrag-hide").css("display","none"),e.find(".tabledrag-handle").css("display",""),e.find(".tabledrag-has-colspan").each(function(){this.colSpan=this.colSpan-1}),t(".tabledrag-toggle-weight").text(i.t("Show row weights"))},i.tableDrag.prototype.showColumns=function(){var e=t("table.tabledrag-processed");e.find(".tabledrag-hide").css("display",""),e.find(".tabledrag-handle").css("display","none"),e.find(".tabledrag-has-colspan").each(function(){this.colSpan=this.colSpan+1}),t(".tabledrag-toggle-weight").text(i.t("Hide row weights"))},i.tableDrag.prototype.rowSettings=function(e,i){var s=t(i).find("."+e),n=this.tableSettings[e];for(var r in n)if(n.hasOwnProperty(r)){var a=n[r].target;if(s.is("."+a)){var o={};for(var l in n[r])n[r].hasOwnProperty(l)&&(o[l]=n[r][l]);return o}}},i.tableDrag.prototype.makeDraggable=function(e){var n=this,r=t(e);r.find("td:first a").addClass("menu-item__link");var a=t('<a href="#" class="tabledrag-handle"><div class="handle">&nbsp;</div></a>').attr("title",i.t("Drag to re-order")),o=r.find("td:first .indentation:last");o.length?(o.after(a),n.indentCount=Math.max(r.find(".indentation").length,n.indentCount)):r.find("td:first").prepend(a),s.touch?a.on("touchstart",function(t){t.preventDefault(),t=t.originalEvent.touches[0],n.dragStart(t,n,e)}):a.on("mousedown",function(t){t.preventDefault(),n.dragStart(t,n,e)}),a.on("click",function(t){t.preventDefault()}),a.on("focus",function(){n.safeBlur=!0}),a.on("blur",function(t){n.rowObject&&n.safeBlur&&n.dropRow(t,n)}),a.on("keydown",function(i){9===i.keyCode||n.rowObject||(n.rowObject=new n.row(e,"keyboard",n.indentEnabled,n.maxDepth,!0));var s,r=!1;switch(i.keyCode){case 37:case 63234:r=!0,n.rowObject.indent(-1*n.rtl);break;case 38:case 63232:for(var o=t(n.rowObject.element).prev("tr").eq(0),l=o.get(0);l&&o.is(":hidden");)o=t(l).prev("tr").eq(0),l=o.get(0);if(l){if(n.safeBlur=!1,n.rowObject.direction="up",r=!0,t(e).is(".tabledrag-root")){for(s=0;l&&o.find(".indentation").length;)o=t(l).prev("tr").eq(0),l=o.get(0),s+=o.is(":hidden")?0:l.offsetHeight;l&&(n.rowObject.swap("before",l),window.scrollBy(0,-s))}else(n.table.tBodies[0].rows[0]!==l||o.is(".draggable"))&&(n.rowObject.swap("before",l),n.rowObject.interval=null,n.rowObject.indent(0),window.scrollBy(0,-parseInt(e.offsetHeight,10)));a.trigger("focus")}break;case 39:case 63235:r=!0,n.rowObject.indent(n.rtl);break;case 40:case 63233:for(var h=t(n.rowObject.group).filter(":last").next("tr").eq(0),c=h.get(0);c&&h.is(":hidden");)h=t(c).next("tr").eq(0),c=h.get(0);if(c){if(n.safeBlur=!1,n.rowObject.direction="down",r=!0,t(e).is(".tabledrag-root")){s=0;var d=new n.row(c,"keyboard",n.indentEnabled,n.maxDepth,!1);if(d){t(d.group).each(function(){s+=t(this).is(":hidden")?0:this.offsetHeight});var p=t(d.group).filter(":last").get(0);n.rowObject.swap("after",p),window.scrollBy(0,parseInt(s,10))}}else n.rowObject.swap("after",c),n.rowObject.interval=null,n.rowObject.indent(0),window.scrollBy(0,parseInt(e.offsetHeight,10));a.trigger("focus")}}return n.rowObject&&n.rowObject.changed===!0&&(t(e).addClass("drag"),n.oldRowElement&&t(n.oldRowElement).removeClass("drag-previous"),n.oldRowElement=e,n.restripeTable(),n.onDrag()),r?!1:void 0}),a.on("keypress",function(t){switch(t.keyCode){case 37:case 38:case 39:case 40:return!1}})},i.tableDrag.prototype.dragStart=function(e,i,s){i.dragObject={},i.dragObject.initOffset=i.getPointerOffset(s,e),i.dragObject.initPointerCoords=i.pointerCoords(e),i.indentEnabled&&(i.dragObject.indentPointerPos=i.dragObject.initPointerCoords),i.rowObject&&t(i.rowObject.element).find("a.tabledrag-handle").trigger("blur"),i.rowObject=new i.row(s,"pointer",i.indentEnabled,i.maxDepth,!0),i.table.topY=t(i.table).offset().top,i.table.bottomY=i.table.topY+i.table.offsetHeight,t(s).addClass("drag"),t("body").addClass("drag"),i.oldRowElement&&t(i.oldRowElement).removeClass("drag-previous")},i.tableDrag.prototype.dragRow=function(t,e){if(e.dragObject){e.currentPointerCoords=e.pointerCoords(t);var i=e.currentPointerCoords.y-e.dragObject.initOffset.y,s=e.currentPointerCoords.x-e.dragObject.initOffset.x;if(i!==e.oldY){e.rowObject.direction=i>e.oldY?"down":"up",e.oldY=i;var n=e.checkScroll(e.currentPointerCoords.y);clearInterval(e.scrollInterval),(n>0&&"down"===e.rowObject.direction||0>n&&"up"===e.rowObject.direction)&&e.setScroll(n);var r=e.findDropTargetRow(s,i);r&&("down"===e.rowObject.direction?e.rowObject.swap("after",r,e):e.rowObject.swap("before",r,e),e.restripeTable())}if(e.indentEnabled){var a=e.currentPointerCoords.x-e.dragObject.indentPointerPos.x,o=Math.round(a/e.indentAmount*e.rtl),l=e.rowObject.indent(o);e.dragObject.indentPointerPos.x+=e.indentAmount*l*e.rtl,e.indentCount=Math.max(e.indentCount,e.rowObject.indents)}return!1}},i.tableDrag.prototype.dropRow=function(e,s){var n,r;if(null!==s.rowObject){if(n=s.rowObject.element,r=t(n),s.rowObject.changed===!0){s.updateFields(n);for(var a in s.tableSettings)if(s.tableSettings.hasOwnProperty(a)){var o=s.rowSettings(a,n);if("group"===o.relationship)for(var l in s.rowObject.children)s.rowObject.children.hasOwnProperty(l)&&s.updateField(s.rowObject.children[l],a)}s.rowObject.markChanged(),s.changed===!1&&(t(i.theme("tableDragChangedWarning")).insertBefore(s.table).hide().fadeIn("slow"),s.changed=!0)}s.indentEnabled&&s.rowObject.removeIndentClasses(),s.oldRowElement&&t(s.oldRowElement).removeClass("drag-previous"),r.removeClass("drag").addClass("drag-previous"),s.oldRowElement=n,s.onDrop(),s.rowObject=null}null!==s.dragObject&&(s.dragObject=null,t("body").removeClass("drag"),clearInterval(s.scrollInterval))},i.tableDrag.prototype.pointerCoords=function(t){return t.pageX||t.pageY?{x:t.pageX,y:t.pageY}:{x:t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.clientY+document.body.scrollTop-document.body.clientTop}},i.tableDrag.prototype.getPointerOffset=function(e,i){var s=t(e).offset(),n=this.pointerCoords(i);return{x:n.x-s.left,y:n.y-s.top}},i.tableDrag.prototype.findDropTargetRow=function(e,i){for(var s=t(this.table.tBodies[0].rows).not(":hidden"),n=0;n<s.length;n++){var r,a=s[n],o=t(a),l=o.offset().top;if(r=0===a.offsetHeight?parseInt(a.firstChild.offsetHeight,10)/2:parseInt(a.offsetHeight,10)/2,i>l-r&&l+r>i){if(this.indentEnabled){for(n in this.rowObject.group)if(this.rowObject.group[n]===a)return null}else if(a===this.rowObject.element)return null;if(!this.rowObject.isValidSwap(a))return null;for(;o.is(":hidden")&&o.prev("tr").is(":hidden");)o=o.prev("tr").eq(0),a=o.get(0);return a}}return null},i.tableDrag.prototype.updateFields=function(t){for(var e in this.tableSettings)this.tableSettings.hasOwnProperty(e)&&this.updateField(t,e)},i.tableDrag.prototype.updateField=function(e,i){var s,n,r,a,o=this.rowSettings(i,e),l=t(e);if("self"===o.relationship||"group"===o.relationship)s=e;else if("sibling"===o.relationship){n=l.prev("tr").eq(0),r=n.get(0);var h=l.next("tr").eq(0),c=h.get(0);s=e,n.is(".draggable")&&n.find("."+i).length?this.indentEnabled?n.find(".indentations").length===l.find(".indentations").length&&(s=r):s=r:h.is(".draggable")&&h.find("."+i).length&&(this.indentEnabled?h.find(".indentations").length===l.find(".indentations").length&&(s=c):s=c)}else if("parent"===o.relationship){for(n=l.prev("tr"),r=n;n.length&&n.find(".indentation").length>=this.rowObject.indents;)n=n.prev("tr"),r=n;n.length?s=n.get(0):(s=t(this.table).find("tr.draggable:first").get(0),s===this.rowObject.element&&(s=t(this.rowObject.group[this.rowObject.group.length-1]).next("tr.draggable").get(0)),a=!0)}this.copyDragClasses(s,e,i),o=this.rowSettings(i,e),a&&(o.relationship="sibling",o.source=o.target);var d="."+o.target,p=l.find(d).get(0);if(p){var u="."+o.source,f=t(u,s).get(0);switch(o.action){case"depth":p.value=t(f).closest("tr").find(".indentation").length;break;case"match":p.value=f.value;break;case"order":var g=this.rowObject.findSiblings(o);if(t(p).is("select")){var m=[];t(p).find("option").each(function(){m.push(this.value)});var v=m[m.length-1];t(g).find(d).each(function(){m.length>0?this.value=m.shift():this.value=v})}else{var b=parseInt(t(g[0]).find(d).val(),10)||0;t(g).find(d).each(function(){this.value=b,b++})}}}},i.tableDrag.prototype.copyDragClasses=function(e,i,s){var n=t(e).find("."+s),r=t(i).find("."+s);n.length&&r.length&&(r[0].className=n[0].className)},i.tableDrag.prototype.checkScroll=function(t){var e=document.documentElement,i=document.body,s=this.windowHeight=window.innerHeight||(e.clientHeight&&0!==e.clientWidth?e.clientHeight:i.offsetHeight),n=this.scrollY=document.all?e.scrollTop?e.scrollTop:i.scrollTop:window.pageYOffset?window.pageYOffset:window.scrollY,r=this.scrollSettings.trigger,a=0;return t-n>s-r?(a=r/(s+n-t),a=a>0&&r>a?a:r,a*this.scrollSettings.amount):r>t-n?(a=r/(t-n),a=a>0&&r>a?a:r,-a*this.scrollSettings.amount):void 0},i.tableDrag.prototype.setScroll=function(t){var e=this;this.scrollInterval=setInterval(function(){e.checkScroll(e.currentPointerCoords.y);var i=e.scrollY>e.table.topY,s=e.scrollY+e.windowHeight<e.table.bottomY;(t>0&&s||0>t&&i)&&window.scrollBy(0,t)},this.scrollSettings.interval)},i.tableDrag.prototype.restripeTable=function(){t(this.table).find("> tbody > tr.draggable:visible, > tr.draggable:visible").removeClass("odd even").filter(":odd").addClass("even").end().filter(":even").addClass("odd")},i.tableDrag.prototype.onDrag=function(){return console.log("drag",this),null},i.tableDrag.prototype.onDrop=function(){return console.log("drop",this),null},i.tableDrag.prototype.row=function(e,i,s,n,r){var a=t(e);if(this.element=e,this.method=i,this.group=[e],this.groupDepth=a.find(".indentation").length,this.changed=!1,this.table=a.closest("table")[0],this.indentEnabled=s,this.maxDepth=n,this.direction="",this.indentEnabled){this.indents=a.find(".indentation").length,this.children=this.findChildren(r),this.group=t.merge(this.group,this.children);for(var o=0;o<this.group.length;o++)this.groupDepth=Math.max(t(this.group[o]).find(".indentation").length,this.groupDepth)}},i.tableDrag.prototype.row.prototype.findChildren=function(e){function i(e,i){var n=t(e);1===a&&i===s&&n.addClass("tree-child-first"),i===s?n.addClass("tree-child"):i>s&&n.addClass("tree-child-horizontal")}for(var s=this.indents,n=t(this.element,this.table).next("tr.draggable"),r=[],a=0;n.length&&n.find(".indentation").length>s;)a++,r.push(n[0]),e&&n.find(".indentation").each(i),n=n.next("tr.draggable");return e&&r.length&&t(r[r.length-1]).find(".indentation:nth-child("+(s+1)+")").addClass("tree-child-last"),r},i.tableDrag.prototype.row.prototype.isValidSwap=function(e){var i=t(e);if(this.indentEnabled){var s,n;if("down"===this.direction?(s=e,n=i.next("tr").get(0)):(s=i.prev("tr").get(0),n=e),this.interval=this.validIndentInterval(s,n),this.interval.min>this.interval.max)return!1}return this.table.tBodies[0].rows[0]===e&&i.is(":not(.draggable)")?!1:!0},i.tableDrag.prototype.row.prototype.swap=function(s,n){this.group.forEach(function(t){i.detachBehaviors(t,e,"move")}),t(n)[s](this.group),this.group.forEach(function(t){i.attachBehaviors(t,e)}),this.changed=!0,this.onSwap(n)},i.tableDrag.prototype.row.prototype.validIndentInterval=function(e,i){var s,n,r=t(e);return s=i?t(i).find(".indentation").length:0,!e||r.is(":not(.draggable)")||t(this.element).is(".tabledrag-root")?n=0:(n=r.find(".indentation").length+(r.is(".tabledrag-leaf")?0:1),this.maxDepth&&(n=Math.min(n,this.maxDepth-(this.groupDepth-this.indents)))),{min:s,max:n}},i.tableDrag.prototype.row.prototype.indent=function(e){var s=t(this.group);if(!this.interval){var n=t(this.element).prev("tr").get(0),r=s.filter(":last").next("tr").get(0);this.interval=this.validIndentInterval(n,r)}var a=this.indents+e;a=Math.max(a,this.interval.min),a=Math.min(a,this.interval.max),e=a-this.indents;for(var o=1;o<=Math.abs(e);o++)0>e?(s.find(".indentation:first").remove(),this.indents--):(s.find("td:first").prepend(i.theme("tableDragIndentation")),this.indents++);return e&&(this.changed=!0,this.groupDepth+=e,this.onIndent()),e},i.tableDrag.prototype.row.prototype.findSiblings=function(e){for(var i,s=[],n=["prev","next"],r=this.indents,a=0;a<n.length;a++){for(var o=t(this.element)[n[a]]();o.length&&o.find("."+e.target);){if(this.indentEnabled&&(i=o.find(".indentation").length),this.indentEnabled&&i!==r){if(r>i)break}else s.push(o[0]);o=o[n[a]]()}"prev"===n[a]&&(s.reverse(),s.push(this.element))}return s},i.tableDrag.prototype.row.prototype.removeIndentClasses=function(){for(var e in this.children)this.children.hasOwnProperty(e)&&t(this.children[e]).find(".indentation").removeClass("tree-child").removeClass("tree-child-first").removeClass("tree-child-last").removeClass("tree-child-horizontal")},i.tableDrag.prototype.row.prototype.markChanged=function(){var e=i.theme("tableDragChangedMarker"),s=t(this.element).find("td:first");0===s.find("abbr.tabledrag-changed").length&&s.append(e)},i.tableDrag.prototype.row.prototype.onIndent=function(){return console.log("indent",this),null},i.tableDrag.prototype.row.prototype.onSwap=function(t){return console.log("swap",this,t),null},t.fn.tabledrag=function(e){return this.each(function(){console.log(i),t.data(this,"tabledrag")||t.data(this,"tabledrag",new i.tableDrag(this,e))}),this},t("table.tabledrag").each(function(){t(this).tabledrag(n)})}(jQuery),function(t){"use strict";t(document).ready(function(){var e;t(document).on("click",".btn-confirm",function(i){i.preventDefault(),e=t(this),e.is("a")&&t("#confirmation-modal #confirmation-modal-confirm").attr("href",e.attr("href")),t("#confirmation-modal").modal("show")}),t("#confirmation-modal #confirmation-modal-confirm").click(function(t){e.is("button")&&(t.preventDefault(),e.closest("form").submit())})})}(jQuery),!RedactorPlugins)var RedactorPlugins={};RedactorPlugins.fontcolor={init:function(){for(var t=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],e=["fontcolor","backcolor"],i=0;2>i;i++){var s=e[i],n=$('<div class="redactor_dropdown redactor_dropdown_box_'+s+'" style="display: none; width: 243px;">');this.pickerBuild(n,s,t),$(this.$toolbar).append(n);var r=this.buttonAdd(s,this.opts.curLang[s],$.proxy(function(t,e,i,s){this.dropdownShow(s,t)},this));r.data("dropdown",n)}},pickerBuild:function(t,e,i){var s="color";"backcolor"===e&&(s="background-color");for(var n=this,r=function(t){t.preventDefault();var e=$(this);n.pickerSet(e.data("rule"),e.attr("rel"))},a=i.length,o=0;a>o;o++){var l=i[o],h=$('<a rel="'+l+'" data-rule="'+s+'" href="#" style="float: left; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 20px; height: 20px;"></a>');h.css("background-color",l),t.append(h),h.on("click",r)}var c=$('<a href="#" style="display: block; clear: both; padding: 4px 0; font-size: 11px; line-height: 1;"></a>').html(this.opts.curLang.none).on("click",function(t){t.preventDefault(),n.pickerSet(s,!1)});t.append(c)},pickerSet:function(t,e){this.bufferSet(),this.$editor.focus(),this.inlineRemoveStyle(t),e!==!1&&this.inlineSetStyle(t,e),this.opts.air&&this.$air.fadeOut(100),this.sync()}},function($){function Redactor(t,e){return new Redactor.prototype.init(t,e)}var uuid=0,Range=function(t){return this[0]=t.startOffset,this[1]=t.endOffset,this.range=t,this};Range.prototype.equals=function(){return this[0]===this[1]};var reUrlYoutube=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reUrlVimeo=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;$.fn.redactor=function(t){var e=[],i=Array.prototype.slice.call(arguments,1);return"string"==typeof t?this.each(function(){var s=$.data(this,"redactor");if("undefined"==typeof s||!$.isFunction(s[t]))return $.error('No such method "'+t+'" for Redactor');var n=s[t].apply(s,i);void 0!==n&&n!==s&&e.push(n)}):this.each(function(){$.data(this,"redactor")||$.data(this,"redactor",Redactor(this,t))}),0===e.length?this:1===e.length?e[0]:e},$.Redactor=Redactor,$.Redactor.VERSION="9.2.5",$.Redactor.opts={rangy:!1,iframe:!1,fullpage:!1,css:!1,lang:"en",direction:"ltr",placeholder:!1,typewriter:!1,wym:!1,mobile:!0,cleanup:!0,tidyHtml:!0,pastePlainText:!1,removeEmptyTags:!0,cleanSpaces:!0,cleanFontTag:!0,templateVars:!1,xhtml:!1,visual:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,maxHeight:!1,shortcuts:{"ctrl+m, meta+m":"this.execCommand('removeFormat', false)","ctrl+b, meta+b":"this.execCommand('bold', false)","ctrl+i, meta+i":"this.execCommand('italic', false)","ctrl+h, meta+h":"this.execCommand('superscript', false)","ctrl+l, meta+l":"this.execCommand('subscript', false)","ctrl+k, meta+k":"this.linkShow()","ctrl+shift+7":"this.execCommand('insertorderedlist', false)","ctrl+shift+8":"this.execCommand('insertunorderedlist', false)"},shortcutsAdd:!1,autosave:!1,autosaveInterval:60,plugins:!1,linkProtocol:"http://",linkNofollow:!1,linkSize:50,predefinedLinks:!1,imageFloatMargin:"10px",imageGetJson:!1,dragUpload:!0,imageTabLink:!0,imageUpload:!1,imageUploadParam:"file",imageResizable:!0,fileUpload:!1,fileUploadParam:"file",clipboardUpload:!0,clipboardUploadUrl:!1,dnbImageTypes:["image/png","image/jpeg","image/gif"],s3:!1,uploadFields:!1,observeImages:!0,observeLinks:!0,modalOverlay:!0,tabSpaces:!1,tabFocus:!0,air:!1,airButtons:["formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent"],toolbar:!0,toolbarFixed:!1,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarFixedBox:!1,toolbarExternal:!1,toolbarOverflow:!1,buttonSource:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","video","file","table","link","alignment","|","horizontalrule"],buttonsHideOnMobile:[],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify","table"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline",tr:"table",td:"table",table:"table"},formattingTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],linebreaks:!1,paragraphy:!0,convertDivs:!0,convertLinks:!0,convertImageLinks:!1,convertVideoLinks:!1,formattingPre:!1,phpTags:!1,allowedTags:!1,deniedTags:["html","head","link","body","meta","script","style","applet"],boldTag:"strong",italicTag:"em",indentValue:20,buffer:[],rebuffer:[],textareamode:!1,emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",rBlockTest:/^(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)$/i,alignmentTags:["P","H1","H2","H3","H4","H5","H6","DD","DL","DT","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],ownLine:["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],contOwnLine:["li","dt","dt","h[1-6]","option","script"],newLevel:["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul"],blockLevelElements:["P","H1","H2","H3","H4","H5","H6","DD","DL","DT","DIV","LI","BLOCKQUOTE","OUTPUT","FIGCAPTION","PRE","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE","TD"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit"}}},Redactor.fn=$.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,TAB:9,CTRL:17,META:91,LEFT:37,LEFT_WIN:91},init:function(t,e){this.rtePaste=!1,this.$element=this.$source=$(t),this.uuid=uuid++;var s=$.extend(!0,{},$.Redactor.opts);if(this.opts=$.extend({},s,this.$element.data(),e),this.start=!0,this.dropdowns=[],this.sourceHeight=this.$source.css("height"),this.sourceWidth=this.$source.css("width"),this.opts.fullpage&&(this.opts.iframe=!0),this.opts.linebreaks&&(this.opts.paragraphy=!1),this.opts.paragraphy&&(this.opts.linebreaks=!1),this.opts.toolbarFixedBox&&(this.opts.toolbarFixed=!0),this.document=document,this.window=window,this.savedSel=!1,this.cleanlineBefore=new RegExp("^<(/?"+this.opts.ownLine.join("|/?")+"|"+this.opts.contOwnLine.join("|")+")[ >]"),this.cleanlineAfter=new RegExp("^<(br|/?"+this.opts.ownLine.join("|/?")+"|/"+this.opts.contOwnLine.join("|/")+")[ >]"),this.cleannewLevel=new RegExp("^</?("+this.opts.newLevel.join("|")+")[ >]"),this.rTestBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.opts.linebreaks===!1){if(this.opts.allowedTags!==!1){var n=["strong","em","del"],r=["b","i","strike"];"-1"===$.inArray("p",this.opts.allowedTags)&&this.opts.allowedTags.push("p");for(i in n)"-1"!=$.inArray(n[i],this.opts.allowedTags)&&this.opts.allowedTags.push(r[i])}if(this.opts.deniedTags!==!1){var a=$.inArray("p",this.opts.deniedTags);"-1"!==a&&this.opts.deniedTags.splice(a,a)}}(this.browser("msie")||this.browser("opera"))&&(this.opts.buttons=this.removeFromArrayByValue(this.opts.buttons,"horizontalrule")),this.opts.curLang=this.opts.langs[this.opts.lang],$.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.placeholderInit(),this.buildStart()},toolbarInit:function(t){return{html:{title:t.html,func:"toggle"},formatting:{title:t.formatting,func:"show",dropdown:{p:{title:t.paragraph,func:"formatBlocks"},blockquote:{title:t.quote,func:"formatQuote",className:"redactor_format_blockquote"},pre:{title:t.code,func:"formatBlocks",className:"redactor_format_pre"},h1:{title:t.header1,func:"formatBlocks",className:"redactor_format_h1"},h2:{title:t.header2,func:"formatBlocks",className:"redactor_format_h2"},h3:{title:t.header3,func:"formatBlocks",className:"redactor_format_h3"},h4:{title:t.header4,func:"formatBlocks",className:"redactor_format_h4"},h5:{title:t.header5,func:"formatBlocks",className:"redactor_format_h5"}}},bold:{title:t.bold,exec:"bold"},italic:{title:t.italic,exec:"italic"},deleted:{title:t.deleted,exec:"strikethrough"},underline:{title:t.underline,exec:"underline"},unorderedlist:{title:"&bull; "+t.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+t.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+t.outdent,func:"indentingOutdent"},indent:{title:"> "+t.indent,func:"indentingIndent"},image:{title:t.image,func:"imageShow"},video:{title:t.video,func:"videoShow"},file:{title:t.file,func:"fileShow"},table:{title:t.table,func:"show",dropdown:{insert_table:{title:t.insert_table,func:"tableShow"},separator_drop1:{name:"separator"},insert_row_above:{title:t.insert_row_above,func:"tableAddRowAbove"},insert_row_below:{title:t.insert_row_below,func:"tableAddRowBelow"},insert_column_left:{title:t.insert_column_left,func:"tableAddColumnLeft"},insert_column_right:{title:t.insert_column_right,func:"tableAddColumnRight"},separator_drop2:{name:"separator"},add_head:{title:t.add_head,func:"tableAddHead"},delete_head:{title:t.delete_head,func:"tableDeleteHead"},separator_drop3:{name:"separator"},delete_column:{title:t.delete_column,func:"tableDeleteColumn"},delete_row:{title:t.delete_row,func:"tableDeleteRow"},delete_table:{title:t.delete_table,func:"tableDeleteTable"}}},link:{title:t.link,func:"show",dropdown:{link:{title:t.link_insert,func:"linkShow"},unlink:{title:t.unlink,exec:"unlink"}}},alignment:{title:t.alignment,func:"show",dropdown:{alignleft:{title:t.align_left,func:"alignmentLeft"},aligncenter:{title:t.align_center,func:"alignmentCenter"},alignright:{title:t.align_right,func:"alignmentRight"},justify:{title:t.align_justify,func:"alignmentJustify"}}},alignleft:{title:t.align_left,func:"alignmentLeft"},aligncenter:{title:t.align_center,func:"alignmentCenter"},alignright:{title:t.align_right,func:"alignmentRight"},alignjustify:{title:t.align_justify,func:"alignmentJustify"},horizontalrule:{exec:"inserthorizontalrule",title:t.horizontalrule}}},callback:function(t,e,i){var s=this.opts[t+"Callback"];return $.isFunction(s)?e===!1?s.call(this,i):s.call(this,e,i):i},destroy:function(){clearInterval(this.autosaveInterval),$(window).off(".redactor"),this.$source.off("redactor-textarea"),this.$element.off(".redactor").removeData("redactor");var t=this.get();if(this.opts.textareamode)this.$box.after(this.$source),this.$box.remove(),this.$source.val(t).show();else{var e=this.$editor;this.opts.iframe&&(e=this.$element),this.$box.after(e),this.$box.remove(),e.removeClass("redactor_editor").removeClass("redactor_editor_wym").removeAttr("contenteditable").html(t).show()}this.opts.toolbarExternal&&$(this.opts.toolbarExternal).html(""),this.opts.air&&$("#redactor_air_"+this.uuid).remove()},getObject:function(){return $.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getIframe:function(){return this.opts.iframe?this.$frame:!1},getToolbar:function(){return this.$toolbar?this.$toolbar:!1},get:function(){return this.$source.val()},getCodeIframe:function(){this.$editor.removeAttr("contenteditable").removeAttr("dir");var t=this.outerHtml(this.$frame.contents().children());return this.$editor.attr({contenteditable:!0,dir:this.opts.direction}),t},set:function(t,e,i){t=t.toString(),t=t.replace(/\$/g,"&#36;"),this.opts.fullpage?this.setCodeIframe(t):this.setEditor(t,e),""==t&&(i=!1),i!==!1&&this.placeholderRemoveFromEditor()},setEditor:function(t,e){e!==!1&&(t=this.cleanSavePreCode(t),t=this.cleanStripTags(t),t=this.cleanConvertProtected(t),t=this.cleanConvertInlineTags(t,!0),t=this.opts.linebreaks===!1?this.cleanConverters(t):t.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),t=t.replace(/&amp;#36;/g,"$"),t=this.cleanEmpty(t),this.$editor.html(t),this.setNonEditable(),this.setSpansVerified(),this.sync()},setCodeIframe:function(t){var e=this.iframePage();this.$frame[0].src="about:blank",t=this.cleanConvertProtected(t),t=this.cleanConvertInlineTags(t),t=this.cleanRemoveSpaces(t),e.open(),e.write(t),e.close(),this.opts.fullpage&&(this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction})),this.setNonEditable(),this.setSpansVerified(),this.sync()},setFullpageOnInit:function(t){this.fullpageDoctype=t.match(/^<\!doctype[^>]*>/i),this.fullpageDoctype&&1==this.fullpageDoctype.length&&(t=t.replace(/^<\!doctype[^>]*>/i,"")),t=this.cleanSavePreCode(t,!0),t=this.cleanConverters(t),t=this.cleanEmpty(t),this.$editor.html(t),this.setNonEditable(),this.setSpansVerified(),this.sync()},setFullpageDoctype:function(){if(this.fullpageDoctype&&1==this.fullpageDoctype.length){var t=this.fullpageDoctype[0]+"\n"+this.$source.val();this.$source.val(t)}},setSpansVerified:function(){var t=this.$editor.find("span"),e="inline";$.each(t,function(){var t=this.outerHTML,i=new RegExp("<"+this.tagName,"gi"),s=t.replace(i,"<"+e);i=new RegExp("</"+this.tagName,"gi"),s=s.replace(i,"</"+e),$(this).replaceWith(s)})},setSpansVerifiedHtml:function(t){return t=t.replace(/<span(.*?)>/,"<inline$1>"),t.replace(/<\/span>/,"</inline>")},setNonEditable:function(){this.$editor.find(".noneditable").attr("contenteditable",!1)},sync:function(t){var e="";this.cleanUnverified(),
e=this.opts.fullpage?this.getCodeIframe():this.$editor.html(),e=this.syncClean(e),e=this.cleanRemoveEmptyTags(e);var i=this.cleanRemoveSpaces(this.$source.val(),!1),s=this.cleanRemoveSpaces(e,!1);if(i==s)return!1;if(e=e.replace(/<\/li><(ul|ol)>([\w\W]*?)<\/(ul|ol)>/gi,"<$1>$2</$1></li>"),"<br>"===$.trim(e)&&(e=""),this.opts.xhtml){var n=["br","hr","img","link","input","meta"];$.each(n,function(t,i){e=e.replace(new RegExp("<"+i+"(.*?[^/$]?)>","gi"),"<"+i+"$1 />")})}if(e=this.callback("syncBefore",!1,e),this.$source.val(e),this.setFullpageDoctype(),this.callback("syncAfter",!1,e),this.start===!1)if("undefined"!=typeof t)switch(t.which){case 37:break;case 38:break;case 39:break;case 40:break;default:this.callback("change",!1,e)}else this.callback("change",!1,e)},syncClean:function(t){return this.opts.fullpage||(t=this.cleanStripTags(t)),t=$.trim(t),t=this.placeholderRemoveFromCode(t),t=t.replace(/&#x200b;/gi,""),t=t.replace(/&#8203;/gi,""),t=t.replace(/<\/a>&nbsp;/gi,"</a> "),t=t.replace(/\u200B/g,""),("<p></p>"==t||"<p> </p>"==t||"<p>&nbsp;</p>"==t)&&(t=""),this.opts.linkNofollow&&(t=t.replace(/<a(.*?)rel="nofollow"(.*?)>/gi,"<a$1$2>"),t=t.replace(/<a(.*?)>/gi,'<a$1 rel="nofollow">')),t=t.replace("<!--?php","<?php"),t=t.replace("?-->","?>"),t=t.replace(/<(.*?)class="noeditable"(.*?) contenteditable="false"(.*?)>/gi,'<$1class="noeditable"$2$3>'),t=t.replace(/ data-tagblock=""/gi,""),t=t.replace(/<br\s?\/?>\n?<\/(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)>/gi,"</$1>"),t=t.replace(/<span(.*?)id="redactor-image-box"(.*?)>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),t=t.replace(/<span(.*?)id="redactor-image-resizer"(.*?)>(.*?)<\/span>/gi,""),t=t.replace(/<span(.*?)id="redactor-image-editter"(.*?)>(.*?)<\/span>/gi,""),t=t.replace(/<(ul|ol)>\s*\t*\n*<\/(ul|ol)>/gi,""),this.opts.cleanFontTag&&(t=t.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2")),t=t.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),t=t.replace(/<inline>([\w\W]*?)<\/inline>/gi,"$1"),t=t.replace(/<inline>/gi,"<span>"),t=t.replace(/<inline /gi,"<span "),t=t.replace(/<\/inline>/gi,"</span>"),this.opts.removeEmptyTags&&(t=t.replace(/<span>([\w\W]*?)<\/span>/gi,"$1")),t=t.replace(/<span(.*?)class="redactor_placeholder"(.*?)>([\w\W]*?)<\/span>/gi,""),t=t.replace(/<img(.*?)contenteditable="false"(.*?)>/gi,"<img$1$2>"),t=t.replace(/&/gi,"&"),t=t.replace(/\u2122/gi,"&trade;"),t=t.replace(/\u00a9/gi,"&copy;"),t=t.replace(/\u2026/gi,"&hellip;"),t=t.replace(/\u2014/gi,"&mdash;"),t=t.replace(/\u2010/gi,"&dash;"),t=this.cleanReConvertProtected(t)},buildStart:function(){this.content="",this.$box=$('<div class="redactor_box" />'),"TEXTAREA"===this.$source[0].tagName&&(this.opts.textareamode=!0),this.opts.mobile===!1&&this.isMobile()?this.buildMobile():(this.buildContent(),this.opts.iframe?(this.opts.autoresize=!1,this.iframeStart()):this.opts.textareamode?this.buildFromTextarea():this.buildFromElement(),this.opts.iframe||(this.buildOptions(),this.buildAfter()))},buildMobile:function(){this.opts.textareamode||(this.$editor=this.$source,this.$editor.hide(),this.$source=this.buildCodearea(this.$editor),this.$source.val(this.content)),this.$box.insertAfter(this.$source).append(this.$source)},buildContent:function(){this.opts.textareamode?this.content=$.trim(this.$source.val()):this.content=$.trim(this.$source.html())},buildFromTextarea:function(){this.$editor=$("<div />"),this.$box.insertAfter(this.$source).append(this.$editor).append(this.$source),this.buildAddClasses(this.$editor),this.buildEnable()},buildFromElement:function(){this.$editor=this.$source,this.$source=this.buildCodearea(this.$editor),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$source),this.buildEnable()},buildCodearea:function(t){return $("<textarea />").attr("name",t.attr("id")).css("height",this.sourceHeight)},buildAddClasses:function(t){$.each(this.$source.get(0).className.split(/\s+/),function(e,i){t.addClass("redactor_"+i)})},buildEnable:function(){this.$editor.addClass("redactor_editor").attr({contenteditable:!0,dir:this.opts.direction}),this.$source.attr("dir",this.opts.direction).hide(),this.set(this.content,!0,!1)},buildOptions:function(){var t=this.$editor;this.opts.iframe&&(t=this.$frame),this.opts.tabindex&&t.attr("tabindex",this.opts.tabindex),this.opts.minHeight?t.css("min-height",this.opts.minHeight+"px"):this.browser("mozilla")&&this.opts.linebreaks&&this.$editor.css("min-height","45px"),this.browser("mozilla")&&this.opts.linebreaks&&this.$editor.css("padding-bottom","10px"),this.opts.maxHeight&&(this.opts.autoresize=!1,this.sourceHeight=this.opts.maxHeight),this.opts.wym&&this.$editor.addClass("redactor_editor_wym"),this.opts.typewriter&&this.$editor.addClass("redactor-editor-typewriter"),this.opts.autoresize||t.css("height",this.sourceHeight)},buildAfter:function(){if(this.start=!1,this.opts.toolbar&&(this.opts.toolbar=this.toolbarInit(this.opts.curLang),this.toolbarBuild()),this.modalTemplatesInit(),this.buildPlugins(),this.buildBindKeyboard(),this.opts.autosave&&this.autosave(),setTimeout($.proxy(this.observeStart,this),4),this.browser("mozilla"))try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){}this.opts.focus&&setTimeout($.proxy(this.focus,this),100),this.opts.visual||setTimeout($.proxy(function(){this.opts.visual=!0,this.toggle(!1)},this),200),this.callback("init")},buildBindKeyboard:function(){this.dblEnter=0,!this.opts.dragUpload||this.opts.imageUpload===!1&&this.opts.s3===!1||this.$editor.on("drop.redactor",$.proxy(this.buildEventDrop,this)),this.$editor.on("click.redactor",$.proxy(function(){this.selectall=!1},this)),this.$editor.on("input.redactor",$.proxy(this.sync,this)),this.$editor.on("paste.redactor",$.proxy(this.buildEventPaste,this)),this.$editor.on("keydown.redactor",$.proxy(this.buildEventKeydown,this)),this.$editor.on("keyup.redactor",$.proxy(this.buildEventKeyup,this)),$.isFunction(this.opts.textareaKeydownCallback)&&this.$source.on("keydown.redactor-textarea",$.proxy(this.opts.textareaKeydownCallback,this)),$.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",$.proxy(this.opts.focusCallback,this));var t;$(document).mousedown(function(e){t=$(e.target)}),this.$editor.on("blur.redactor",$.proxy(function(e){$(t).hasClass("redactor_toolbar")||0!=$(t).parents(".redactor_toolbar").size()||(this.selectall=!1,$.isFunction(this.opts.blurCallback)&&this.callback("blur",e))},this))},buildEventDrop:function(t){if(t=t.originalEvent||t,void 0===window.FormData||!t.dataTransfer)return!0;var e=t.dataTransfer.files.length;if(0==e)return!0;t.preventDefault();var i=t.dataTransfer.files[0];return this.opts.dnbImageTypes!==!1&&-1==this.opts.dnbImageTypes.indexOf(i.type)?!0:(this.bufferSet(),this.showProgressBar(),void(this.opts.s3===!1?this.dragUploadAjax(this.opts.imageUpload,i,!0,t,this.opts.imageUploadParam):this.s3uploadFile(i)))},buildEventPaste:function(t){var e=!1;if(this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")){var i=this.browser("version").split(".");i[0]<536&&(e=!0)}if(e)return!0;if(this.browser("opera"))return!0;if(this.opts.clipboardUpload&&this.buildEventClipboardUpload(t))return!0;if(this.opts.cleanup){this.rtePaste=!0,this.selectionSave(),this.selectall||(this.opts.autoresize===!0&&this.fullscreen!==!0?(this.$editor.height(this.$editor.height()),this.saveScroll=this.document.body.scrollTop):this.saveScroll=this.$editor.scrollTop());var s=this.extractContent();setTimeout($.proxy(function(){var t=this.extractContent();this.$editor.append(s),this.selectionRestore();var e=this.getFragmentHtml(t);this.pasteClean(e),this.opts.autoresize===!0&&this.fullscreen!==!0&&this.$editor.css("height","auto")},this),1)}},buildEventClipboardUpload:function(t){var e=t.originalEvent||t;if(this.clipboardFilePaste=!1,"undefined"==typeof e.clipboardData)return!1;if(e.clipboardData.items){var i=e.clipboardData.items[0].getAsFile();if(null!==i){this.bufferSet(),this.clipboardFilePaste=!0;var s=new FileReader;return s.onload=$.proxy(this.pasteClipboardUpload,this),s.readAsDataURL(i),!0}}return!1},buildEventKeydown:function(t){if(this.rtePaste)return!1;var e=t.which,i=t.ctrlKey||t.metaKey,s=this.getParent(),n=this.getCurrent(),r=this.getBlock(),a=!1;if(this.callback("keydown",t),this.browser("mozilla")&&"modify"in window.getSelection()&&i&&(37===t.keyCode||39===t.keyCode)){var o=this.getSelection(),l=t.metaKey?"line":"word";37===t.keyCode&&(o.modify("extend","left",l),t.shiftKey||o.collapseToStart()),39===t.keyCode&&(o.modify("extend","right",l),t.shiftKey||o.collapseToEnd()),t.preventDefault()}if(this.imageResizeHide(!1),(s&&"PRE"===$(s).get(0).tagName||n&&"PRE"===$(n).get(0).tagName)&&(a=!0,e===this.keyCode.DOWN&&this.insertAfterLastElement(r)),e===this.keyCode.DOWN&&(s&&"BLOCKQUOTE"===$(s)[0].tagName&&this.insertAfterLastElement(s),n&&"BLOCKQUOTE"===$(n)[0].tagName&&this.insertAfterLastElement(n),s&&"P"===$(s)[0].tagName&&"BLOCKQUOTE"==$(s).parent()[0].tagName&&this.insertAfterLastElement(s,$(s).parent()[0]),n&&"P"===$(n)[0].tagName&&s&&"BLOCKQUOTE"==$(s)[0].tagName&&this.insertAfterLastElement(n,s)),this.shortcuts(t,e),i&&90===e&&!t.shiftKey&&!t.altKey)return t.preventDefault(),void(this.opts.buffer.length?this.bufferUndo():this.document.execCommand("undo",!1,!1));if(i&&90===e&&t.shiftKey&&!t.altKey)return t.preventDefault(),void(0!=this.opts.rebuffer.length?this.bufferRedo():this.document.execCommand("redo",!1,!1));if(32==e&&this.bufferSet(),i&&65===e?(this.bufferSet(),this.selectall=!0):e==this.keyCode.LEFT_WIN||i||(this.selectall=!1),e!=this.keyCode.ENTER||t.shiftKey||t.ctrlKey||t.metaKey)e===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey)&&(this.bufferSet(),t.preventDefault(),this.insertLineBreak());else{var h=this.getRange();if(h&&h.collapsed===!1&&(sel=this.getSelection(),sel.rangeCount&&h.deleteContents()),this.browser("msie")&&1==s.nodeType&&("TD"==s.tagName||"TH"==s.tagName))return t.preventDefault(),this.bufferSet(),this.insertNode(document.createElement("br")),this.callback("enter",t),!1;if(r&&("BLOCKQUOTE"==r.tagName||"BLOCKQUOTE"==$(r).parent()[0].tagName))if(this.isEndOfElement()){if(1==this.dblEnter){var c,d;if("BLOCKQUOTE"==r.tagName?(d="br",c=r):(d="p",c=$(r).parent()[0]),t.preventDefault(),this.insertingAfterLastElement(c),this.dblEnter=0,"p"==d)$(r).parent().find("p").last().remove();else{var p=$.trim($(r).html());$(r).html(p.replace(/<br\s?\/?>$/i,""))}return}this.dblEnter++}else this.dblEnter++;if(a===!0)return this.buildEventKeydownPre(t,n);if(!this.opts.linebreaks){if(r&&"LI"==r.tagName){var u=this.getBlock();if(u!==!1||"LI"===u.tagName){var f=$.trim($(r).text()),g=$.trim($(u).text());if(""==f&&""==g&&0==$(u).next("li").size()&&0==$(u).parents("li").size()){this.bufferSet();var m=$(u).closest("ol, ul");$(u).remove();var v=$("<p>"+this.opts.invisibleSpace+"</p>");return m.after(v),this.selectionStart(v),this.sync(),this.callback("enter",t),!1}}}if(r&&this.opts.rBlockTest.test(r.tagName))this.bufferSet(),setTimeout($.proxy(function(){var t=this.getBlock();if("DIV"===t.tagName&&!$(t).hasClass("redactor_editor")){var e=$("<p>"+this.opts.invisibleSpace+"</p>");$(t).replaceWith(e),this.selectionStart(e)}},this),1);else if(r===!1){this.bufferSet();var v=$("<p>"+this.opts.invisibleSpace+"</p>");return this.insertNode(v[0]),this.selectionStart(v),this.callback("enter",t),!1}}if(this.opts.linebreaks){if(!r||!this.opts.rBlockTest.test(r.tagName))return this.buildEventKeydownInsertLineBreak(t);this.bufferSet(),setTimeout($.proxy(function(){var t=this.getBlock();"DIV"!==t.tagName&&"P"!==t.tagName||$(t).hasClass("redactor_editor")||this.replaceLineBreak(t)},this),1)}if("BLOCKQUOTE"==r.tagName||"FIGCAPTION"==r.tagName)return this.buildEventKeydownInsertLineBreak(t);this.callback("enter",t)}return(e===this.keyCode.TAB||t.metaKey&&219===e)&&this.opts.shortcuts?this.buildEventKeydownTab(t,a,e):void(e===this.keyCode.BACKSPACE&&this.buildEventKeydownBackspace(t,n,s))},buildEventKeydownPre:function(t,e){t.preventDefault(),this.bufferSet();var i=$(e).parent().text();return this.insertNode(document.createTextNode("\n")),-1==i.search(/\s$/)&&this.insertNode(document.createTextNode("\n")),this.sync(),this.callback("enter",t),!1},buildEventKeydownTab:function(t,e,i){return this.opts.tabFocus?this.isEmpty(this.get())&&this.opts.tabSpaces===!1?!0:(t.preventDefault(),e!==!0||t.shiftKey?this.opts.tabSpaces!==!1?(this.bufferSet(),this.insertNode(document.createTextNode(Array(this.opts.tabSpaces+1).join("Â "))),this.sync(),!1):(t.shiftKey?this.indentingOutdent():this.indentingIndent(),!1):(this.bufferSet(),this.insertNode(document.createTextNode("	")),this.sync(),!1)):!0},buildEventKeydownBackspace:function(t,e,i){if(i&&e&&"TD"==i.parentNode.tagName&&"UL"==i.tagName&&"LI"==e.tagName&&1==$(i).children("li").size()){var s=$(e).text().replace(/[\u200B-\u200D\uFEFF]/g,"");if(""==s){var n=i.parentNode;return $(i).remove(),this.selectionStart(n),this.sync(),!1}}if("undefined"!=typeof e.tagName&&/^(H[1-6])$/i.test(e.tagName)){var n;n=$(this.opts.linebreaks===!1?"<p>"+this.opts.invisibleSpace+"</p>":"<br>"+this.opts.invisibleSpace),$(e).replaceWith(n),this.selectionStart(n),this.sync()}"undefined"!=typeof e.nodeValue&&null!==e.nodeValue&&e.remove&&3===e.nodeType&&null==e.nodeValue.match(/[^\u200B]/g)&&($(e).prev().remove(),this.sync())},buildEventKeydownInsertLineBreak:function(t){this.bufferSet(),t.preventDefault(),this.insertLineBreak(),this.callback("enter",t)},buildEventKeyup:function(t){if(this.rtePaste)return!1;var e=t.which,i=this.getParent(),s=this.getCurrent();if(!this.opts.linebreaks&&3==s.nodeType&&(0==i||"BODY"==i.tagName)){var n=$("<p>").append($(s).clone());$(s).replaceWith(n);var r=$(n).next();"undefined"!=typeof r[0]&&"BR"==r[0].tagName&&r.remove(),this.selectionEnd(n)}return(this.opts.convertLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&e===this.keyCode.ENTER&&this.buildEventKeyupConverters(),e===this.keyCode.DELETE||e===this.keyCode.BACKSPACE?this.formatEmpty(t):(this.callback("keyup",t),void this.sync(t))},buildEventKeyupConverters:function(){this.formatLinkify(this.opts.linkProtocol,this.opts.convertLinks,this.opts.convertImageLinks,this.opts.convertVideoLinks,this.opts.linkSize),setTimeout($.proxy(function(){this.opts.convertImageLinks&&this.observeImages(),this.opts.observeLinks&&this.observeLinks()},this),5)},buildPlugins:function(){this.opts.plugins&&$.each(this.opts.plugins,$.proxy(function(t,e){RedactorPlugins[e]&&($.extend(this,RedactorPlugins[e]),$.isFunction(RedactorPlugins[e].init)&&this.init())},this))},iframeStart:function(){this.iframeCreate(),this.opts.textareamode?this.iframeAppend(this.$source):(this.$sourceOld=this.$source.hide(),this.$source=this.buildCodearea(this.$sourceOld),this.iframeAppend(this.$sourceOld))},iframeAppend:function(t){this.$source.attr("dir",this.opts.direction).hide(),this.$box.insertAfter(t).append(this.$frame).append(this.$source)},iframeCreate:function(){this.$frame=$('<iframe style="width: 100%;" frameborder="0" />').one("load",$.proxy(function(){if(this.opts.fullpage){this.iframePage(),""===this.content&&(this.content=this.opts.invisibleSpace),this.$frame.contents()[0].write(this.content),this.$frame.contents()[0].close();var t=setInterval($.proxy(function(){this.$frame.contents().find("body").html()&&(clearInterval(t),this.iframeLoad())},this),0)}else this.iframeLoad()},this))},iframeDoc:function(){return this.$frame[0].contentWindow.document},iframePage:function(){var t=this.iframeDoc();return t.documentElement&&t.removeChild(t.documentElement),t},iframeAddCss:function(t){t=t||this.opts.css,this.isString(t)&&this.$frame.contents().find("head").append('<link rel="stylesheet" href="'+t+'" />'),$.isArray(t)&&$.each(t,$.proxy(function(t,e){this.iframeAddCss(e)},this))},iframeLoad:function(){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(this.$source.val()):this.set(this.content,!0,!1),this.buildOptions(),this.buildAfter()},placeholderInit:function(){this.opts.placeholder!==!1?(this.placeholderText=this.opts.placeholder,this.opts.placeholder=!0):"undefined"==typeof this.$element.attr("placeholder")||""==this.$element.attr("placeholder")?this.opts.placeholder=!1:(this.placeholderText=this.$element.attr("placeholder"),this.opts.placeholder=!0)},placeholderStart:function(t){return this.opts.placeholder===!1?!1:this.isEmpty(t)?(this.opts.focus=!1,this.placeholderOnFocus(),this.placeholderOnBlur(),this.placeholderGet()):(this.placeholderOnBlur(),!1)},placeholderOnFocus:function(){this.$editor.on("focus.redactor_placeholder",$.proxy(this.placeholderFocus,this))},placeholderOnBlur:function(){this.$editor.on("blur.redactor_placeholder",$.proxy(this.placeholderBlur,this))},placeholderGet:function(){var t=$('<span class="redactor_placeholder">').data("redactor","verified").attr("contenteditable",!1).text(this.placeholderText);return this.opts.linebreaks===!1?$("<p>").append(t):t},placeholderBlur:function(){var t=this.get();this.isEmpty(t)&&(this.placeholderOnFocus(),this.$editor.html(this.placeholderGet()))},placeholderFocus:function(){this.$editor.find("span.redactor_placeholder").remove();var t="";this.opts.linebreaks===!1&&(t=this.opts.emptyHtml),this.$editor.off("focus.redactor_placeholder"),this.$editor.html(t),this.opts.linebreaks===!1?this.selectionStart(this.$editor.children()[0]):this.focus(),this.sync()},placeholderRemoveFromEditor:function(){this.$editor.find("span.redactor_placeholder").remove(),this.$editor.off("focus.redactor_placeholder")},placeholderRemoveFromCode:function(t){return t.replace(/<span class="redactor_placeholder"(.*?)>(.*?)<\/span>/i,"")},shortcuts:function(e,key){return this.opts.shortcuts?void $.each(this.opts.shortcuts,$.proxy(function(str,command){var keys=str.split(",");for(var i in keys)"string"==typeof keys[i]&&this.shortcutsHandler(e,$.trim(keys[i]),$.proxy(function(){eval(command)},this))},this)):(!e.ctrlKey&&!e.metaKey||66!==key&&73!==key||e.preventDefault(),!1)},shortcutsHandler:function(t,e,i){var s={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};e=e.toLowerCase().split(" ");var r=s[t.keyCode],a=String.fromCharCode(t.which).toLowerCase(),o="",l={};$.each(["alt","ctrl","meta","shift"],function(e,i){t[i+"Key"]&&r!==i&&(o+=i+"+")}),r&&(l[o+r]=!0),a&&(l[o+a]=!0,l[o+n[a]]=!0,"shift+"===o&&(l[n[a]]=!0));for(var h=0,c=e.length;c>h;h++)if(l[e[h]])return t.preventDefault(),i.apply(this,arguments)},focus:function(){this.browser("opera")?this.$editor.focus():this.window.setTimeout($.proxy(this.focusSet,this,!0),1)},focusWithSaveScroll:function(){if(this.browser("msie"))var t=this.document.documentElement.scrollTop;this.$editor.focus(),this.browser("msie")&&(this.document.documentElement.scrollTop=t)},focusEnd:function(){if(this.browser("mozilla"))if(this.opts.linebreaks===!1){var t=this.$editor.children().last();this.$editor.focus(),this.selectionEnd(t)}else this.focusSet();else this.focusSet()},focusSet:function(t,e){this.$editor.focus(),"undefined"==typeof e&&(e=this.$editor[0]);var i=this.getRange();i.selectNodeContents(e),i.collapse(t||!1);var s=this.getSelection();s.removeAllRanges(),s.addRange(i)},toggle:function(t){this.opts.visual?this.toggleCode(t):this.toggleVisual()},toggleVisual:function(){var t=this.$source.hide().val();if("undefined"!=typeof this.modified){var e=this.modified.replace(/\n/g,""),i=t.replace(/\n/g,"");i=this.cleanRemoveSpaces(i,!1),this.modified=this.cleanRemoveSpaces(e,!1)!==i}this.modified&&(this.opts.fullpage&&""===t?this.setFullpageOnInit(t):(this.set(t),this.opts.fullpage&&this.buildBindKeyboard()),this.callback("change",!1,t)),this.opts.iframe?this.$frame.show():this.$editor.show(),this.opts.fullpage&&this.$editor.attr("contenteditable",!0),this.$source.off("keydown.redactor-textarea-indenting"),this.$editor.focus(),this.selectionRestore(),this.observeStart(),this.buttonActiveVisual(),this.buttonInactive("html"),this.opts.visual=!0},toggleCode:function(t){t!==!1&&this.selectionSave();var e=null;this.opts.iframe?(e=this.$frame.height(),this.opts.fullpage&&this.$editor.removeAttr("contenteditable"),this.$frame.hide()):(e=this.$editor.innerHeight(),this.$editor.hide());var i=this.$source.val();""!==i&&this.opts.tidyHtml&&this.$source.val(this.cleanHtml(i)),this.modified=i,this.$source.height(e).show().focus(),this.$source.on("keydown.redactor-textarea-indenting",this.textareaIndenting),this.buttonInactiveVisual(),this.buttonActive("html"),this.opts.visual=!1},textareaIndenting:function(t){if(9===t.keyCode){var e=$(this),i=e.get(0).selectionStart;return e.val(e.val().substring(0,i)+"	"+e.val().substring(e.get(0).selectionEnd)),e.get(0).selectionStart=e.get(0).selectionEnd=i+1,!1}},autosave:function(){var t=!1;this.autosaveInterval=setInterval($.proxy(function(){var e=this.get();if(t!==e){var i=this.$source.attr("name");$.ajax({url:this.opts.autosave,type:"post",data:"name="+i+"&"+i+"="+escape(encodeURIComponent(e)),success:$.proxy(function(i){var s=$.parseJSON(i);"undefined"==typeof s.error?this.callback("autosave",!1,s):this.callback("autosaveError",!1,s),t=e},this)})}},this),1e3*this.opts.autosaveInterval)},toolbarBuild:function(){if(this.isMobile()&&this.opts.buttonsHideOnMobile.length>0&&$.each(this.opts.buttonsHideOnMobile,$.proxy(function(t,e){var i=this.opts.buttons.indexOf(e);this.opts.buttons.splice(i,1)},this)),this.opts.air)this.opts.buttons=this.opts.airButtons;else if(!this.opts.buttonSource){var t=this.opts.buttons.indexOf("html");this.opts.buttons.splice(t,1)}return this.opts.toolbar&&$.each(this.opts.toolbar.formatting.dropdown,$.proxy(function(t,e){"-1"==$.inArray(t,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[t]},this)),0===this.opts.buttons.length?!1:(this.airEnable(),this.$toolbar=$("<ul>").addClass("redactor_toolbar").attr("id","redactor_toolbar_"+this.uuid),this.opts.typewriter&&this.$toolbar.addClass("redactor-toolbar-typewriter"),this.opts.toolbarOverflow&&this.isMobile()&&this.$toolbar.addClass("redactor-toolbar-overflow"),this.opts.air?(this.$air=$('<div class="redactor_air">').attr("id","redactor_air_"+this.uuid).hide(),this.$air.append(this.$toolbar),$("body").append(this.$air)):this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),$(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar),$.each(this.opts.buttons,$.proxy(function(t,e){if(this.opts.toolbar[e]){var i=this.opts.toolbar[e];if(this.opts.fileUpload===!1&&"file"===e)return!0;this.$toolbar.append($("<li>").append(this.buttonBuild(e,i)))}},this)),this.$toolbar.find("a").attr("tabindex","-1"),this.opts.toolbarFixed&&(this.toolbarObserveScroll(),$(this.opts.toolbarFixedTarget).on("scroll.redactor",$.proxy(this.toolbarObserveScroll,this))),void(this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor",$.proxy(this.buttonActiveObserver,this))))},toolbarObserveScroll:function(){var t=$(this.opts.toolbarFixedTarget).scrollTop(),e=0,i=0,s=0;if(e=this.opts.toolbarFixedTarget===document?this.$box.offset().top:1,s=e+this.$box.height()+40,t>e){var n="100%";this.opts.toolbarFixedBox&&(i=this.$box.offset().left,n=this.$box.innerWidth(),this.$toolbar.addClass("toolbar_fixed_box")),this.toolbarFixed=!0,this.opts.toolbarFixedTarget===document?this.$toolbar.css({position:"fixed",width:n,zIndex:10005,top:this.opts.toolbarFixedTopOffset+"px",left:i}):this.$toolbar.css({position:"absolute",width:n,zIndex:10005,top:this.opts.toolbarFixedTopOffset+t+"px",left:0}),s>t?this.$toolbar.css("visibility","visible"):this.$toolbar.css("visibility","hidden")}else this.toolbarFixed=!1,this.$toolbar.css({position:"relative",width:"auto",top:0,left:i}),this.opts.toolbarFixedBox&&this.$toolbar.removeClass("toolbar_fixed_box")},airEnable:function(){this.opts.air&&this.$editor.on("mouseup.redactor keyup.redactor",this,$.proxy(function(t){var e=this.getSelectionText();if("mouseup"===t.type&&""!=e&&this.airShow(t),"keyup"===t.type&&t.shiftKey&&""!=e){var i=$(this.getElement(this.getSelection().focusNode)),s=i.offset();s.height=i.height(),this.airShow(s,!0)}},this))},airShow:function(t,e){if(this.opts.air){this.selectionSave();var i,s;if($(".redactor_air").hide(),e)i=t.left,s=t.top+t.height+14,this.opts.iframe&&(s+=this.$box.position().top-$(this.document).scrollTop(),i+=this.$box.position().left);else{var n=this.$air.innerWidth();i=t.clientX,$(this.document).width()<i+n&&(i-=n),s=t.clientY+14,this.opts.iframe?(s+=this.$box.position().top,i+=this.$box.position().left):s+=$(this.document).scrollTop()}this.$air.css({left:i+"px",top:s+"px"}).show(),this.airBindHide()}},airBindHide:function(){if(this.opts.air){var t=$.proxy(function(t){$(t).on("mousedown.redactor",$.proxy(function(e){0===$(e.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),this.selectionRemove(),$(t).off(e))},this)).on("keydown.redactor",$.proxy(function(e){e.which===this.keyCode.ESC&&this.getSelection().collapseToStart(),this.$air.fadeOut(100),$(t).off(e)},this))},this);t(document),this.opts.iframe&&t(this.document)}},airBindMousemoveHide:function(){if(this.opts.air){var t=$.proxy(function(t){$(t).on("mousemove.redactor",$.proxy(function(e){0===$(e.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),$(t).off(e))},this))},this);t(document),this.opts.iframe&&t(this.document)}},dropdownBuild:function(t,e){$.each(e,$.proxy(function(e,i){i.className||(i.className="");var s;"separator"===i.name?s=$('<a class="redactor_separator_drop">'):(s=$('<a href="#" class="'+i.className+" redactor_dropdown_"+e+'">'+i.title+"</a>"),s.on("click",$.proxy(function(t){this.opts.air&&this.selectionRestore(),t.preventDefault&&t.preventDefault(),this.browser("msie")&&(t.returnValue=!1),i.callback&&i.callback.call(this,e,s,i,t),i.exec&&this.execCommand(i.exec,e),i.func&&this[i.func](e),this.buttonActiveObserver(),this.opts.air&&this.$air.fadeOut(100)},this))),t.append(s)},this))},dropdownShow:function(t,e){if(!this.opts.visual)return t.preventDefault(),!1;var i=this.buttonGet(e),s=i.data("dropdown").appendTo(document.body);if(i.hasClass("dropact"))this.dropdownHideAll();else{this.dropdownHideAll(),this.callback("dropdownShow",{dropdown:s,key:e,button:i}),this.buttonActive(e),i.addClass("dropact");var n=i.offset(),r=s.width();n.left+r>$(document).width()&&(n.left-=r);var a=n.left+"px",o=i.innerHeight(),l="absolute",h=o+this.opts.toolbarFixedTopOffset+"px";this.opts.toolbarFixed&&this.toolbarFixed?l="fixed":h=n.top+o+"px",s.css({position:l,left:a,top:h}).show(),this.callback("dropdownShown",{dropdown:s,key:e,button:i})}var c=$.proxy(function(t){this.dropdownHide(t,s)},this);$(document).one("click",c),this.$editor.one("click",c),this.$editor.one("touchstart",c),t.stopPropagation(),this.focusWithSaveScroll()},dropdownHideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),$(".redactor_dropdown").hide(),this.callback("dropdownHide")},dropdownHide:function(t,e){$(t.target).hasClass("dropact")||(e.removeClass("dropact"),this.dropdownHideAll())},buttonBuild:function(t,e,i){var s=$('<a href="javascript:;" title="'+e.title+'" tabindex="-1" class="re-icon re-'+t+'"></a>');if("undefined"!=typeof i&&s.addClass("redactor-btn-image"),s.on("click",$.proxy(function(i){return i.preventDefault&&i.preventDefault(),this.browser("msie")&&(i.returnValue=!1),s.hasClass("redactor_button_disabled")?!1:(this.isFocused()!==!1||e.exec||this.focusWithSaveScroll(),e.exec?(this.focusWithSaveScroll(),this.execCommand(e.exec,t),this.airBindMousemoveHide()):e.func&&"show"!==e.func?(this[e.func](t),this.airBindMousemoveHide()):e.callback?(e.callback.call(this,t,s,e,i),this.airBindMousemoveHide()):e.dropdown&&this.dropdownShow(i,t),void this.buttonActiveObserver(!1,t))},this)),e.dropdown){var n=$('<div class="redactor_dropdown redactor_dropdown_box_'+t+'" style="display: none;">');s.data("dropdown",n),this.dropdownBuild(n,e.dropdown)}return s},buttonGet:function(t){return this.opts.toolbar?$(this.$toolbar.find("a.re-"+t)):!1},buttonTagToActiveState:function(t,e){this.opts.activeButtons.push(t),this.opts.activeButtonsStates[e]=t},buttonActiveToggle:function(t){var e=this.buttonGet(t);e.hasClass("redactor_act")?this.buttonInactive(t):this.buttonActive(t)},buttonActive:function(t){var e=this.buttonGet(t);e.addClass("redactor_act")},buttonInactive:function(t){var e=this.buttonGet(t);e.removeClass("redactor_act")},buttonInactiveAll:function(t){this.$toolbar.find("a.re-icon").not(".re-"+t).removeClass("redactor_act")},buttonActiveVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor_button_disabled")},buttonInactiveVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor_button_disabled")},buttonChangeIcon:function(t,e){this.buttonGet(t).addClass("re-"+e)},buttonRemoveIcon:function(t,e){this.buttonGet(t).removeClass("re-"+e)},buttonAwesome:function(t,e){var i=this.buttonGet(t);i.removeClass("redactor-btn-image"),i.addClass("fa-redactor-btn"),i.html('<i class="fa '+e+'"></i>')},buttonAdd:function(t,e,i,s){if(this.opts.toolbar){var n=this.buttonBuild(t,{title:e,callback:i,dropdown:s},!0);return this.$toolbar.append($("<li>").append(n)),n}},buttonAddFirst:function(t,e,i,s){if(this.opts.toolbar){var n=this.buttonBuild(t,{title:e,callback:i,dropdown:s},!0);this.$toolbar.prepend($("<li>").append(n))}},buttonAddAfter:function(t,e,i,s,n){if(this.opts.toolbar){var r=this.buttonBuild(e,{title:i,callback:s,dropdown:n},!0),a=this.buttonGet(t);return 0!==a.size()?a.parent().after($("<li>").append(r)):this.$toolbar.append($("<li>").append(r)),r}},buttonAddBefore:function(t,e,i,s,n){if(this.opts.toolbar){var r=this.buttonBuild(e,{title:i,callback:s,dropdown:n},!0),a=this.buttonGet(t);return 0!==a.size()?a.parent().before($("<li>").append(r)):this.$toolbar.append($("<li>").append(r)),r}},buttonRemove:function(t){var e=this.buttonGet(t);e.remove()},buttonActiveObserver:function(t,e){var i=this.getParent();if(this.buttonInactiveAll(e),t===!1&&"html"!==e)return void(-1!=$.inArray(e,this.opts.activeButtons)&&this.buttonActiveToggle(e));i&&"A"===i.tagName?this.$toolbar.find("a.redactor_dropdown_link").text(this.opts.curLang.link_edit):this.$toolbar.find("a.redactor_dropdown_link").text(this.opts.curLang.link_insert),$.each(this.opts.activeButtonsStates,$.proxy(function(t,e){0!=$(i).closest(t,this.$editor.get()[0]).length&&this.buttonActive(e)},this));var s=$(i).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(s.length){var n=s.css("text-align");""==n&&(n="left"),this.buttonActive("align"+n)}},execPasteFrag:function(t){var e=this.getSelection();if(e.getRangeAt&&e.rangeCount){var i=this.getRange();i.deleteContents();var s=this.document.createElement("div");s.innerHTML=t;for(var n,r,a=this.document.createDocumentFragment();n=s.firstChild;)r=a.appendChild(n);a.firstChild;i.insertNode(a),r&&(i=i.cloneRange(),i.setStartAfter(r),i.collapse(!0)),e.removeAllRanges(),e.addRange(i)}},exec:function(t,e,i){"formatblock"===t&&this.browser("msie")&&(e="<"+e+">"),"inserthtml"===t&&this.browser("msie")?this.isIe11()?this.execPasteFrag(e):(this.focusWithSaveScroll(),
this.document.selection.createRange().pasteHTML(e)):this.document.execCommand(t,!1,e),i!==!1&&this.sync(),this.callback("execCommand",t,e)},execCommand:function(t,e,i){if(!this.opts.visual)return this.$source.focus(),!1;if(("bold"===t||"italic"===t||"underline"===t||"strikethrough"===t)&&this.bufferSet(),"superscript"===t||"subscript"===t){var s=this.getParent();("SUP"===s.tagName||"SUB"===s.tagName)&&this.inlineRemoveFormatReplace(s)}return"inserthtml"===t?(this.insertHtml(e,i),void this.callback("execCommand",t,e)):this.currentOrParentIs("PRE")&&!this.opts.formattingPre?!1:"insertunorderedlist"===t||"insertorderedlist"===t?this.execLists(t,e):"unlink"===t?this.execUnlink(t,e):(this.exec(t,e,i),void("inserthorizontalrule"===t&&this.$editor.find("hr").removeAttr("id")))},execUnlink:function(t,e){this.bufferSet();var i=this.currentOrParentIs("A");return i?($(i).replaceWith($(i).text()),this.sync(),void this.callback("execCommand",t,e)):void 0},execLists:function(t,e){this.bufferSet();var i=this.getParent(),s=$(i).closest("ol, ul");this.isParentRedactor(s)||0==s.size()||(s=!1);var n=!1;if(s&&s.length){n=!0;var r=s[0].tagName;("insertunorderedlist"===t&&"OL"===r||"insertorderedlist"===t&&"UL"===r)&&(n=!1)}if(this.selectionSave(),n){var a=this.getNodes(),o=this.getBlocks(a);"undefined"!=typeof a[0]&&a.length>1&&3==a[0].nodeType&&o.unshift(this.getBlock());var l="",h="";$.each(o,$.proxy(function(t,e){if("LI"==e.tagName){var i=$(e),s=i.clone();if(s.find("ul","ol").remove(),this.opts.linebreaks===!1)l+=this.outerHtml($("<p>").append(s.contents()));else{var n=s.html().replace(/<br\s?\/?>$/i,"");l+=n+"<br>"}0==t?(i.addClass("redactor-replaced").empty(),h=this.outerHtml(i)):i.remove()}},this)),html=this.$editor.html().replace(h,"</"+r+">"+l+"<"+r+">"),this.$editor.html(html),this.$editor.find(r+":empty").remove()}else{var c=$(this.getParent()).closest("td");if(this.browser("msie")&&!this.isIe11()&&this.opts.linebreaks){var d=this.selectionWrap("div"),p=$(d).html(),u=$("<ul>");"insertorderedlist"==t&&(u=$("<ol>"));var f=$("<li>");""==$.trim(p)?(f.append(p+'<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),u.append(f),this.$editor.find("#selection-marker-1").replaceWith(u)):(f.append(p),u.append(f),$(d).replaceWith(u))}else this.document.execCommand(t);var i=this.getParent(),s=$(i).closest("ol, ul");if(this.opts.linebreaks===!1){var g=$.trim(s.text());""==g&&(s.children("li").find("br").remove(),s.children("li").append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"))}if(0!=c.size()&&s.wrapAll("<td>"),s.length){var m=s.parent();this.isParentRedactor(m)&&"LI"!=m[0].tagName&&this.nodeTestBlocks(m[0])&&m.replaceWith(m.contents())}this.browser("mozilla")&&this.$editor.focus()}this.selectionRestore(),this.$editor.find("#selection-marker-1").removeAttr("id"),this.sync(),this.callback("execCommand",t,e)},indentingIndent:function(){this.indentingStart("indent")},indentingOutdent:function(){this.indentingStart("outdent")},indentingStart:function(t){if(this.bufferSet(),"indent"===t){var e=this.getBlock();if(this.selectionSave(),e&&"LI"==e.tagName){var i=this.getParent(),s=$(i).closest("ol, ul"),n=s[0].tagName,r=this.getBlocks();$.each(r,function(t,e){if("LI"==e.tagName){var i=$(e).prev();if(0!=i.size()&&"LI"==i[0].tagName){var s=i.children("ul, ol");0==s.size()?i.append($("<"+n+">").append(e)):s.append(e)}}})}else if(e===!1&&this.opts.linebreaks===!0){this.exec("formatBlock","blockquote");var a=this.getBlock(),e=$('<div data-tagblock="">').html($(a).html());$(a).replaceWith(e);var o=this.normalize($(e).css("margin-left"))+this.opts.indentValue;$(e).css("margin-left",o+"px")}else{var l=this.getBlocks();$.each(l,$.proxy(function(t,e){var i=!1;if("TD"!==e.tagName){i=-1!==$.inArray(e.tagName,this.opts.alignmentTags)?$(e):$(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);var s=this.normalize(i.css("margin-left"))+this.opts.indentValue;i.css("margin-left",s+"px")}},this))}this.selectionRestore()}else{this.selectionSave();var e=this.getBlock();if(e&&"LI"==e.tagName){var r=this.getBlocks(),h=0;this.insideOutdent(e,h,r)}else{var l=this.getBlocks();$.each(l,$.proxy(function(t,e){var i=!1;i=-1!==$.inArray(e.tagName,this.opts.alignmentTags)?$(e):$(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);var s=this.normalize(i.css("margin-left"))-this.opts.indentValue;0>=s?this.opts.linebreaks===!0&&"undefined"!=typeof i.data("tagblock")?i.replaceWith(i.html()+"<br>"):(i.css("margin-left",""),this.removeEmptyAttr(i,"style")):i.css("margin-left",s+"px")},this))}this.selectionRestore()}this.sync()},insideOutdent:function(t,e,i){if(t&&"LI"==t.tagName){var s=$(t).parent().parent();0!=s.size()&&"LI"==s[0].tagName?s.after(t):"undefined"!=typeof i[e]?(t=i[e],e++,this.insideOutdent(t,e,i)):this.execCommand("insertunorderedlist")}},alignmentLeft:function(){this.alignmentSet("","JustifyLeft")},alignmentRight:function(){this.alignmentSet("right","JustifyRight")},alignmentCenter:function(){this.alignmentSet("center","JustifyCenter")},alignmentJustify:function(){this.alignmentSet("justify","JustifyFull")},alignmentSet:function(t,e){if(this.bufferSet(),this.oldIE())return this.document.execCommand(e,!1,!1),!0;this.selectionSave();var i=this.getBlock();if(!i&&this.opts.linebreaks){this.exec("formatblock","div");var s=this.getBlock(),i=$('<div data-tagblock="">').html($(s).html());$(s).replaceWith(i),$(i).css("text-align",t),this.removeEmptyAttr(i,"style"),""==t&&"undefined"!=typeof $(i).data("tagblock")&&$(i).replaceWith($(i).html())}else{var n=this.getBlocks();$.each(n,$.proxy(function(e,i){var s=!1;s=-1!==$.inArray(i.tagName,this.opts.alignmentTags)?$(i):$(i).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]),s&&(s.css("text-align",t),this.removeEmptyAttr(s,"style"))},this))}this.selectionRestore(),this.sync()},cleanEmpty:function(t){var e=this.placeholderStart(t);return e!==!1?e:(this.opts.linebreaks===!1&&(""===t?t=this.opts.emptyHtml:-1!==t.search(/^<hr\s?\/?>$/gi)&&(t="<hr>"+this.opts.emptyHtml)),t)},cleanConverters:function(t){return this.opts.convertDivs&&!this.opts.gallery&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")),this.opts.paragraphy&&(t=this.cleanParagraphy(t)),t},cleanConvertProtected:function(t){return this.opts.templateVars&&(t=t.replace(/\{\{(.*?)\}\}/gi,"<!-- template double $1 -->"),t=t.replace(/\{(.*?)\}/gi,"<!-- template $1 -->")),t=t.replace(/<script(.*?)>([\w\W]*?)<\/script>/gi,'<title type="text/javascript" style="display: none;" class="redactor-script-tag"$1>$2</title>'),t=t.replace(/<style(.*?)>([\w\W]*?)<\/style>/gi,'<section$1 style="display: none;" rel="redactor-style-tag">$2</section>'),t=t.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>'),t=this.opts.phpTags?t.replace(/<\?php([\w\W]*?)\?>/gi,'<section style="display: none;" rel="redactor-php-tag">$1</section>'):t.replace(/<\?php([\w\W]*?)\?>/gi,"")},cleanReConvertProtected:function(t){return this.opts.templateVars&&(t=t.replace(/<!-- template double (.*?) -->/gi,"{{$1}}"),t=t.replace(/<!-- template (.*?) -->/gi,"{$1}")),t=t.replace(/<title type="text\/javascript" style="display: none;" class="redactor-script-tag"(.*?)>([\w\W]*?)<\/title>/gi,'<script$1 type="text/javascript">$2</script>'),t=t.replace(/<section(.*?) style="display: none;" rel="redactor-style-tag">([\w\W]*?)<\/section>/gi,"<style$1>$2</style>"),t=t.replace(/<section(.*?)rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>"),this.opts.phpTags&&(t=t.replace(/<section style="display: none;" rel="redactor-php-tag">([\w\W]*?)<\/section>/gi,"<?php\r\n$1\r\n?>")),t},cleanRemoveSpaces:function(t,e){if(e!==!1){var e=[],i=t.match(/<(pre|style|script|title)(.*?)>([\w\W]*?)<\/(pre|style|script|title)>/gi);if(null===i&&(i=[]),this.opts.phpTags){var s=t.match(/<\?php([\w\W]*?)\?>/gi);s&&(i=$.merge(i,s))}i&&$.each(i,function(i,s){t=t.replace(s,"buffer_"+i),e.push(s)})}return t=t.replace(/\n/g," "),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g," "),t=t.replace(/[\s\n]*$/g," "),t=t.replace(/>\s{2,}</g,"> <"),t=this.cleanReplacer(t,e),t=t.replace(/\n\n/g,"\n")},cleanReplacer:function(t,e){return e===!1?t:($.each(e,function(e,i){t=t.replace("buffer_"+e,i)}),t)},cleanRemoveEmptyTags:function(t){t=t.replace(/[\u200B-\u200D\uFEFF]/g,"");var e=["<b>\\s*</b>","<b>&nbsp;</b>","<em>\\s*</em>"],i=["<pre></pre>","<blockquote>\\s*</blockquote>","<dd></dd>","<dt></dt>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<p>\\s*</p>","<p></p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];i=this.opts.removeEmptyTags?i.concat(e):e;for(var s=i.length,n=0;s>n;++n)t=t.replace(new RegExp(i[n],"gi"),"");return t},cleanParagraphy:function(t){function e(e,i,s){return t.replace(new RegExp(e,i),s)}if(t=$.trim(t),this.opts.linebreaks===!0)return t;if(""===t||"<p></p>"===t)return this.opts.emptyHtml;if(t+="\n",this.opts.removeEmptyTags===!1)return t;var i=[],s=t.match(/<(table|div|pre|object)(.*?)>([\w\W]*?)<\/(table|div|pre|object)>/gi);s||(s=[]);var n=t.match(/<!--([\w\W]*?)-->/gi);if(n&&(s=$.merge(s,n)),this.opts.phpTags){var r=t.match(/<section(.*?)rel="redactor-php-tag">([\w\W]*?)<\/section>/gi);r&&(s=$.merge(s,r))}s&&$.each(s,function(e,s){i[e]=s,t=t.replace(s,"{replace"+e+"}\n")}),t=t.replace(/<br \/>\s*<br \/>/gi,"\n\n"),t=t.replace(/<br><br>/gi,"\n\n");var a="(comment|html|body|head|title|meta|style|script|link|iframe|table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|option|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";t=e("(<"+a+"[^>]*>)","gi","\n$1"),t=e("(</"+a+">)","gi","$1\n\n"),t=e("\r\n","g","\n"),t=e("\r","g","\n"),t=e("/\n\n+/","g","\n\n");var o=t.split(new RegExp("\ns*\n","g"),-1);t="";for(var l in o)o.hasOwnProperty(l)&&(-1==o[l].search("{replace")?(o[l]=o[l].replace(/<p>\n\t?<\/p>/gi,""),o[l]=o[l].replace(/<p><\/p>/gi,""),""!=o[l]&&(t+="<p>"+o[l].replace(/^\n+|\n+$/g,"")+"</p>")):t+=o[l]);return t=e("<p><p>","gi","<p>"),t=e("</p></p>","gi","</p>"),t=e("<p>s?</p>","gi",""),t=e("<p>([^<]+)</(div|address|form)>","gi","<p>$1</p></$2>"),t=e("<p>(</?"+a+"[^>]*>)</p>","gi","$1"),t=e("<p>(<li.+?)</p>","gi","$1"),t=e("<p>s?(</?"+a+"[^>]*>)","gi","$1"),t=e("(</?"+a+"[^>]*>)s?</p>","gi","$1"),t=e("(</?"+a+"[^>]*>)s?<br />","gi","$1"),t=e("<br />(s*</?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","gi","$1"),t=e("\n</p>","gi","</p>"),t=e("<li><p>","gi","<li>"),t=e("</p></li>","gi","</li>"),t=e("</li><p>","gi","</li>"),t=e("<p>	?\n?<p>","gi","<p>"),t=e("</dt><p>","gi","</dt>"),t=e("</dd><p>","gi","</dd>"),t=e("<br></p></blockquote>","gi","</blockquote>"),t=e("<p>	*</p>","gi",""),$.each(i,function(e,i){t=t.replace("{replace"+e+"}",i)}),$.trim(t)},cleanConvertInlineTags:function(t,e){var i="strong";"b"===this.opts.boldTag&&(i="b");var s="em";return"i"===this.opts.italicTag&&(s="i"),t=t.replace(/<span style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<"+s+">$1</"+s+">"),t=t.replace(/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<"+i+">$1</"+i+">"),t="strong"===this.opts.boldTag?t.replace(/<b>([\w\W]*?)<\/b>/gi,"<strong>$1</strong>"):t.replace(/<strong>([\w\W]*?)<\/strong>/gi,"<b>$1</b>"),t="em"===this.opts.italicTag?t.replace(/<i>([\w\W]*?)<\/i>/gi,"<em>$1</em>"):t.replace(/<em>([\w\W]*?)<\/em>/gi,"<i>$1</i>"),t=t.replace(/<span style="text-decoration: underline;">([\w\W]*?)<\/span>/gi,"<u>$1</u>"),t=e!==!0?t.replace(/<strike>([\w\W]*?)<\/strike>/gi,"<del>$1</del>"):t.replace(/<del>([\w\W]*?)<\/del>/gi,"<strike>$1</strike>")},cleanStripTags:function(t){if(""==t||"undefined"==typeof t)return t;var e=!1;this.opts.allowedTags!==!1&&(e=!0);var i=e===!0?this.opts.allowedTags:this.opts.deniedTags,s=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t=t.replace(s,function(t,s){return e===!0?$.inArray(s.toLowerCase(),i)>"-1"?t:"":$.inArray(s.toLowerCase(),i)>"-1"?"":t}),t=this.cleanConvertInlineTags(t)},cleanSavePreCode:function(t,e){var i=t.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);return null!==i&&$.each(i,$.proxy(function(i,s){var n=s.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);n[3]=n[3].replace(/&nbsp;/g," "),e!==!1&&(n[3]=this.cleanEncodeEntities(n[3])),n[3]=n[3].replace(/\$/g,"&#36;"),t=t.replace(s,"<"+n[1]+n[2]+">"+n[3]+"</"+n[1]+">")},this)),t},cleanEncodeEntities:function(t){return t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanUnverified:function(){var t=this.$editor.find("li, img, a, b, strong, sub, sup, i, em, u, small, strike, del, span, cite");t.filter('[style*="background-color: transparent;"][style*="line-height"]').css("background-color","").css("line-height",""),t.filter('[style*="background-color: transparent;"]').css("background-color",""),t.css("line-height",""),$.each(t,$.proxy(function(t,e){this.removeEmptyAttr(e,"style")},this));var e=this.$editor.find("b, strong, i, em, u, strike, del");e.css("font-size",""),$.each(e,$.proxy(function(t,e){this.removeEmptyAttr(e,"style")},this)),this.$editor.find('div[style="text-align: -webkit-auto;"]').contents().unwrap(),this.$editor.find("ul, ol, li").removeAttr("style")},cleanHtml:function(t){var e=0,i=t.length,s=0,n=null,r=null,a="",o="",l="";for(this.cleanlevel=0;i>e;e++){if(s=e,-1==t.substr(e).indexOf("<"))return o+=t.substr(e),this.cleanFinish(o);for(;i>s&&"<"!=t.charAt(s);)s++;for(e!=s&&(l=t.substr(e,s-e),l.match(/^\s{2,}$/g)||("\n"==o.charAt(o.length-1)?o+=this.cleanGetTabs():"\n"==l.charAt(0)&&(o+="\n"+this.cleanGetTabs(),l=l.replace(/^\s+/,"")),o+=l),l.match(/\n/)&&(o+="\n"+this.cleanGetTabs())),n=s;i>s&&">"!=t.charAt(s);)s++;a=t.substr(n,s-n),e=s;var h;if("!--"==a.substr(1,3)){if(!a.match(/--$/)){for(;"-->"!=t.substr(s,3);)s++;s+=2,a=t.substr(n,s-n),e=s}"\n"!=o.charAt(o.length-1)&&(o+="\n"),o+=this.cleanGetTabs(),o+=a+">\n"}else"!"==a[1]?o=this.placeTag(a+">",o):"?"==a[1]?o+=a+">\n":(h=a.match(/^<(script|style|pre)/i))?(h[1]=h[1].toLowerCase(),a=this.cleanTag(a),o=this.placeTag(a,o),r=String(t.substr(e+1)).toLowerCase().indexOf("</"+h[1]),r&&(l=t.substr(e+1,r),e+=r,o+=l)):(a=this.cleanTag(a),o=this.placeTag(a,o))}return this.cleanFinish(o)},cleanGetTabs:function(){for(var t="",e=0;e<this.cleanlevel;e++)t+="	";return t},cleanFinish:function(t){return t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/,""),t=t.replace(/[\s\n]*$/,""),t=t.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.cleanlevel=0,t},cleanTag:function(t){var e="";t=t.replace(/\n/g," "),t=t.replace(/\s{2,}/g," "),t=t.replace(/^\s+|\s+$/g," ");var i="";t.match(/\/$/)&&(i="/",t=t.replace(/\/+$/,""));for(var s;s=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)s[2]?e+=s[1].toLowerCase()+"="+s[2]:s[1]&&(e+=s[1].toLowerCase()),e+=" ",t=t.substr(s[0].length);return e.replace(/\s*$/,"")+i+">"},placeTag:function(t,e){var i=t.match(this.cleannewLevel);return(t.match(this.cleanlineBefore)||i)&&(e=e.replace(/\s*$/,""),e+="\n"),i&&"/"==t.charAt(1)&&this.cleanlevel--,"\n"==e.charAt(e.length-1)&&(e+=this.cleanGetTabs()),i&&"/"!=t.charAt(1)&&this.cleanlevel++,e+=t,(t.match(this.cleanlineAfter)||t.match(this.cleannewLevel))&&(e=e.replace(/ *$/,""),e+="\n"),e},formatEmpty:function(t){var e=$.trim(this.$editor.html());if(this.opts.linebreaks)""==e&&(t.preventDefault(),this.$editor.html(""),this.focus());else{e=e.replace(/<br\s?\/?>/i,"");var i=e.replace(/<p>\s?<\/p>/gi,"");if(""===e||""===i){t.preventDefault();var s=$(this.opts.emptyHtml).get(0);this.$editor.html(s),this.focus()}}this.sync()},formatBlocks:function(t){this.browser("mozilla")&&this.isFocused()&&this.$editor.focus(),this.bufferSet();var e=this.getBlocks();this.selectionSave(),$.each(e,$.proxy(function(e,i){if("LI"!==i.tagName){var s=$(i).parent();if("p"===t){if("P"===i.tagName&&0!=s.size()&&"BLOCKQUOTE"===s[0].tagName||"BLOCKQUOTE"===i.tagName)return void this.formatQuote();if(this.opts.linebreaks){if(!i||0!=i.tagName.search(/H[1-6]/))return;$(i).replaceWith(i.innerHTML+"<br>")}else this.formatBlock(t,i)}else this.formatBlock(t,i)}},this)),this.selectionRestore(),this.sync()},formatBlock:function(t,e){if(e===!1&&(e=this.getBlock()),e===!1&&this.opts.linebreaks===!0)return this.execCommand("formatblock",t),!0;var i="";if("pre"!==t?i=$(e).contents():(i=$(e).html(),""===$.trim(i)&&(i='<span id="selection-marker-1"></span>')),"PRE"===e.tagName&&(t="p"),this.opts.linebreaks===!0&&"p"===t)$(e).replaceWith($("<div>").append(i).html()+"<br>");else{var s=this.getParent(),n=$("<"+t+">").append(i);$(e).replaceWith(n),s&&"TD"==s.tagName&&$(n).wrapAll("<td>")}},formatChangeTag:function(t,e,i){i!==!1&&this.selectionSave();var s=$("<"+e+"/>");return $(t).replaceWith(function(){return s.append($(this).contents())}),i!==!1&&this.selectionRestore(),s},formatQuote:function(){if(this.browser("mozilla")&&this.isFocused()&&this.$editor.focus(),this.bufferSet(),this.opts.linebreaks===!1){this.selectionSave();var t=this.getBlocks(),e=!1,i=t.length;if(t){var s="",n="",r=!1,a=!0;if($.each(t,function(t,e){"P"!==e.tagName&&(a=!1)}),$.each(t,$.proxy(function(o,l){if("BLOCKQUOTE"===l.tagName)this.formatBlock("p",l,!1);else if("P"===l.tagName)if(e=$(l).parent(),"BLOCKQUOTE"==e[0].tagName){var h=$(e).children("p").size();1==h?$(e).replaceWith(l):h==i?(r="blockquote",s+=this.outerHtml(l)):(r="html",s+=this.outerHtml(l),0==o?($(l).addClass("redactor-replaced").empty(),n=this.outerHtml(l)):$(l).remove())}else a===!1||1==t.length?this.formatBlock("blockquote",l,!1):(r="paragraphs",s+=this.outerHtml(l));else"LI"!==l.tagName&&this.formatBlock("blockquote",l,!1)},this)),r)if("paragraphs"==r)$(t[0]).replaceWith("<blockquote>"+s+"</blockquote>"),$(t).remove();else if("blockquote"==r)$(e).replaceWith(s);else if("html"==r){var o=this.$editor.html().replace(n,"</blockquote>"+s+"<blockquote>");this.$editor.html(o),this.$editor.find("blockquote").each(function(){""==$.trim($(this).html())&&$(this).remove()})}}this.selectionRestore()}else{var l=this.getBlock();if("BLOCKQUOTE"===l.tagName){this.selectionSave();var o=$.trim($(l).html()),h=$.trim(this.getSelectionHtml());if(o=o.replace(/<span(.*?)id="selection-marker(.*?)<\/span>/gi,""),o==h)$(l).replaceWith($(l).html()+"<br>");else{this.inlineFormat("tmp");var c=this.$editor.find("tmp");c.empty();var d=this.$editor.html().replace("<tmp></tmp>",'</blockquote><span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"+h+"<blockquote>");this.$editor.html(d),c.remove(),this.$editor.find("blockquote").each(function(){""==$.trim($(this).html())&&$(this).remove()})}this.selectionRestore(),this.$editor.find("span#selection-marker-1").attr("id",!1)}else{var p=this.selectionWrap("blockquote"),o=$(p).html(),u=["ul","ol","table","tr","tbody","thead","tfoot","dl"];$.each(u,function(t,e){o=o.replace(new RegExp("<"+e+"(.*?)>","gi"),""),o=o.replace(new RegExp("</"+e+">","gi"),"")});var f=this.opts.blockLevelElements;$.each(f,function(t,e){o=o.replace(new RegExp("<"+e+"(.*?)>","gi"),""),o=o.replace(new RegExp("</"+e+">","gi"),"<br>")}),$(p).html(o),this.selectionElement(p);var g=$(p).next();0!=g.size()&&"BR"===g[0].tagName&&g.remove()}}this.sync()},blockRemoveAttr:function(t,e){var i=this.getBlocks();$(i).removeAttr(t),this.sync()},blockSetAttr:function(t,e){var i=this.getBlocks();$(i).attr(t,e),this.sync()},blockRemoveStyle:function(t){var e=this.getBlocks();$(e).css(t,""),this.removeEmptyAttr(e,"style"),this.sync()},blockSetStyle:function(t,e){var i=this.getBlocks();$(i).css(t,e),this.sync()},blockRemoveClass:function(t){var e=this.getBlocks();$(e).removeClass(t),this.removeEmptyAttr(e,"class"),this.sync()},blockSetClass:function(t){var e=this.getBlocks();$(e).addClass(t),this.sync()},inlineRemoveClass:function(t){this.selectionSave(),this.inlineEachNodes(function(e){$(e).removeClass(t),this.removeEmptyAttr(e,"class")}),this.selectionRestore(),this.sync()},inlineSetClass:function(t){var e=this.getCurrent();$(e).hasClass(t)||this.inlineMethods("addClass",t)},inlineRemoveStyle:function(t){this.selectionSave(),this.inlineEachNodes(function(e){$(e).css(t,""),this.removeEmptyAttr(e,"style")}),this.selectionRestore(),this.sync()},inlineSetStyle:function(t,e){this.inlineMethods("css",t,e)},inlineRemoveAttr:function(t){this.selectionSave();var e=this.getRange(),i=this.getElement(),s=this.getNodes();(e.collapsed||e.startContainer===e.endContainer&&i)&&(s=$(i)),$(s).removeAttr(t),this.inlineUnwrapSpan(),this.selectionRestore(),this.sync()},inlineSetAttr:function(t,e){this.inlineMethods("attr",t,e)},inlineMethods:function(t,e,i){this.bufferSet(),this.selectionSave();var s=this.getRange(),n=this.getElement();if(!s.collapsed&&s.startContainer!==s.endContainer||!n||this.nodeTestBlocks(n)){var r,a=i;switch(e){case"font-size":r="fontSize",a=4;break;case"font-family":r="fontName";break;case"color":r="foreColor";break;case"background-color":r="backColor"}this.document.execCommand(r,!1,a);var o=this.$editor.find("font");$.each(o,$.proxy(function(s,n){this.inlineSetMethods(t,n,e,i)},this))}else $(n)[t](e,i);this.selectionRestore(),this.sync()},inlineSetMethods:function(t,e,i,s){var n,r=$(e).parent(),a=this.getSelectionText(),o=$(r).text(),l=a==o;return l&&r&&"INLINE"===r[0].tagName&&0!=r[0].attributes.length?(n=r,$(e).replaceWith($(e).html())):(n=$("<inline>").append($(e).contents()),$(e).replaceWith(n)),$(n)[t](i,s),n},inlineEachNodes:function(t){var e,i=this.getRange(),s=this.getElement(),n=this.getNodes();(i.collapsed||i.startContainer===i.endContainer&&s)&&(n=$(s),e=!0),$.each(n,$.proxy(function(i,s){if(!e&&"INLINE"!==s.tagName){var n=this.getSelectionText(),r=$(s).parent().text(),a=n==r;if(!a||"INLINE"!==s.parentNode.tagName||$(s.parentNode).hasClass("redactor_editor"))return;s=s.parentNode}t.call(this,s)},this))},inlineUnwrapSpan:function(){var t=this.$editor.find("inline");$.each(t,$.proxy(function(t,e){var i=$(e);void 0===i.attr("class")&&void 0===i.attr("style")&&i.contents().unwrap()},this))},inlineFormat:function(t){this.selectionSave(),this.document.execCommand("fontSize",!1,4);var e,i=this.$editor.find("font");$.each(i,function(i,s){var n=$("<"+t+"/>").append($(s).contents());$(s).replaceWith(n),e=n}),this.selectionRestore(),this.sync()},inlineRemoveFormat:function(t){this.selectionSave();var e=t.toUpperCase(),i=this.getNodes(),s=$(this.getParent()).parent();$.each(i,function(t,i){i.tagName===e&&this.inlineRemoveFormatReplace(i)}),s&&s[0].tagName===e&&this.inlineRemoveFormatReplace(s),this.selectionRestore(),this.sync()},inlineRemoveFormatReplace:function(t){$(t).replaceWith($(t).contents())},insertHtml:function(t,e){var i=this.getCurrent(),s=i.parentNode;this.focusWithSaveScroll(),this.bufferSet();var n=$("<div>").append($.parseHTML(t));t=n.html(),t=this.cleanRemoveEmptyTags(t),n=$("<div>").append($.parseHTML(t));var r=this.getBlock();if(1==n.contents().length){var a=n.contents()[0].tagName;("P"!=a&&a==r.tagName||"PRE"==a)&&(n=$("<div>").append(t))}this.opts.linebreaks&&(t=t.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),!this.opts.linebreaks&&1==n.contents().length&&3==n.contents()[0].nodeType&&(this.getRangeSelectedNodes().length>2||!i||"BODY"==i.tagName&&!s||"HTML"==s.tagName)&&(t="<p>"+t+"</p>"),t=this.setSpansVerifiedHtml(t),n.contents().length>1&&r||n.contents().is("p, :header, ul, ol, li, div, table, td, blockquote, pre, address, section, header, footer, aside, article")?this.browser("msie")?this.isIe11()?this.execPasteFrag(t):this.document.selection.createRange().pasteHTML(t):this.document.execCommand("inserthtml",!1,t):this.insertHtmlAdvanced(t,!1),this.selectall&&this.window.setTimeout($.proxy(function(){this.opts.linebreaks?this.focusEnd():this.selectionEnd(this.$editor.contents().last())},this),1),this.observeStart(),this.setNonEditable(),e!==!1&&this.sync()},insertHtmlAdvanced:function(t,e){t=this.setSpansVerifiedHtml(t);var i=this.getSelection();if(i.getRangeAt&&i.rangeCount){var s=i.getRangeAt(0);s.deleteContents();var n=this.document.createElement("div");n.innerHTML=t;for(var r,a,o=this.document.createDocumentFragment();r=n.firstChild;)a=o.appendChild(r);s.insertNode(o),a&&(s=s.cloneRange(),s.setStartAfter(a),s.collapse(!0),i.removeAllRanges(),i.addRange(s))}e!==!1&&this.sync()},insertBeforeCursor:function(t){t=this.setSpansVerifiedHtml(t);var e=$(t),i=document.createElement("span");i.innerHTML="â";var s=this.getRange();s.insertNode(i),s.insertNode(e[0]),s.collapse(!1);var n=this.getSelection();n.removeAllRanges(),n.addRange(s),this.sync()},insertText:function(t){var e=$($.parseHTML(t));e.length&&(t=e.text()),this.focusWithSaveScroll(),this.browser("msie")?this.isIe11()?this.execPasteFrag(t):this.document.selection.createRange().pasteHTML(t):this.document.execCommand("inserthtml",!1,t),this.sync()},insertNode:function(t){if(t=t[0]||t,"SPAN"==t.tagName){var e="inline",i=t.outerHTML,s=new RegExp("<"+t.tagName,"i"),n=i.replace(s,"<"+e);s=new RegExp("</"+t.tagName,"i"),n=n.replace(s,"</"+e),t=$(n)[0]}var r=this.getSelection();return r.getRangeAt&&r.rangeCount&&(range=r.getRangeAt(0),range.deleteContents(),range.insertNode(t),range.setEndAfter(t),range.setStartAfter(t),r.removeAllRanges(),r.addRange(range)),t},insertNodeToCaretPositionFromPoint:function(t,e){var i,s=t.clientX,n=t.clientY;if(this.document.caretPositionFromPoint){var r=this.document.caretPositionFromPoint(s,n);i=this.getRange(),i.setStart(r.offsetNode,r.offset),i.collapse(!0),i.insertNode(e)}else if(this.document.caretRangeFromPoint)i=this.document.caretRangeFromPoint(s,n),i.insertNode(e);else if("undefined"!=typeof document.body.createTextRange){i=this.document.body.createTextRange(),i.moveToPoint(s,n);var a=i.duplicate();a.moveToPoint(s,n),i.setEndPoint("EndToEnd",a),i.select()}},insertAfterLastElement:function(t,e){if("undefined"!=typeof e&&(t=e),this.isEndOfElement()){if(this.opts.linebreaks){var i=$("<div>").append($.trim(this.$editor.html())).contents(),s=i.last()[0];if("SPAN"==s.tagName&&""==s.innerHTML&&(s=i.prev()[0]),this.outerHtml(s)!=this.outerHtml(t))return!1}else if(this.$editor.contents().last()[0]!==t)return!1;this.insertingAfterLastElement(t)}},insertingAfterLastElement:function(t){if(this.bufferSet(),this.opts.linebreaks===!1){var e=$(this.opts.emptyHtml);$(t).after(e),this.selectionStart(e)}else{var e=$('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>",this.document)[0];$(t).after(e),$(e).after(this.opts.invisibleSpace),this.selectionRestore(),this.$editor.find("span#selection-marker-1").removeAttr("id")}},insertLineBreak:function(t){this.selectionSave();var e="<br>";if(1==t&&(e="<br><br>"),this.browser("mozilla")){var i=$("<span>").html(this.opts.invisibleSpace);this.$editor.find("#selection-marker-1").before(e).before(i).before(this.opts.invisibleSpace),this.setCaretAfter(i[0]),i.remove(),this.selectionRemoveMarkers()}else{var s=this.getParent();if(s&&"A"===s.tagName){var n=this.getCaretOffset(s),r=$.trim($(s).text()).replace(/\n\r\n/g,""),a=r.length;if(n==a){this.selectionRemoveMarkers();var o=$('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>",this.document)[0];return $(s).after(o),$(o).before(e+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore(),!0}}this.$editor.find("#selection-marker-1").before(e+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()}},insertDoubleLineBreak:function(){this.insertLineBreak(!0)},replaceLineBreak:function(t){var e=$("<br>"+this.opts.invisibleSpace);$(t).replaceWith(e),this.selectionStart(e)},pasteClean:function(t){if(t=this.callback("pasteBefore",!1,t),this.browser("msie")){var e=$.trim(t);0==e.search(/^<a(.*?)>(.*?)<\/a>$/i)&&(t=t.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2"))}if(this.opts.pastePlainText){var e=this.document.createElement("div");return t=t.replace(/<br>|<\/H[1-6]>|<\/p>|<\/div>/gi,"\n"),e.innerHTML=t,t=e.textContent||e.innerText,t=$.trim(t),t=t.replace("\n","<br>"),t=this.cleanParagraphy(t),this.pasteInsert(t),!1}var i=!1;if(this.currentOrParentIs("TD")){i=!0;var s=this.opts.blockLevelElements;s.push("tr"),s.push("table"),$.each(s,function(e,i){t=t.replace(new RegExp("<"+i+"(.*?)>","gi"),""),t=t.replace(new RegExp("</"+i+">","gi"),"<br>")})}if(this.currentOrParentIs("PRE"))return t=this.pastePre(t),this.pasteInsert(t),!0;if(t=t.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),t=t.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>"),t=t.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>"),t=t.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>"),t=t.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>"),t=t.replace(/Â·/g,""),t=t.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),this.opts.cleanSpaces===!0&&(t=t.replace(/(&nbsp;){2,}/gi,"&nbsp;"),t=t.replace(/&nbsp;/gi," ")),t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),t=t.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),t=t.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),t=t.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),t=t.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),t=t.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),t=t.replace(/<td>\u200b*<\/td>/gi,"[td]"),t=t.replace(/<td>&nbsp;<\/td>/gi,"[td]"),t=t.replace(/<td><br><\/td>/gi,"[td]"),t=t.replace(/<td(.*?)colspan="(.*?)"(.*?)>([\w\W]*?)<\/td>/gi,'[td colspan="$2"]$4[/td]'),t=t.replace(/<td(.*?)rowspan="(.*?)"(.*?)>([\w\W]*?)<\/td>/gi,'[td rowspan="$2"]$4[/td]'),t=t.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),t=t.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),t=t.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),t=t.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),t=t.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),t=t.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),t=t.replace(/<param(.*?)>/gi,"[param$1]"),t=t.replace(/<img(.*?)>/gi,"[img$1]"),t=t.replace(/ class="(.*?)"/gi,""),t=t.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),this.opts.linebreaks?(t=t.replace(/<strong><\/strong>/gi,""),t=t.replace(/<u><\/u>/gi,""),this.opts.cleanFontTag&&(t=t.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2")),t=t.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"<br>")):t=t.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),t=t.replace(/<div>\s*?\t*?\n*?(<ul>|<ol>|<p>)/gi,"$1"),t=t.replace(/\[td colspan="(.*?)"\]([\w\W]*?)\[\/td\]/gi,'<td colspan="$1">$2</td>'),t=t.replace(/\[td rowspan="(.*?)"\]([\w\W]*?)\[\/td\]/gi,'<td rowspan="$1">$2</td>'),t=t.replace(/\[td\]/gi,"<td>&nbsp;</td>"),t=t.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),t=t.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),t=t.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),t=t.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),t=t.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),t=t.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),t=t.replace(/\[param(.*?)\]/gi,"<param$1>"),t=t.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs?(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"),t=t.replace(/<\/div><p>/gi,"<p>"),t=t.replace(/<\/p><\/div>/gi,"</p>"),t=t.replace(/<p><\/p>/gi,"<br />")):t=t.replace(/<div><\/div>/gi,"<br />"),t=this.cleanStripTags(t),this.currentOrParentIs("LI")?t=t.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br>"):i===!1&&(t=this.cleanParagraphy(t)),
t=t.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),t=t.replace(/<img>/gi,""),t=t.replace(/<[^\/>][^>][^img|param|source|td][^<]*>(\s*|\t*|\n*| |<br>)<\/[^>]+>/gi,""),t=t.replace(/\n{3,}/gi,"\n"),t=t.replace(/<p><p>/gi,"<p>"),t=t.replace(/<\/p><\/p>/gi,"</p>"),t=t.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),t=t.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),this.opts.linebreaks===!0&&(t=t.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),t=t.replace(/<[^\/>][^>][^img|param|source|td][^<]*>(\s*|\t*|\n*| |<br>)<\/[^>]+>/gi,""),t=t.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),t=t.replace(/<td(.*?)>(\s*|\t*|\n*)<p>([\w\W]*?)<\/p>(\s*|\t*|\n*)<\/td>/gi,"<td$1>$3</td>"),this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2"),t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2")),this.pasteClipboardMozilla=!1,this.browser("mozilla")){if(this.opts.clipboardUpload){var n=t.match(/<img src="data:image(.*?)"(.*?)>/gi);if(null!==n){this.pasteClipboardMozilla=n;for(k in n){var r=n[k].replace("<img",'<img data-mozilla-paste-image="'+k+'" ');t=t.replace(n[k],r)}}}for(;/<br>$/gi.test(t);)t=t.replace(/<br>$/gi,"")}if(t=t.replace(/<p>â¢([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.browser("msie"))for(;/<font>([\w\W]*?)<\/font>/gi.test(t);)t=t.replace(/<font>([\w\W]*?)<\/font>/gi,"$1");i===!1&&(t=t.replace(/<td(.*?)>([\w\W]*?)<p(.*?)>([\w\W]*?)<\/td>/gi,"<td$1>$2$4</td>"),t=t.replace(/<td(.*?)>([\w\W]*?)<\/p>([\w\W]*?)<\/td>/gi,"<td$1>$2$3</td>"),t=t.replace(/<td(.*?)>([\w\W]*?)<p(.*?)>([\w\W]*?)<\/td>/gi,"<td$1>$2$4</td>"),t=t.replace(/<td(.*?)>([\w\W]*?)<\/p>([\w\W]*?)<\/td>/gi,"<td$1>$2$3</td>")),t=t.replace(/\n/g," "),t=t.replace(/<p>\n?<li>/gi,"<li>"),this.pasteInsert(t)},pastePre:function(t){t=t.replace(/<br>|<\/H[1-6]>|<\/p>|<\/div>/gi,"\n");var e=this.document.createElement("div");return e.innerHTML=t,this.cleanEncodeEntities(e.textContent||e.innerText)},pasteInsert:function(t){t=this.callback("pasteAfter",!1,t),this.selectall?(this.$editor.html(t),this.selectionRemove(),this.focusEnd(),this.sync()):this.insertHtml(t),this.selectall=!1,setTimeout($.proxy(function(){this.rtePaste=!1,this.browser("mozilla")&&this.$editor.find("p:empty").remove(),this.pasteClipboardMozilla!==!1&&this.pasteClipboardUploadMozilla()},this),100),this.opts.autoresize&&this.fullscreen!==!0?$(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},pasteClipboardAppendFields:function(t){return this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&$.each(this.opts.uploadFields,$.proxy(function(e,i){null!=i&&0===i.toString().indexOf("#")&&(i=$(i).val()),t[e]=i},this)),t},pasteClipboardUploadMozilla:function(){var t=this.$editor.find("img[data-mozilla-paste-image]");$.each(t,$.proxy(function(t,e){var i=$(e),s=e.src.split(","),n={contentType:s[0].split(";")[0].split(":")[1],data:s[1]};n=this.pasteClipboardAppendFields(n),$.post(this.opts.clipboardUploadUrl,n,$.proxy(function(t){var e="string"==typeof t?$.parseJSON(t):t;i.attr("src",e.filelink),i.removeAttr("data-mozilla-paste-image"),this.sync(),this.callback("imageUpload",i,e)},this))},this))},pasteClipboardUpload:function(t){var e=t.target.result,i=e.split(","),s={contentType:i[0].split(";")[0].split(":")[1],data:i[1]};this.opts.clipboardUpload?(s=this.pasteClipboardAppendFields(s),$.post(this.opts.clipboardUploadUrl,s,$.proxy(function(t){var e="string"==typeof t?$.parseJSON(t):t,i='<img src="'+e.filelink+'" id="clipboard-image-marker" />';this.execCommand("inserthtml",i,!1);var s=$(this.$editor.find("img#clipboard-image-marker"));s.length?s.removeAttr("id"):s=!1,this.sync(),s&&this.callback("imageUpload",s,e)},this))):this.insertHtml('<img src="'+e+'" />')},bufferSet:function(t){t!==!1&&this.selectionSave(),this.opts.buffer.push(this.$editor.html()),t!==!1&&this.selectionRemoveMarkers("buffer")},bufferUndo:function(){return 0===this.opts.buffer.length?void this.focusWithSaveScroll():(this.selectionSave(),this.opts.rebuffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.buffer.pop()),this.selectionRestore(),void setTimeout($.proxy(this.observeStart,this),100))},bufferRedo:function(){return 0===this.opts.rebuffer.length?(this.focusWithSaveScroll(),!1):(this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.rebuffer.pop()),this.selectionRestore(!0),void setTimeout($.proxy(this.observeStart,this),4))},observeStart:function(){this.observeImages(),this.opts.observeLinks&&this.observeLinks()},observeLinks:function(){this.$editor.find("a").on("click",$.proxy(this.linkObserver,this)),this.$editor.on("click.redactor",$.proxy(function(t){this.linkObserverTooltipClose(t)},this)),$(document).on("click.redactor",$.proxy(function(t){this.linkObserverTooltipClose(t)},this))},observeImages:function(){return this.opts.observeImages===!1?!1:(this.$editor.find("img").each($.proxy(function(t,e){this.browser("msie")&&$(e).attr("unselectable","on");var i=$(e).parent();i.hasClass("royalSlider")||i.hasClass("fotorama")||this.imageResize(e)},this)),void this.$editor.find(".fotorama, .royalSlider").on("click",$.proxy(this.editGallery,this)))},linkObserver:function(t){var e=$(t.target),i=$(t.target).parent();if(!i.hasClass("royalSlider")&&!i.hasClass("fotorama")&&0!=e.size()&&"A"===e[0].tagName){var s=e.offset();if(this.opts.iframe){var n=this.$frame.offset();s.top=n.top+(s.top-$(this.document).scrollTop()),s.left+=n.left}var r=$('<span class="redactor-link-tooltip"></span>'),a=e.attr("href");void 0===a&&(a=""),a.length>24&&(a=a.substring(0,24)+"...");var o=$('<a href="'+e.attr("href")+'" target="_blank">'+a+"</a>").on("click",$.proxy(function(t){this.linkObserverTooltipClose(!1)},this)),l=$('<a href="#">'+this.opts.curLang.edit+"</a>").on("click",$.proxy(function(t){t.preventDefault(),this.linkShow(),this.linkObserverTooltipClose(!1)},this)),h=$('<a href="#">'+this.opts.curLang.unlink+"</a>").on("click",$.proxy(function(t){t.preventDefault(),this.execCommand("unlink"),this.linkObserverTooltipClose(!1)},this));r.append(o),r.append(" | "),r.append(l),r.append(" | "),r.append(h),r.css({top:s.top+20+"px",left:s.left+"px"}),$(".redactor-link-tooltip").remove(),$("body").append(r)}},linkObserverTooltipClose:function(t){return t!==!1&&"A"==t.target.tagName?!1:void $(".redactor-link-tooltip").remove()},getSelection:function(){return this.opts.rangy?this.opts.iframe?rangy.getSelection(this.$frame[0]):rangy.getSelection():this.document.getSelection()},getRange:function(){if(this.opts.rangy)return this.opts.iframe?rangy.createRange(this.iframeDoc()):rangy.createRange();if(this.document.getSelection){var t=this.getSelection();if(t.getRangeAt&&t.rangeCount)return t.getRangeAt(0)}return this.document.createRange()},selectionElement:function(t){this.setCaret(t)},selectionStart:function(t){this.selectionSet(t[0]||t,0,null,0)},selectionEnd:function(t){this.selectionSet(t[0]||t,1,null,1)},selectionSet:function(t,e,i,s){null==i&&(i=t),null==s&&(s=e);var n=this.getSelection();if(n){if("P"==t.tagName&&""==t.innerHTML&&(t.innerHTML=this.opts.invisibleSpace),"BR"==t.tagName&&this.opts.linebreaks===!1){var r=$(this.opts.emptyHtml)[0];$(t).replaceWith(r),t=r,i=t}var a=this.getRange();a.setStart(t,e),a.setEnd(i,s);try{n.removeAllRanges()}catch(o){}n.addRange(a)}},selectionWrap:function(t){t=t.toLowerCase();var e=this.getBlock();if(e){var i=this.formatChangeTag(e,t);return this.sync(),i}var s=this.getSelection(),n=s.getRangeAt(0),i=document.createElement(t);return i.appendChild(n.extractContents()),n.insertNode(i),this.selectionElement(i),i},selectionAll:function(){var t=this.getRange();t.selectNodeContents(this.$editor[0]);var e=this.getSelection();e.removeAllRanges(),e.addRange(t)},selectionRemove:function(){this.getSelection().removeAllRanges()},getCaretOffset:function(t){var e=0,i=this.getRange(),s=i.cloneRange();return s.selectNodeContents(t),s.setEnd(i.endContainer,i.endOffset),e=$.trim(s.toString()).length},getCaretOffsetRange:function(){return new Range(this.getSelection().getRangeAt(0))},setCaret:function(t,e,i){"undefined"==typeof i&&(i=e),t=t[0]||t;var s=this.getRange();s.selectNodeContents(t);var n,r=this.getTextNodesIn(t),a=!1,o=0;if(1==r.length&&e)s.setStart(r[0],e),s.setEnd(r[0],i);else for(var l,h=0;l=r[h++];){if(n=o+l.length,!a&&e>=o&&(n>e||e==n&&h<r.length)&&(s.setStart(l,e-o),a=!0),a&&n>=i){s.setEnd(l,i-o);break}o=n}var c=this.getSelection();c.removeAllRanges(),c.addRange(s)},setCaretAfter:function(t){this.$editor.focus(),t=t[0]||t;var e=this.document.createRange(),i=1,s=-1;e.setStart(t,i),e.setEnd(t,s+2);var n=this.window.getSelection(),r=this.document.createRange(),a=this.document.createTextNode("â");$(t).after(a),r.setStartAfter(a),n.removeAllRanges(),n.addRange(r),$(a).remove()},getTextNodesIn:function(t){var e=[];if(3==t.nodeType)e.push(t);else for(var i=t.childNodes,s=0,n=i.length;n>s;++s)e.push.apply(e,this.getTextNodesIn(i[s]));return e},getCurrent:function(){var t=!1,e=this.getSelection();return e&&e.rangeCount>0&&(t=e.getRangeAt(0).startContainer),this.isParentRedactor(t)},getParent:function(t){return t=t||this.getCurrent(),t?this.isParentRedactor($(t).parent()[0]):!1},getBlock:function(t){for("undefined"==typeof t&&(t=this.getCurrent());t;){if(this.nodeTestBlocks(t))return $(t).hasClass("redactor_editor")?!1:t;t=t.parentNode}return!1},getBlocks:function(t){var e=[];if("undefined"==typeof t){var i=this.getRange();if(i&&i.collapsed===!0)return[this.getBlock()];var t=this.getNodes(i)}return $.each(t,$.proxy(function(t,i){return this.opts.iframe===!1&&0==$(i).parents("div.redactor_editor").size()?!1:void(this.nodeTestBlocks(i)&&e.push(i))},this)),0===e.length&&(e=[this.getBlock()]),e},isInlineNode:function(t){return 1!=t.nodeType?!1:!this.rTestBlock.test(t.nodeName)},nodeTestBlocks:function(t){return 1==t.nodeType&&this.rTestBlock.test(t.nodeName)},tagTestBlock:function(t){return this.rTestBlock.test(t)},getNodes:function(t,e){if("undefined"==typeof t||0==t)var t=this.getRange();if(t&&t.collapsed===!0){if("undefined"==typeof e&&this.tagTestBlock(e)){var i=this.getBlock();return i.tagName==e?[i]:[]}return[this.getCurrent()]}var s=[],n=[],r=this.document.getSelection();if(r.isCollapsed||(s=this.getRangeSelectedNodes(r.getRangeAt(0))),$.each(s,$.proxy(function(t,i){return this.opts.iframe===!1&&0==$(i).parents("div.redactor_editor").size()?!1:void("undefined"==typeof e?""!=$.trim(i.textContent)&&n.push(i):i.tagName==e&&n.push(i))},this)),0==n.length){if("undefined"==typeof e&&this.tagTestBlock(e)){var i=this.getBlock();return i.tagName==e?n.push(i):[]}n.push(this.getCurrent())}var a=n[n.length-1];return this.nodeTestBlocks(a)&&(n=n.slice(0,-1)),n},getElement:function(t){for(t||(t=this.getCurrent());t;){if(1==t.nodeType)return $(t).hasClass("redactor_editor")?!1:t;t=t.parentNode}return!1},getRangeSelectedNodes:function(t){t=t||this.getRange();var e=t.startContainer,i=t.endContainer;if(e==i)return[e];for(var s=[];e&&e!=i;)s.push(e=this.nextNode(e));for(e=t.startContainer;e&&e!=t.commonAncestorContainer;)s.unshift(e),e=e.parentNode;return s},nextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},getSelectionText:function(){return this.getSelection().toString()},getSelectionHtml:function(){var t="",e=this.getSelection();if(e.rangeCount){for(var i=this.document.createElement("div"),s=e.rangeCount,n=0;s>n;++n)i.appendChild(e.getRangeAt(n).cloneContents());t=i.innerHTML}return this.syncClean(t)},selectionSave:function(){this.isFocused()||this.focusWithSaveScroll(),this.opts.rangy?this.savedSel=rangy.saveSelection():this.selectionCreateMarker(this.getRange())},selectionCreateMarker:function(t,e){if(t){var i=$('<span id="selection-marker-1" class="redactor-selection-marker">'+this.opts.invisibleSpace+"</span>",this.document)[0],s=$('<span id="selection-marker-2" class="redactor-selection-marker">'+this.opts.invisibleSpace+"</span>",this.document)[0];t.collapsed===!0?this.selectionSetMarker(t,i,!0):(this.selectionSetMarker(t,i,!0),this.selectionSetMarker(t,s,!1)),this.savedSel=this.$editor.html(),this.selectionRestore(!1,!1)}},selectionSetMarker:function(t,e,i){var s=t.cloneRange();try{s.collapse(i),s.insertNode(e),s.detach()}catch(n){var r=this.opts.emptyHtml;this.opts.linebreaks&&(r="<br>"),this.$editor.prepend(r),this.focus()}},selectionRestore:function(t,e){if(this.opts.rangy)rangy.restoreSelection(this.savedSel);else{t===!0&&this.savedSel&&this.$editor.html(this.savedSel);var i=this.$editor.find("span#selection-marker-1"),s=this.$editor.find("span#selection-marker-2");this.browser("mozilla")?this.$editor.focus():this.isFocused()||this.focusWithSaveScroll(),0!=i.length&&0!=s.length?this.selectionSet(i[0],0,s[0],0):0!=i.length&&this.selectionSet(i[0],0,null,0),e!==!1&&(this.selectionRemoveMarkers(),this.savedSel=!1)}},selectionRemoveMarkers:function(t){this.opts.rangy?rangy.removeMarkers(this.savedSel):$.each(this.$editor.find("span.redactor-selection-marker"),function(){var t=$.trim($(this).html().replace(/[^\u0000-\u1C7F]/g,""));""==t?$(this).remove():$(this).removeAttr("class").removeAttr("id")})},tableShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.table,this.opts.modal_table,300,$.proxy(function(){$("#redactor_insert_table_btn").click($.proxy(this.tableInsert,this)),setTimeout(function(){$("#redactor_table_rows").focus()},200)},this))},tableInsert:function(){this.bufferSet(!1);var t,e,i,s,n=$("#redactor_table_rows").val(),r=$("#redactor_table_columns").val(),a=$("<div></div>"),o=Math.floor(99999*Math.random()),l=$('<table id="table'+o+'"><tbody></tbody></table>');for(t=0;n>t;t++){for(e=$("<tr></tr>"),i=0;r>i;i++)s=$("<td>"+this.opts.invisibleSpace+"</td>"),0===t&&0===i&&s.append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),$(e).append(s);l.append(e)}a.append(l);var h=a.html();this.opts.linebreaks===!1&&this.browser("mozilla")&&(h+="<p>"+this.opts.invisibleSpace+"</p>"),this.modalClose(),this.selectionRestore();var c=this.getBlock()||this.getCurrent();if(c&&"BODY"!=c.tagName){if("LI"==c.tagName)var c=$(c).closest("ul, ol");$(c).after(h)}else this.insertHtmlAdvanced(h,!1);this.selectionRestore();var d=this.$editor.find("#table"+o);this.buttonActiveObserver(),d.find("span#selection-marker-1, inline#selection-marker-1").remove(),d.removeAttr("id"),this.sync()},tableDeleteTable:function(){var t=$(this.getParent()).closest("table");return this.isParentRedactor(t)?0==t.size()?!1:(this.bufferSet(),t.remove(),void this.sync()):!1},tableDeleteRow:function(){var t=this.getParent(),e=$(t).closest("table");if(!this.isParentRedactor(e))return!1;if(0==e.size())return!1;this.bufferSet();var i=$(t).closest("tr"),s=i.prev().length?i.prev():i.next();if(s.length){var n=s.children("td").first();n.length&&n.prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>")}i.remove(),this.selectionRestore(),e.find("span#selection-marker-1").remove(),this.sync()},tableDeleteColumn:function(){var t=this.getParent(),e=$(t).closest("table");if(!this.isParentRedactor(e))return!1;if(0==e.size())return!1;this.bufferSet();var i=$(t).closest("td");i.is("td")||(i=i.closest("td"));var s=i.get(0).cellIndex;e.find("tr").each($.proxy(function(t,e){var i=0>s-1?s+1:s-1;0===t&&$(e).find("td").eq(i).prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),$(e).find("td").eq(s).remove()},this)),this.selectionRestore(),e.find("span#selection-marker-1").remove(),this.sync()},tableAddHead:function(){var t=$(this.getParent()).closest("table");if(!this.isParentRedactor(t))return!1;if(0==t.size())return!1;if(this.bufferSet(),0!==t.find("thead").size())this.tableDeleteHead();else{var e=t.find("tr").first().clone();e.find("td").html(this.opts.invisibleSpace),$thead=$("<thead></thead>"),$thead.append(e),t.prepend($thead),this.sync()}},tableDeleteHead:function(){var t=$(this.getParent()).closest("table");if(!this.isParentRedactor(t))return!1;var e=t.find("thead");return 0==e.size()?!1:(this.bufferSet(),e.remove(),void this.sync())},tableAddRowAbove:function(){this.tableAddRow("before")},tableAddRowBelow:function(){this.tableAddRow("after")},tableAddColumnLeft:function(){this.tableAddColumn("before")},tableAddColumnRight:function(){this.tableAddColumn("after")},tableAddRow:function(t){var e=$(this.getParent()).closest("table");if(!this.isParentRedactor(e))return!1;if(0==e.size())return!1;this.bufferSet();var i=$(this.getParent()).closest("tr"),s=i.clone();s.find("td").html(this.opts.invisibleSpace),"after"===t?i.after(s):i.before(s),this.sync()},tableAddColumn:function(t){var e=this.getParent(),i=$(e).closest("table");if(!this.isParentRedactor(i))return!1;if(0==i.size())return!1;this.bufferSet();var s=0,n=this.getCurrent(),r=$(n).closest("tr"),a=$(n).closest("td");r.find("td").each($.proxy(function(t,e){$(e)[0]===a[0]&&(s=t)},this)),i.find("tr").each($.proxy(function(e,i){var n=$(i).find("td").eq(s),r=n.clone();r.html(this.opts.invisibleSpace),"after"===t?n.after(r):n.before(r)},this)),this.sync()},videoShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.video,this.opts.modal_video,600,$.proxy(function(){$("#redactor_insert_video_btn").click($.proxy(this.videoInsert,this)),setTimeout(function(){$("#redactor_insert_video_area").focus()},200)},this))},videoInsert:function(){var t=$("#redactor_insert_video_area").val();t=this.cleanStripTags(t);var e='<iframe width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe>';t.match(reUrlYoutube)?t=t.replace(reUrlYoutube,e+"//www.youtube.com/embed/$1"+i):t.match(reUrlVimeo)&&(t=t.replace(reUrlVimeo,e+"//player.vimeo.com/video/$2"+i)),this.selectionRestore();var s=this.getBlock()||this.getCurrent();s?$(s).after(t):this.insertHtmlAdvanced(t,!1),this.sync(),this.modalClose()},linkShow:function(){this.selectionSave();var t=$.proxy(function(){if(this.opts.predefinedLinks!==!1){this.predefinedLinksStorage={};var t=this;$.getJSON(this.opts.predefinedLinks,function(e){var i=$("#redactor-predefined-links");i.html(""),$.each(e,function(e,s){t.predefinedLinksStorage[e]=s,i.append($("<option>").val(e).html(s.name))}),i.on("change",function(){var e=$(this).val(),i="",s="";0!=e&&(i=t.predefinedLinksStorage[e].name,s=t.predefinedLinksStorage[e].url),$("#redactor_link_url").val(s),$("#redactor_link_url_text").val(i)}),i.show()})}this.insert_link_node=!1;var e=this.getSelection(),i="",s="",n="",r=this.getParent(),a=$(r).parent().get(0);a&&"A"===a.tagName&&(r=a),r&&"A"===r.tagName?(i=r.href,s=$(r).text(),n=r.target,this.insert_link_node=r):s=e.toString(),$("#redactor_link_url_text").val(s);var o=self.location.href.replace(/\/$/i,"");if(i=i.replace(o,""),i=i.replace(/^\/#/,"#"),i=i.replace("mailto:",""),this.opts.linkProtocol===!1){var l=new RegExp("^(http|ftp|https)://"+self.location.host,"i");i=i.replace(l,"")}$("#redactor_link_url").val(i),"_blank"===n&&$("#redactor_link_blank").prop("checked",!0),this.linkInsertPressed=!1,$("#redactor_insert_link_btn").on("click",$.proxy(this.linkProcess,this)),setTimeout(function(){$("#redactor_link_url").focus()},200)},this);this.modalInit(this.opts.curLang.link,this.opts.modal_link,460,t)},linkProcess:function(){if(!this.linkInsertPressed){this.linkInsertPressed=!0;var t="",e="",i=$("#redactor_link_url").val(),s=$("#redactor_link_url_text").val();if(-1!=i.search("@")&&/(http|ftp|https):\/\//i.test(i)===!1)i="mailto:"+i;else if(0!=i.search("#")){$("#redactor_link_blank").prop("checked")&&(t=' target="_blank"',e="_blank");var n="((xn--)?[a-z0-9]+(-[a-z0-9]+)*.)+[a-z]{2,}",r=new RegExp("^(http|ftp|https)://"+n,"i"),a=new RegExp("^"+n,"i");-1==i.search(r)&&0==i.search(a)&&this.opts.linkProtocol&&(i=this.opts.linkProtocol+i)}s=s.replace(/<|>/g,"");var o="&nbsp;";this.browser("mozilla")&&(o="&nbsp;"),this.linkInsert('<a href="'+i+'"'+t+">"+s+"</a>"+o,$.trim(s),i,e)}},linkInsert:function(t,e,i,s){if(this.selectionRestore(),""!==e){if(this.insert_link_node)this.bufferSet(),$(this.insert_link_node).text(e).attr("href",i),""!==s?$(this.insert_link_node).attr("target",s):$(this.insert_link_node).removeAttr("target");else{var n=$(t).addClass("redactor-added-link");this.exec("inserthtml",this.outerHtml(n),!1);var i=this.$editor.find("a.redactor-added-link");i.removeAttr("style").removeClass("redactor-added-link").each(function(){""==this.className&&$(this).removeAttr("class")})}this.sync()}setTimeout($.proxy(function(){this.opts.observeLinks&&this.observeLinks()},this),5),this.modalClose()},fileShow:function(){this.selectionSave();var t=$.proxy(function(){var t=this.getSelection(),e="";e=this.oldIE()?t.text:t.toString(),$("#redactor_filename").val(e),this.isMobile()||this.isIPad()||this.draguploadInit("#redactor_file",{url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:$.proxy(this.fileCallback,this),error:$.proxy(function(t,e){this.callback("fileUploadError",e)},this),uploadParam:this.opts.fileUploadParam}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:$.proxy(this.fileCallback,this),error:$.proxy(function(t,e){this.callback("fileUploadError",e)},this)})},this);this.modalInit(this.opts.curLang.file,this.opts.modal_file,500,t)},fileCallback:function(t){if(this.selectionRestore(),t!==!1){var e=$("#redactor_filename").val();""===e&&(e=t.filename);var i='<a href="'+t.filelink+'" id="filelink-marker">'+e+"</a>";this.browser("webkit")&&this.window.chrome&&(i+="&nbsp;"),this.execCommand("inserthtml",i,!1);var s=$(this.$editor.find("a#filelink-marker"));0!=s.size()?s.removeAttr("id"):s=!1,this.sync(),this.callback("fileUpload",s,t)}this.modalClose()},imageShow:function(){this.selectionSave();var t=$.proxy(function(){this.opts.imageGetJson?$.getJSON(this.opts.imageGetJson,$.proxy(function(t){var e={},i=0;$.each(t,$.proxy(function(t,s){"undefined"!=typeof s.folder&&(i++,e[s.folder]=i)},this));var s=!1;if($.each(t,$.proxy(function(t,i){var n="";"undefined"!=typeof i.title&&(n=i.title);var r=0;$.isEmptyObject(e)||"undefined"==typeof i.folder||(r=e[i.folder],s===!1&&(s=".redactorfolder"+r));var a=$('<img src="'+i.thumb+'" class="redactorfolder redactorfolder'+r+'" rel="'+i.image+'" title="'+n+'" />');$("#redactor_image_box").append(a),$(a).click($.proxy(this.imageThumbClick,this))},this)),!$.isEmptyObject(e)){$(".redactorfolder").hide(),$(s).show();var n=function(t){$(".redactorfolder").hide(),$(".redactorfolder"+$(t.target).val()).show()},r=$('<select id="redactor_image_box_select">');$.each(e,function(t,e){r.append($('<option value="'+e+'">'+t+"</option>"))}),$("#redactor_image_box").before(r),r.change(n)}},this)):$("#redactor-tab-control-2").remove(),this.opts.imageUpload||this.opts.s3?(this.isMobile()||this.isIPad()||this.opts.s3!==!1||$("#redactor_file").length&&this.draguploadInit("#redactor_file",{url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:$.proxy(this.imageCallback,this),error:$.proxy(function(t,e){this.callback("imageUploadError",e)},this),uploadParam:this.opts.imageUploadParam}),this.opts.s3===!1?this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:$.proxy(this.imageCallback,this),error:$.proxy(function(t,e){this.callback("imageUploadError",e)},this)}):$("#redactor_file").on("change.redactor",$.proxy(this.s3handleFileSelect,this))):($(".redactor_tab").hide(),this.opts.imageGetJson?($("#redactor-tab-control-1").remove(),$("#redactor-tab-control-2").addClass("redactor_tabs_act"),$("#redactor_tab2").show()):($("#redactor_tabs").remove(),$("#redactor_tab3").show())),this.opts.imageTabLink||!this.opts.imageUpload&&!this.opts.imageGetJson||$("#redactor-tab-control-3").hide(),$("#redactor_upload_btn").click($.proxy(this.imageCallbackLink,this)),this.opts.imageUpload||this.opts.imageGetJson||setTimeout(function(){$("#redactor_file_link").focus()},200)},this);this.modalInit(this.opts.curLang.image,this.opts.modal_image,610,t)},imageEdit:function(t){var e=t,i=e.parent().parent(),s=$.proxy(function(){$("#redactor_file_alt").val(e.attr("alt")),$("#redactor_image_edit_src").attr("href",e.attr("src")),"block"==e.css("display")&&"none"==e.css("float")?$("#redactor_form_image_align").val("center"):$("#redactor_form_image_align").val(e.css("float")),"A"===$(i).get(0).tagName&&($("#redactor_file_link").val($(i).attr("href")),"_blank"==$(i).attr("target")&&$("#redactor_link_blank").prop("checked",!0)),$("#redactor_image_delete_btn").click($.proxy(function(){this.imageRemove(e)},this)),$("#redactorSaveBtn").click($.proxy(function(){this.imageSave(e)},this))},this);this.modalInit(this.opts.curLang.edit,this.opts.modal_image_edit,380,s)},imageRemove:function(t){var e=$(t).parent().parent(),i=$(t).parent(),s=!1;e.length&&"A"===e[0].tagName?(s=!0,$(e).remove()):i.length&&"A"===i[0].tagName?(s=!0,$(i).remove()):$(t).remove(),i.length&&"P"===i[0].tagName&&(this.focusWithSaveScroll(),s===!1&&this.selectionStart(i)),this.callback("imageDelete",t),this.modalClose(),this.sync()},imageSave:function(t){this.imageResizeHide(!1);var e=$(t),i=e.parent();e.attr("alt",$("#redactor_file_alt").val());var s=$("#redactor_form_image_align").val(),n="";"left"===s?(n="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0",e.css({"float":"left",margin:n})):"right"===s?(n="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin,e.css({"float":"right",margin:n})):"center"===s?e.css({"float":"",display:"block",margin:"auto"}):e.css({"float":"",display:"",margin:""});var r=$.trim($("#redactor_file_link").val());if(""!==r){var a=!1;if($("#redactor_link_blank").prop("checked")&&(a=!0),"A"!==i.get(0).tagName){var o=$('<a href="'+r+'">'+this.outerHtml(t)+"</a>");a&&o.attr("target","_blank"),e.replaceWith(o)}else i.attr("href",r),a?i.attr("target","_blank"):i.removeAttr("target")}else"A"===i.get(0).tagName&&i.replaceWith(this.outerHtml(t));this.modalClose(),this.observeImages(),this.sync()},imageResizeHide:function(t){if(t!==!1&&0!=$(t.target).parent().size()&&"redactor-image-box"===$(t.target).parent()[0].id)return!1;var e=this.$editor.find("#redactor-image-box");return 0==e.size()?!1:(this.$editor.find("#redactor-image-editter, #redactor-image-resizer").remove(),e.find("img").css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight}),e.css("margin",""),e.find("img").css("opacity",""),e.replaceWith(function(){return $(this).contents()}),$(document).off("click.redactor-image-resize-hide"),this.$editor.off("click.redactor-image-resize-hide"),this.$editor.off("keydown.redactor-image-delete"),void this.sync())},imageResize:function(t){var e=$(t);e.on("mousedown",$.proxy(function(){this.imageResizeHide(!1)},this)),e.on("dragstart",$.proxy(function(){this.$editor.on("drop.redactor-image-inside-drop",$.proxy(function(){setTimeout($.proxy(function(){this.observeImages(),this.$editor.off("drop.redactor-image-inside-drop"),this.sync()},this),1)},this))},this)),e.on("click",$.proxy(function(t){if(0!=this.$editor.find("#redactor-image-box").size())return!1;var i,s,n=e.width()/e.height(),r=20,a=this.imageResizeControls(e),o=!1;a!==!1&&(a.on("mousedown",function(t){o=!0,t.preventDefault(),n=e.width()/e.height(),i=Math.round(t.pageX-e.eq(0).offset().left),s=Math.round(t.pageY-e.eq(0).offset().top)}),$(this.document.body).on("mousemove",$.proxy(function(t){if(o){var a=(Math.round(t.pageX-e.eq(0).offset().left)-i,Math.round(t.pageY-e.eq(0).offset().top)-s),l=e.height(),h=parseInt(l,10)+a,c=Math.round(h*n);c>r&&(e.width(c),100>c?this.imageEditter.css({marginTop:"-7px",marginLeft:"-13px",fontSize:"9px",padding:"3px 5px"}):this.imageEditter.css({marginTop:"-11px",marginLeft:"-18px",fontSize:"11px",padding:"7px 10px"})),i=Math.round(t.pageX-e.eq(0).offset().left),s=Math.round(t.pageY-e.eq(0).offset().top),this.sync()}},this)).on("mouseup",function(){o=!1})),this.$editor.on("keydown.redactor-image-delete",$.proxy(function(t){var i=t.which;(this.keyCode.BACKSPACE==i||this.keyCode.DELETE==i)&&(this.bufferSet(!1),this.imageResizeHide(!1),this.imageRemove(e))},this)),$(document).on("click.redactor-image-resize-hide",$.proxy(this.imageResizeHide,this)),this.$editor.on("click.redactor-image-resize-hide",$.proxy(this.imageResizeHide,this))},this))},imageResizeControls:function(t){var e=$('<span id="redactor-image-box" data-redactor="verified">');if(e.css({position:"relative",display:"inline-block",lineHeight:0,outline:"1px dashed rgba(0, 0, 0, .6)","float":t.css("float")}),e.attr("contenteditable",!1),"auto"!=t[0].style.margin?(e.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):e.css({display:"block",margin:"auto"}),t.css("opacity",.5).after(e),this.imageEditter=$('<span id="redactor-image-editter" data-redactor="verified">'+this.opts.curLang.edit+"</span>"),this.imageEditter.css({position:"absolute",zIndex:5,top:"50%",left:"50%",marginTop:"-11px",marginLeft:"-18px",lineHeight:1,backgroundColor:"#000",color:"#fff",fontSize:"11px",padding:"7px 10px",cursor:"pointer"}),this.imageEditter.attr("contenteditable",!1),this.imageEditter.on("click",$.proxy(function(){this.imageEdit(t)},this)),e.append(this.imageEditter),this.opts.imageResizable){var i=$('<span id="redactor-image-resizer" data-redactor="verified"></span>');return i.css({position:"absolute",zIndex:2,lineHeight:1,cursor:"nw-resize",bottom:"-4px",right:"-5px",border:"1px solid #fff",backgroundColor:"#000",width:"8px",height:"8px"}),i.attr("contenteditable",!1),e.append(i),e.append(t),i}return e.append(t),!1},imageThumbClick:function(t){var e='<img id="image-marker" src="'+$(t.target).attr("rel")+'" alt="'+$(t.target).attr("title")+'" />',i=this.getParent();this.opts.paragraphy&&0==$(i).closest("li").size()&&(e="<p>"+e+"</p>"),this.imageInsert(e,!0)},imageCallbackLink:function(){var t=$("#redactor_file_link").val();if(""!==t){var e='<img id="image-marker" src="'+t+'" />';this.opts.linebreaks===!1&&(e="<p>"+e+"</p>"),this.imageInsert(e,!0)}else this.modalClose()},imageCallback:function(t){this.imageInsert(t)},imageInsert:function(t,e){if(this.selectionRestore(),t!==!1){var i="";if(e!==!0){i='<img id="image-marker" src="'+t.filelink+'" />';var s=this.getParent();this.opts.paragraphy&&0==$(s).closest("li").size()&&(i="<p>"+i+"</p>")}else i=t;this.execCommand("inserthtml",i,!1);var n=$(this.$editor.find("img#image-marker"));n.length?n.removeAttr("id"):n=!1,this.sync(),e!==!0&&this.callback("imageUpload",n,t)}this.modalClose(),this.observeImages()},buildProgressBar:function(){0==$("#redactor-progress").size()&&(this.$progressBar=$('<div id="redactor-progress"><span></span></div>'),$(document.body).append(this.$progressBar))},showProgressBar:function(){this.buildProgressBar(),$("#redactor-progress").fadeIn()},hideProgressBar:function(){$("#redactor-progress").fadeOut(1500)},modalTemplatesInit:function(){$.extend(this.opts,{modal_file:String()+'<section id="redactor-modal-file-insert"><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>'+this.opts.curLang.filename+'</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="'+this.opts.fileUploadParam+'" /></div></form></section>',modal_image_edit:String()+'<section id="redactor-modal-image-edit"><label>'+this.opts.curLang.title+'</label><input type="text" id="redactor_file_alt" class="redactor_input" /><label>'+this.opts.curLang.link+'</label><input type="text" id="redactor_file_link" class="redactor_input" /><label><input type="checkbox" id="redactor_link_blank"> '+this.opts.curLang.link_new_tab+"</label><label>"+this.opts.curLang.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+this.opts.curLang.none+'</option><option value="left">'+this.opts.curLang.left+'</option><option value="center">'+this.opts.curLang.center+'</option><option value="right">'+this.opts.curLang.right+'</option></select></section><footer><button id="redactor_image_delete_btn" class="redactor_modal_btn redactor_modal_delete_btn">'+this.opts.curLang._delete+'</button><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</button><button id="redactorSaveBtn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.save+"</button></footer>",
modal_image:String()+'<section id="redactor-modal-image-insert"><div id="redactor_tabs"><a href="#" id="redactor-tab-control-1" class="redactor_tabs_act">'+this.opts.curLang.upload+'</a><a href="#" id="redactor-tab-control-2">'+this.opts.curLang.choose+'</a><a href="#" id="redactor-tab-control-3">'+this.opts.curLang.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="'+this.opts.imageUploadParam+'" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+this.opts.curLang.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /><br><br></div></section><footer><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</button><button class="redactor_modal_btn redactor_modal_action_btn" id="redactor_upload_btn">'+this.opts.curLang.insert+"</button></footer>",modal_link:String()+'<section id="redactor-modal-link-insert"><select id="redactor-predefined-links" style="width: 99.5%; display: none;"></select><label>URL</label><input type="text" class="redactor_input" id="redactor_link_url" /><label>'+this.opts.curLang.text+'</label><input type="text" class="redactor_input" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+this.opts.curLang.link_new_tab+'</label></section><footer><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</button><button id="redactor_insert_link_btn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.insert+"</button></footer>",modal_table:String()+'<section id="redactor-modal-table-insert"><label>'+this.opts.curLang.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+this.opts.curLang.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></section><footer><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</button><button id="redactor_insert_table_btn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.insert+"</button></footer>",modal_video:String()+'<section id="redactor-modal-video-insert"><form id="redactorInsertVideoForm"><label>'+this.opts.curLang.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form></section><footer><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</button><button id="redactor_insert_video_btn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.insert+"</button></footer>"})},modalInit:function(t,e,i,s){return this.modalSetOverlay(),this.$redactorModalWidth=i,this.$redactorModal=$("#redactor_modal"),this.$redactorModal.length||(this.$redactorModal=$('<div id="redactor_modal" style="display: none;" />'),this.$redactorModal.append($('<div id="redactor_modal_close">&times;</div>')),this.$redactorModal.append($('<header id="redactor_modal_header" />')),this.$redactorModal.append($('<div id="redactor_modal_inner" />')),this.$redactorModal.appendTo(document.body)),$("#redactor_modal_close").on("click",$.proxy(this.modalClose,this)),$(document).keyup($.proxy(this.modalCloseHandler,this)),this.$editor.keyup($.proxy(this.modalCloseHandler,this)),this.modalSetContent(e),this.modalSetTitle(t),this.modalSetDraggable(),this.modalLoadTabs(),this.modalOnCloseButton(),this.modalSetButtonsWidth(),this.saveModalScroll=this.document.body.scrollTop,this.opts.autoresize===!1&&(this.saveModalScroll=this.$editor.scrollTop()),this.isMobile()===!1?this.modalShowOnDesktop():this.modalShowOnMobile(),"function"==typeof s&&s(),setTimeout($.proxy(function(){this.callback("modalOpened",this.$redactorModal)},this),11),$(document).off("focusin.modal"),this.$redactorModal.find("input[type=text]").on("keypress",$.proxy(function(t){13===t.which&&(this.$redactorModal.find(".redactor_modal_action_btn").click(),t.preventDefault())},this)),this.$redactorModal},modalShowOnDesktop:function(){this.$redactorModal.css({position:"fixed",top:"-2000px",left:"50%",width:this.$redactorModalWidth+"px",marginLeft:"-"+this.$redactorModalWidth/2+"px"}).show(),this.modalSaveBodyOveflow=$(document.body).css("overflow"),$(document.body).css("overflow","hidden"),setTimeout($.proxy(function(){var t=this.$redactorModal.outerHeight();this.$redactorModal.css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(t+10)/2+"px"})},this),15)},modalShowOnMobile:function(){this.$redactorModal.css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show()},modalSetContent:function(t){this.modalcontent=!1,0==t.indexOf("#")?(this.modalcontent=$(t),$("#redactor_modal_inner").empty().append(this.modalcontent.html()),this.modalcontent.html("")):$("#redactor_modal_inner").empty().append(t)},modalSetTitle:function(t){this.$redactorModal.find("#redactor_modal_header").html(t)},modalSetButtonsWidth:function(){var t=this.$redactorModal.find("footer button").not(".redactor_modal_btn_hidden"),e=t.size();e>0&&$(t).css("width",this.$redactorModalWidth/e+"px")},modalOnCloseButton:function(){this.$redactorModal.find(".redactor_btn_modal_close").on("click",$.proxy(this.modalClose,this))},modalSetOverlay:function(){this.opts.modalOverlay&&(this.$redactorModalOverlay=$("#redactor_modal_overlay"),this.$redactorModalOverlay.length||(this.$redactorModalOverlay=$('<div id="redactor_modal_overlay" style="display: none;"></div>'),$("body").prepend(this.$redactorModalOverlay)),this.$redactorModalOverlay.show().on("click",$.proxy(this.modalClose,this)))},modalSetDraggable:function(){"undefined"!=typeof $.fn.draggable&&(this.$redactorModal.draggable({handle:"#redactor_modal_header"}),this.$redactorModal.find("#redactor_modal_header").css("cursor","move"))},modalLoadTabs:function(){var t=$("#redactor_tabs");if(!t.length)return!1;var e=this;t.find("a").each(function(i,s){i++,$(s).on("click",function(s){if(s.preventDefault(),t.find("a").removeClass("redactor_tabs_act"),$(this).addClass("redactor_tabs_act"),$(".redactor_tab").hide(),$("#redactor_tab"+i).show(),$("#redactor_tab_selected").val(i),e.isMobile()===!1){var n=e.$redactorModal.outerHeight();e.$redactorModal.css("margin-top","-"+(n+10)/2+"px")}})})},modalCloseHandler:function(t){return t.keyCode===this.keyCode.ESC?(this.modalClose(),!1):void 0},modalClose:function(){return $("#redactor_modal_close").off("click",this.modalClose),$("#redactor_modal").fadeOut("fast",$.proxy(function(){var t=$("#redactor_modal_inner");this.modalcontent!==!1&&(this.modalcontent.html(t.html()),this.modalcontent=!1),t.html(""),this.opts.modalOverlay&&$("#redactor_modal_overlay").hide().off("click",this.modalClose),$(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose),this.selectionRestore(),this.opts.autoresize&&this.saveModalScroll?$(this.document.body).scrollTop(this.saveModalScroll):this.opts.autoresize===!1&&this.saveModalScroll&&this.$editor.scrollTop(this.saveModalScroll),this.callback("modalClosed")},this)),this.isMobile()===!1&&$(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible"),!1},modalSetTab:function(t){$(".redactor_tab").hide(),$("#redactor_tabs").find("a").removeClass("redactor_tabs_act").eq(t-1).addClass("redactor_tabs_act"),$("#redactor_tab"+t).show()},s3handleFileSelect:function(t){for(var e,i=t.target.files,s=0;e=i[s];s++)this.s3uploadFile(e)},s3uploadFile:function(t){this.s3executeOnSignedUrl(t,$.proxy(function(e){this.s3uploadToS3(t,e)},this))},s3executeOnSignedUrl:function(t,e){var i=new XMLHttpRequest,s="?";"-1"!=this.opts.s3.search(/\?/)&&(s="&"),i.open("GET",this.opts.s3+s+"name="+t.name+"&type="+t.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var n=this;i.onreadystatechange=function(t){4==this.readyState&&200==this.status?(n.showProgressBar(),e(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},i.send()},s3createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(t,e)):i=null,i},s3uploadToS3:function(t,e){var i=this.s3createCORSRequest("PUT",e);i&&(i.onload=$.proxy(function(){if(200==i.status){this.hideProgressBar();var t=e.split("?");if(!t[0])return!1;this.selectionRestore();var s="";s='<img id="image-marker" src="'+t[0]+'" />',this.opts.paragraphy&&(s="<p>"+s+"</p>"),this.execCommand("inserthtml",s,!1);var n=$(this.$editor.find("img#image-marker"));n.length?n.removeAttr("id"):n=!1,this.sync(),this.callback("imageUpload",n,!1),this.modalClose(),this.observeImages()}},this),i.onerror=function(){},i.upload.onprogress=function(t){},i.setRequestHeader("Content-Type",t.type),i.setRequestHeader("x-amz-acl","public-read"),i.send(t))},uploadInit:function(t,e){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},$.extend(this.uploadOptions,e);var i=$("#"+t);i.length&&"INPUT"===i[0].tagName?(this.uploadOptions.input=i,this.el=$(i[0].form)):this.el=i,this.element_action=this.el.attr("action"),this.uploadOptions.auto?$(this.uploadOptions.input).change($.proxy(function(t){this.el.submit(function(t){return!1}),this.uploadSubmit(t)},this)):this.uploadOptions.trigger&&$("#"+this.uploadOptions.trigger).click($.proxy(this.uploadSubmit,this))},uploadSubmit:function(t){this.showProgressBar(),this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var t=this.document.createElement("div"),e='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return t.innerHTML=e,$(t).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),$("#"+this.id).load($.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(t,e){if(this.uploadOptions.input){var i="redactorUploadForm"+this.id,s="redactorUploadFile"+this.id;this.form=$('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+e+'" name="'+i+'" id="'+i+'" enctype="multipart/form-data" />'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&$.each(this.opts.uploadFields,$.proxy(function(t,e){null!=e&&0===e.toString().indexOf("#")&&(e=$(e).val());var i=$("<input/>",{type:"hidden",name:t,value:e});$(this.form).append(i)},this));var n=this.uploadOptions.input,r=$(n).clone();$(n).attr("id",s).before(r).appendTo(this.form),$(this.form).css("position","absolute").css("top","-2000px").css("left","-2000px").appendTo("body"),this.form.submit()}else t.attr("target",e).attr("method","POST").attr("enctype","multipart/form-data").attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var t,e=$("#"+this.id)[0];if(t=e.contentDocument?e.contentDocument:e.contentWindow?e.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if(this.hideProgressBar(),"undefined"!=typeof t){var i=t.body.innerHTML,s=i.match(/\{(.|\n)*\}/)[0];s=s.replace(/^\[/,""),s=s.replace(/\]$/,"");var n=$.parseJSON(s);"undefined"==typeof n.error?this.uploadOptions.success(n):(this.uploadOptions.error(this,n),this.modalClose())}else this.modalClose(),alert("Upload failed!");this.el.attr("action",this.element_action),this.el.attr("target","")},draguploadInit:function(t,e){return this.draguploadOptions=$.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:this.opts.curLang.drop_file_here,atext:this.opts.curLang.or_choose,uploadParam:!1},e),void 0===window.FormData?!1:(this.droparea=$('<div class="redactor_droparea"></div>'),this.dropareabox=$('<div class="redactor_dropareabox">'+this.draguploadOptions.text+"</div>"),this.dropalternative=$('<div class="redactor_dropalternative">'+this.draguploadOptions.atext+"</div>"),this.droparea.append(this.dropareabox),$(t).before(this.droparea),$(t).before(this.dropalternative),this.dropareabox.on("dragover",$.proxy(function(){return this.draguploadOndrag()},this)),this.dropareabox.on("dragleave",$.proxy(function(){return this.draguploadOndragleave()},this)),void(this.dropareabox.get(0).ondrop=$.proxy(function(t){t.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop"),this.showProgressBar(),this.dragUploadAjax(this.draguploadOptions.url,t.dataTransfer.files[0],!1,t,this.draguploadOptions.uploadParam)},this)))},dragUploadAjax:function(t,e,i,s,n){if(!i){var r=$.ajaxSettings.xhr();r.upload&&r.upload.addEventListener("progress",$.proxy(this.uploadProgress,this),!1),$.ajaxSetup({xhr:function(){return r}})}this.callback("drop",s);var a=new FormData;n!==!1?a.append(n,e):a.append("file",e),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&$.each(this.opts.uploadFields,$.proxy(function(t,e){null!=e&&0===e.toString().indexOf("#")&&(e=$(e).val()),a.append(t,e)},this)),$.ajax({url:t,dataType:"html",data:a,cache:!1,contentType:!1,processData:!1,type:"POST",success:$.proxy(function(t){t=t.replace(/^\[/,""),t=t.replace(/\]$/,"");var e="string"==typeof t?$.parseJSON(t):t;if(this.hideProgressBar(),i){var n=$("<img>");n.attr("src",e.filelink).attr("id","drag-image-marker"),this.insertNodeToCaretPositionFromPoint(s,n[0]);var r=$(this.$editor.find("img#drag-image-marker"));r.length?r.removeAttr("id"):r=!1,this.sync(),this.observeImages(),r&&this.callback("imageUpload",r,e),"undefined"!=typeof e.error&&this.callback("imageUploadError",e)}else"undefined"==typeof e.error?this.draguploadOptions.success(e):(this.draguploadOptions.error(this,e),this.draguploadOptions.success(!1))},this)})},draguploadOndrag:function(){return this.dropareabox.addClass("hover"),!1},draguploadOndragleave:function(){return this.dropareabox.removeClass("hover"),!1},uploadProgress:function(t,e){var i=t.loaded?parseInt(t.loaded/t.total*100,10):t;this.dropareabox.text("Loading "+i+"% "+(e||""))},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isIPad:function(){return/iPad/.test(navigator.userAgent)},normalize:function(t){return"undefined"==typeof t?0:parseInt(t.replace("px",""),10)},outerHtml:function(t){return $("<div>").append($(t).eq(0).clone()).html()},stripHtml:function(t){var e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""},isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},isEmpty:function(t){return t=t.replace(/&#x200b;|<br>|<br\/>|&nbsp;/gi,""),t=t.replace(/\s/g,""),t=t.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),""==t},getInternetExplorerVersion:function(){var t=!1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(e)&&(t=parseFloat(RegExp.$1))}return t},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(t){var e=navigator.userAgent.toLowerCase(),i=/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"version"==t?i[2]:"webkit"==t?"chrome"==i[1]||"webkit"==i[1]:"rv"==i[1]?"msie"==t:"opr"==i[1]?"webkit"==t:t==i[1]},oldIE:function(){return this.browser("msie")&&parseInt(this.browser("version"),10)<9?!0:!1},getFragmentHtml:function(t){var e=t.cloneNode(!0),i=this.document.createElement("div");return i.appendChild(e),i.innerHTML},extractContent:function(){for(var t,e=this.$editor[0],i=this.document.createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i},isParentRedactor:function(t){return t?this.opts.iframe?t:0==$(t).parents("div.redactor_editor").length||$(t).hasClass("redactor_editor")?!1:t:!1},currentOrParentIs:function(t){var e=this.getParent(),i=this.getCurrent();return e&&e.tagName===t?e:i&&i.tagName===t?i:!1},isEndOfElement:function(){var t=this.getBlock(),e=this.getCaretOffset(t),i=$.trim($(t).text()).replace(/\n\r\n/g,""),s=i.length;return e==s?!0:!1},isFocused:function(){var t,e=this.getSelection();return e&&e.rangeCount&&e.rangeCount>0&&(t=e.getRangeAt(0).startContainer),t?this.opts.iframe?this.getCaretOffsetRange().equals()?!this.$editor.is(t):!0:0!=$(t).closest("div.redactor_editor").length:!1},removeEmptyAttr:function(t,e){""==$(t).attr(e)&&$(t).removeAttr(e)},removeFromArrayByValue:function(t,e){for(var i=null;-1!==(i=t.indexOf(e));)t.splice(i,1);return t}},Redactor.prototype.init.prototype=Redactor.prototype,$.Redactor.fn.formatLinkify=function(t,e,i,s,n){for(var r=/(((https?|ftps?):\/\/)|www[.][^\s])(.+?\..+?)([.),]?)(\s|\.\s+|\)|$)/gi,a=/(https?|ftp):\/\//i,o=/(https?:\/\/.*\.(?:png|jpg|jpeg|gif))/gi,l=(this.$editor?this.$editor.get(0):this).childNodes,h=l.length;h--;){var c=l[h];if(3===c.nodeType){var d=c.nodeValue;if(s&&d){var p='<iframe width="500" height="281" src="',u='" frameborder="0" allowfullscreen></iframe>';d.match(reUrlYoutube)?(d=d.replace(reUrlYoutube,p+"//www.youtube.com/embed/$1"+u),$(c).after(d).remove()):d.match(reUrlVimeo)&&(d=d.replace(reUrlVimeo,p+"//player.vimeo.com/video/$2"+u),$(c).after(d).remove())}if(i&&d&&d.match(o)&&(d=d.replace(o,'<img src="$1">'),$(c).after(d).remove()),e&&d&&d.match(r)){var f=d.match(r);for(var h in f){var g=f[h],m=g,v="";null!==g.match(/\s$/)&&(v=" ");var b=t;null!==g.match(a)&&(b=""),m.length>n&&(m=m.substring(0,n)+"..."),m=m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var y=m.replace("$","$$$");d=d.replace(g,'<a href="'+b+$.trim(g)+'">'+$.trim(y)+"</a>"+v)}$(c).after(d).remove()}}else 1!==c.nodeType||/^(a|button|textarea)$/i.test(c.tagName)||$.Redactor.fn.formatLinkify.call(c,t,e,i,s,n)}}}(jQuery),function(t){t.Redactor.opts.langs.fr={html:"Code HTML",video:"InsÃ©rer une vidÃ©o...",image:"InsÃ©rer une image...",table:"Tableau",link:"Lien",link_insert:"InsÃ©rer un lien...",link_edit:"Modifier le lien",unlink:"Supprimer le lien",formatting:"Styles",paragraph:"Paragraphe",quote:"Citation",code:"Code",header1:"Titre 1",header2:"Titre 2",header3:"Titre 3",header4:"Titre 4",header5:"Titre 5",bold:"Gras",italic:"Italique",fontcolor:"Couleur du texte",backcolor:"Couleur d'arriÃ¨re plan du texte",unorderedlist:"Liste Ã  puces",orderedlist:"Liste numÃ©rotÃ©e",outdent:"Diminuer le retrait",indent:"Augmenter le retrait",cancel:"Annuler",insert:"InsÃ©rer",save:"Enregistrer",_delete:"Supprimer",insert_table:"InsÃ©rer un tableau...",insert_row_above:"Ajouter une rangÃ©e au-dessus",insert_row_below:"Ajouter une rangÃ©e en-dessous",insert_column_left:"Ajouter une colonne Ã  gauche",insert_column_right:"Ajouter une colonne Ã  droite",delete_column:"Supprimer la colonne",delete_row:"Supprimer la rangÃ©e",delete_table:"Supprimer le tableau",rows:"RangÃ©es",columns:"Colonnes",add_head:"Ajouter un en-tÃªte",delete_head:"Supprimer l'en-tÃªte",title:"Titre",image_position:"Position",none:"Aucun",left:"Gauche",right:"Droite",image_web_link:"Adresse URL de l'image",text:"Texte",mailto:"Courriel",web:"Adresse URL",video_html_code:"Code d'intÃ©gration du video",file:"InsÃ©rer un fichier...",upload:"TÃ©lÃ©verser",download:"TÃ©lÃ©charger",choose:"Choisir",or_choose:"Ou choisissez",drop_file_here:"DÃ©posez le fichier ici",align_left:"Aligner Ã  gauche",align_center:"Aligner au centre",align_right:"Aligner Ã  droite",align_justify:"Justifier",horizontalrule:"InsÃ©rer une ligne horizontale",deleted:"SupprimÃ©",anchor:"Ancre",link_new_tab:"Ouvrir le lien dans un nouvel onglet",underline:"Souligner",alignment:"Alignement",filename:"Nom de fichier (optionnel)",edit:"Edit",center:"Center"}}(jQuery),function(t){var e=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return"undefined"==typeof t},toStr:function(t){return e.isUndefined(t)||null===t?"":t+""},bind:t.proxy,each:function(e,i){function s(t,e){return i(e,t)}t.each(e,s)},map:t.map,filter:t.grep,every:function(e,i){var s=!0;return e?(t.each(e,function(t,n){return(s=i.call(null,n,t,e))?void 0:!1}),!!s):s},some:function(e,i){var s=!1;return e?(t.each(e,function(t,n){return(s=i.call(null,n,t,e))?!1:void 0}),!!s):s},mixin:t.extend,getUniqueId:function(){var t=0;return function(){return t++}}(),templatify:function(e){function i(){return String(e)}return t.isFunction(e)?e:i},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var s,n;return function(){var r,a,o=this,l=arguments;return r=function(){s=null,i||(n=t.apply(o,l))},a=i&&!s,clearTimeout(s),s=setTimeout(r,e),a&&(n=t.apply(o,l)),n}},throttle:function(t,e){var i,s,n,r,a,o;return a=0,o=function(){a=new Date,n=null,r=t.apply(i,s)},function(){var l=new Date,h=e-(l-a);return i=this,s=arguments,0>=h?(clearTimeout(n),n=null,a=l,r=t.apply(i,s)):n||(n=setTimeout(o,h)),r}},noop:function(){}}}(),i="0.10.5",s=function(){"use strict";function t(t){return t=e.toStr(t),t?t.split(/\s+/):[]}function i(t){return t=e.toStr(t),t?t.split(/\W+/):[]}function s(t){return function(){var i=[].slice.call(arguments,0);return function(s){var n=[];return e.each(i,function(i){n=n.concat(t(e.toStr(s[i])))}),n}}}return{nonword:i,whitespace:t,obj:{nonword:s(i),whitespace:s(t)}}}(),n=function(){"use strict";function i(i){this.maxSize=e.isNumber(i)?i:100,this.reset(),this.maxSize<=0&&(this.set=this.get=t.noop)}function s(){this.head=this.tail=null}function n(t,e){this.key=t,this.val=e,this.prev=this.next=null}return e.mixin(i.prototype,{set:function(t,e){var i,s=this.list.tail;this.size>=this.maxSize&&(this.list.remove(s),delete this.hash[s.key]),(i=this.hash[t])?(i.val=e,this.list.moveToFront(i)):(i=new n(t,e),this.list.add(i),this.hash[t]=i,this.size++)},get:function(t){var e=this.hash[t];return e?(this.list.moveToFront(e),e.val):void 0},reset:function(){this.size=0,this.hash={},this.list=new s}}),e.mixin(s.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),i}(),r=function(){"use strict";function t(t){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix))}function i(){return(new Date).getTime()}function s(t){return JSON.stringify(e.isUndefined(t)?null:t)}function n(t){return JSON.parse(t)}var r,a;try{r=window.localStorage,r.setItem("~~~","!"),r.removeItem("~~~")}catch(o){r=null}return a=r&&window.JSON?{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},get:function(t){return this.isExpired(t)&&this.remove(t),n(r.getItem(this._prefix(t)))},set:function(t,n,a){return e.isNumber(a)?r.setItem(this._ttlKey(t),s(i()+a)):r.removeItem(this._ttlKey(t)),r.setItem(this._prefix(t),s(n))},remove:function(t){return r.removeItem(this._ttlKey(t)),r.removeItem(this._prefix(t)),this},clear:function(){var t,e,i=[],s=r.length;for(t=0;s>t;t++)(e=r.key(t)).match(this.keyMatcher)&&i.push(e.replace(this.keyMatcher,""));for(t=i.length;t--;)this.remove(i[t]);return this},isExpired:function(t){var s=n(r.getItem(this._ttlKey(t)));return e.isNumber(s)&&i()>s?!0:!1}}:{get:e.noop,set:e.noop,remove:e.noop,clear:e.noop,isExpired:e.noop},e.mixin(t.prototype,a),t}(),a=function(){"use strict";function i(e){e=e||{},this.cancelled=!1,this.lastUrl=null,this._send=e.transport?s(e.transport):t.ajax,this._get=e.rateLimiter?e.rateLimiter(this._get):this._get,this._cache=e.cache===!1?new n(0):l}function s(i){return function(s,n){function r(t){e.defer(function(){o.resolve(t)})}function a(t){e.defer(function(){o.reject(t)})}var o=t.Deferred();return i(s,n,r,a),o}}var r=0,a={},o=6,l=new n(10);return i.setMaxPendingRequests=function(t){o=t},i.resetCache=function(){l.reset()},e.mixin(i.prototype,{_get:function(t,e,i){function s(e){i&&i(null,e),c._cache.set(t,e)}function n(){i&&i(!0)}function l(){r--,delete a[t],c.onDeckRequestArgs&&(c._get.apply(c,c.onDeckRequestArgs),c.onDeckRequestArgs=null)}var h,c=this;this.cancelled||t!==this.lastUrl||((h=a[t])?h.done(s).fail(n):o>r?(r++,a[t]=this._send(t,e).done(s).fail(n).always(l)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(t,i,s){var n;return e.isFunction(i)&&(s=i,i={}),this.cancelled=!1,this.lastUrl=t,(n=this._cache.get(t))?e.defer(function(){s&&s(null,n)}):this._get(t,i,s),!!n},cancel:function(){this.cancelled=!0}}),i}(),o=function(){"use strict";function i(e){e=e||{},e.datumTokenizer&&e.queryTokenizer||t.error("datumTokenizer and queryTokenizer are both required"),this.datumTokenizer=e.datumTokenizer,this.queryTokenizer=e.queryTokenizer,this.reset()}function s(t){return t=e.filter(t,function(t){return!!t}),t=e.map(t,function(t){return t.toLowerCase()})}function n(){return{ids:[],children:{}}}function r(t){for(var e={},i=[],s=0,n=t.length;n>s;s++)e[t[s]]||(e[t[s]]=!0,i.push(t[s]));return i}function a(t,e){function i(t,e){return t-e}var s=0,n=0,r=[];t=t.sort(i),e=e.sort(i);for(var a=t.length,o=e.length;a>s&&o>n;)t[s]<e[n]?s++:t[s]>e[n]?n++:(r.push(t[s]),s++,n++);return r}return e.mixin(i.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(t){var i=this;t=e.isArray(t)?t:[t],e.each(t,function(t){var r,a;r=i.datums.push(t)-1,a=s(i.datumTokenizer(t)),e.each(a,function(t){var e,s,a;for(e=i.trie,s=t.split("");a=s.shift();)e=e.children[a]||(e.children[a]=n()),e.ids.push(r)})})},get:function(t){var i,n,o=this;return i=s(this.queryTokenizer(t)),e.each(i,function(t){var e,i,s,r;if(n&&0===n.length)return!1;for(e=o.trie,i=t.split("");e&&(s=i.shift());)e=e.children[s];return e&&0===i.length?(r=e.ids.slice(0),void(n=n?a(n,r):r)):(n=[],!1)}),n?e.map(r(n),function(t){return o.datums[t]}):[]},reset:function(){this.datums=[],this.trie=n()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),i}(),l=function(){"use strict";function s(t){return t.local||null}function n(s){var n,r;return r={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(n=s.prefetch||null)&&(n=e.isString(n)?{url:n}:n,n=e.mixin(r,n),n.thumbprint=i+n.thumbprint,n.ajax.type=n.ajax.type||"GET",n.ajax.dataType=n.ajax.dataType||"json",!n.url&&t.error("prefetch requires url to be set")),n}function r(i){function s(t){return function(i){return e.debounce(i,t)}}function n(t){return function(i){return e.throttle(i,t)}}var r,a;return a={url:null,cache:!0,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(r=i.remote||null)&&(r=e.isString(r)?{url:r}:r,r=e.mixin(a,r),r.rateLimiter=/^throttle$/i.test(r.rateLimitBy)?n(r.rateLimitWait):s(r.rateLimitWait),r.ajax.type=r.ajax.type||"GET",r.ajax.dataType=r.ajax.dataType||"json",delete r.rateLimitBy,delete r.rateLimitWait,!r.url&&t.error("remote requires url to be set")),r}return{local:s,prefetch:n,remote:r}}();!function(i){"use strict";function n(e){e&&(e.local||e.prefetch||e.remote)||t.error("one of local, prefetch, or remote is required"),this.limit=e.limit||5,this.sorter=h(e.sorter),this.dupDetector=e.dupDetector||c,this.local=l.local(e),this.prefetch=l.prefetch(e),this.remote=l.remote(e),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new o({datumTokenizer:e.datumTokenizer,queryTokenizer:e.queryTokenizer}),this.storage=this.cacheKey?new r(this.cacheKey):null}function h(t){function i(e){return e.sort(t)}function s(t){return t}return e.isFunction(t)?i:s}function c(){return!1}var d,p;return d=i.Bloodhound,p={data:"data",protocol:"protocol",thumbprint:"thumbprint"},i.Bloodhound=n,n.noConflict=function(){return i.Bloodhound=d,n},n.tokenizers=s,e.mixin(n.prototype,{_loadPrefetch:function(e){function i(t){r.clear(),r.add(e.filter?e.filter(t):t),r._saveToStorage(r.index.serialize(),e.thumbprint,e.ttl)}var s,n,r=this;return(s=this._readFromStorage(e.thumbprint))?(this.index.bootstrap(s),n=t.Deferred().resolve()):n=t.ajax(e.url,e.ajax).done(i),n},_getFromRemote:function(t,e){function i(t,i){e(t?[]:r.remote.filter?r.remote.filter(i):i)}var s,n,r=this;if(this.transport)return t=t||"",n=encodeURIComponent(t),s=this.remote.replace?this.remote.replace(this.remote.url,t):this.remote.url.replace(this.remote.wildcard,n),this.transport.get(s,this.remote.ajax,i)},_cancelLastRemoteRequest:function(){this.transport&&this.transport.cancel()},_saveToStorage:function(t,e,i){this.storage&&(this.storage.set(p.data,t,i),this.storage.set(p.protocol,location.protocol,i),this.storage.set(p.thumbprint,e,i))},_readFromStorage:function(t){var e,i={};return this.storage&&(i.data=this.storage.get(p.data),i.protocol=this.storage.get(p.protocol),i.thumbprint=this.storage.get(p.thumbprint)),e=i.thumbprint!==t||i.protocol!==location.protocol,i.data&&!e?i.data:null},_initialize:function(){function i(){n.add(e.isFunction(r)?r():r)}var s,n=this,r=this.local;return s=this.prefetch?this._loadPrefetch(this.prefetch):t.Deferred().resolve(),r&&s.done(i),this.transport=this.remote?new a(this.remote):null,this.initPromise=s.promise()},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){this.index.add(t)},get:function(t,i){function s(t){var s=r.slice(0);e.each(t,function(t){var i;return i=e.some(s,function(e){return n.dupDetector(t,e)}),!i&&s.push(t),s.length<n.limit}),i&&i(n.sorter(s))}var n=this,r=[],a=!1;r=this.index.get(t),r=this.sorter(r).slice(0,this.limit),r.length<this.limit?a=this._getFromRemote(t,s):this._cancelLastRemoteRequest(),a||(r.length>0||!this.transport)&&i&&i(r)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&a.resetCache()},ttAdapter:function(){return e.bind(this.get,this)}}),n}(this);var h=function(){return{wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'}}(),c=function(){"use strict";var t={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return e.isMsie()&&e.mixin(t.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),e.isMsie()&&e.isMsie()<=7&&e.mixin(t.input,{marginTop:"-1px"}),t}(),d=function(){"use strict";function i(e){e&&e.el||t.error("EventBus initialized without el"),this.$el=t(e.el)}var s="typeahead:";return e.mixin(i.prototype,{trigger:function(t){var e=[].slice.call(arguments,1);this.$el.trigger(s+t,e)}}),i}(),p=function(){"use strict";function t(t,e,i,s){var n;if(!i)return this;for(e=e.split(l),i=s?o(i,s):i,this._callbacks=this._callbacks||{};n=e.shift();)this._callbacks[n]=this._callbacks[n]||{sync:[],async:[]},this._callbacks[n][t].push(i);return this}function e(e,i,s){return t.call(this,"async",e,i,s)}function i(e,i,s){return t.call(this,"sync",e,i,s);
}function s(t){var e;if(!this._callbacks)return this;for(t=t.split(l);e=t.shift();)delete this._callbacks[e];return this}function n(t){var e,i,s,n,a;if(!this._callbacks)return this;for(t=t.split(l),s=[].slice.call(arguments,1);(e=t.shift())&&(i=this._callbacks[e]);)n=r(i.sync,this,[e].concat(s)),a=r(i.async,this,[e].concat(s)),n()&&h(a);return this}function r(t,e,i){function s(){for(var s,n=0,r=t.length;!s&&r>n;n+=1)s=t[n].apply(e,i)===!1;return!s}return s}function a(){var t;return t=window.setImmediate?function(t){setImmediate(function(){t()})}:function(t){setTimeout(function(){t()},0)}}function o(t,e){return t.bind?t.bind(e):function(){t.apply(e,[].slice.call(arguments,0))}}var l=/\s+/,h=a();return{onSync:i,onAsync:e,off:s,trigger:n}}(),u=function(t){"use strict";function i(t,i,s){for(var n,r=[],a=0,o=t.length;o>a;a++)r.push(e.escapeRegExChars(t[a]));return n=s?"\\b("+r.join("|")+")\\b":"("+r.join("|")+")",i?new RegExp(n):new RegExp(n,"i")}var s={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(n){function r(e){var i,s,r;return(i=o.exec(e.data))&&(r=t.createElement(n.tagName),n.className&&(r.className=n.className),s=e.splitText(i.index),s.splitText(i[0].length),r.appendChild(s.cloneNode(!0)),e.parentNode.replaceChild(r,s)),!!i}function a(t,e){for(var i,s=3,n=0;n<t.childNodes.length;n++)i=t.childNodes[n],i.nodeType===s?n+=e(i)?1:0:a(i,e)}var o;n=e.mixin({},s,n),n.node&&n.pattern&&(n.pattern=e.isArray(n.pattern)?n.pattern:[n.pattern],o=i(n.pattern,n.caseSensitive,n.wordsOnly),a(n.node,r))}}(window.document),f=function(){"use strict";function i(i){var n,r,o,l,h=this;i=i||{},i.input||t.error("input is missing"),n=e.bind(this._onBlur,this),r=e.bind(this._onFocus,this),o=e.bind(this._onKeydown,this),l=e.bind(this._onInput,this),this.$hint=t(i.hint),this.$input=t(i.input).on("blur.tt",n).on("focus.tt",r).on("keydown.tt",o),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop),e.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(t){a[t.which||t.keyCode]||e.defer(e.bind(h._onInput,h,t))}):this.$input.on("input.tt",l),this.query=this.$input.val(),this.$overflowHelper=s(this.$input)}function s(e){return t('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function n(t,e){return i.normalizeQuery(t)===i.normalizeQuery(e)}function r(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}var a;return a={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},i.normalizeQuery=function(t){return(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},e.mixin(i.prototype,p,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(t){var e=a[t.which||t.keyCode];this._managePreventDefault(e,t),e&&this._shouldTrigger(e,t)&&this.trigger(e+"Keyed",t)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(t,e){var i,s,n;switch(t){case"tab":s=this.getHint(),n=this.getInputValue(),i=s&&s!==n&&!r(e);break;case"up":case"down":i=!r(e);break;default:i=!1}i&&e.preventDefault()},_shouldTrigger:function(t,e){var i;switch(t){case"tab":i=!r(e);break;default:i=!0}return i},_checkInputValue:function(){var t,e,i;t=this.getInputValue(),e=n(t,this.query),i=e?this.query.length!==t.length:!1,this.query=t,e?i&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(t){this.query=t},getInputValue:function(){return this.$input.val()},setInputValue:function(t,e){this.$input.val(t),e?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(t){this.$hint.val(t)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var t,e,i,s;t=this.getInputValue(),e=this.getHint(),i=t!==e&&0===e.indexOf(t),s=""!==t&&i&&!this.hasOverflow(),!s&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var t=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=t},isCursorAtEnd:function(){var t,i,s;return t=this.$input.val().length,i=this.$input[0].selectionStart,e.isNumber(i)?i===t:document.selection?(s=document.selection.createRange(),s.moveStart("character",-t),t===s.text.length):!0},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),i}(),g=function(){"use strict";function i(i){i=i||{},i.templates=i.templates||{},i.source||t.error("missing source"),i.name&&!r(i.name)&&t.error("invalid dataset name: "+i.name),this.query=null,this.highlight=!!i.highlight,this.name=i.name||e.getUniqueId(),this.source=i.source,this.displayFn=s(i.display||i.displayKey),this.templates=n(i.templates,this.displayFn),this.$el=t(h.dataset.replace("%CLASS%",this.name))}function s(t){function i(e){return e[t]}return t=t||"value",e.isFunction(t)?t:i}function n(t,i){function s(t){return"<p>"+i(t)+"</p>"}return{empty:t.empty&&e.templatify(t.empty),header:t.header&&e.templatify(t.header),footer:t.footer&&e.templatify(t.footer),suggestion:t.suggestion||s}}function r(t){return/^[_a-zA-Z0-9-]+$/.test(t)}var a="ttDataset",o="ttValue",l="ttDatum";return i.extractDatasetName=function(e){return t(e).data(a)},i.extractValue=function(e){return t(e).data(o)},i.extractDatum=function(e){return t(e).data(l)},e.mixin(i.prototype,p,{_render:function(i,s){function n(){return g.templates.empty({query:i,isEmpty:!0})}function r(){function n(e){var i;return i=t(h.suggestion).append(g.templates.suggestion(e)).data(a,g.name).data(o,g.displayFn(e)).data(l,e),i.children().each(function(){t(this).css(c.suggestionChild)}),i}var r,d;return r=t(h.suggestions).css(c.suggestions),d=e.map(s,n),r.append.apply(r,d),g.highlight&&u({className:"tt-highlight",node:r[0],pattern:i}),r}function d(){return g.templates.header({query:i,isEmpty:!f})}function p(){return g.templates.footer({query:i,isEmpty:!f})}if(this.$el){var f,g=this;this.$el.empty(),f=s&&s.length,!f&&this.templates.empty?this.$el.html(n()).prepend(g.templates.header?d():null).append(g.templates.footer?p():null):f&&this.$el.html(r()).prepend(g.templates.header?d():null).append(g.templates.footer?p():null),this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(t){function e(e){i.canceled||t!==i.query||i._render(t,e)}var i=this;this.query=t,this.canceled=!1,this.source(t,e)},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),i}(),m=function(){"use strict";function i(i){var n,r,a,o=this;i=i||{},i.menu||t.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=e.map(i.datasets,s),n=e.bind(this._onSuggestionClick,this),r=e.bind(this._onSuggestionMouseEnter,this),a=e.bind(this._onSuggestionMouseLeave,this),this.$menu=t(i.menu).on("click.tt",".tt-suggestion",n).on("mouseenter.tt",".tt-suggestion",r).on("mouseleave.tt",".tt-suggestion",a),e.each(this.datasets,function(t){o.$menu.append(t.getRoot()),t.onSync("rendered",o._onRendered,o)})}function s(t){return new g(t)}return e.mixin(i.prototype,p,{_onSuggestionClick:function(e){this.trigger("suggestionClicked",t(e.currentTarget))},_onSuggestionMouseEnter:function(e){this._removeCursor(),this._setCursor(t(e.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){function t(t){return t.isEmpty()}this.isEmpty=e.every(this.datasets,t),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(t,e){t.first().addClass("tt-cursor"),!e&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(t){var e,i,s,n;if(this.isOpen){if(i=this._getCursor(),e=this._getSuggestions(),this._removeCursor(),s=e.index(i)+t,s=(s+1)%(e.length+1)-1,-1===s)return void this.trigger("cursorRemoved");-1>s&&(s=e.length-1),this._setCursor(n=e.eq(s)),this._ensureVisible(n)}},_ensureVisible:function(t){var e,i,s,n;e=t.position().top,i=e+t.outerHeight(!0),s=this.$menu.scrollTop(),n=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),0>e?this.$menu.scrollTop(s+e):i>n&&this.$menu.scrollTop(s+(i-n))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(t){this.$menu.css("ltr"===t?c.ltr:c.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(t){var e=null;return t.length&&(e={raw:g.extractDatum(t),value:g.extractValue(t),datasetName:g.extractDatasetName(t)}),e},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(t){function i(e){e.update(t)}e.each(this.datasets,i)},empty:function(){function t(t){t.clear()}e.each(this.datasets,t),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){function t(t){t.destroy()}this.$menu.off(".tt"),this.$menu=null,e.each(this.datasets,t)}}),i}(),v=function(){"use strict";function i(i){var n,r,a;i=i||{},i.input||t.error("missing input"),this.isActivated=!1,this.autoselect=!!i.autoselect,this.minLength=e.isNumber(i.minLength)?i.minLength:1,this.$node=s(i.input,i.withHint),n=this.$node.find(".tt-dropdown-menu"),r=this.$node.find(".tt-input"),a=this.$node.find(".tt-hint"),r.on("blur.tt",function(t){var i,s,a;i=document.activeElement,s=n.is(i),a=n.has(i).length>0,e.isMsie()&&(s||a)&&(t.preventDefault(),t.stopImmediatePropagation(),e.defer(function(){r.focus()}))}),n.on("mousedown.tt",function(t){t.preventDefault()}),this.eventBus=i.eventBus||new d({el:r}),this.dropdown=new m({menu:n,datasets:i.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new f({input:r,hint:a}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}function s(e,i){var s,r,o,l;s=t(e),r=t(h.wrapper).css(c.wrapper),o=t(h.dropdown).css(c.dropdown),l=s.clone().css(c.hint).css(n(s)),l.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1}),s.data(a,{dir:s.attr("dir"),autocomplete:s.attr("autocomplete"),spellcheck:s.attr("spellcheck"),style:s.attr("style")}),s.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(i?c.input:c.inputWithNoHint);try{!s.attr("dir")&&s.attr("dir","auto")}catch(d){}return s.wrap(r).parent().prepend(i?l:null).append(o)}function n(t){return{backgroundAttachment:t.css("background-attachment"),backgroundClip:t.css("background-clip"),backgroundColor:t.css("background-color"),backgroundImage:t.css("background-image"),backgroundOrigin:t.css("background-origin"),backgroundPosition:t.css("background-position"),backgroundRepeat:t.css("background-repeat"),backgroundSize:t.css("background-size")}}function r(t){var i=t.find(".tt-input");e.each(i.data(a),function(t,s){e.isUndefined(t)?i.removeAttr(s):i.attr(s,t)}),i.detach().removeData(a).removeClass("tt-input").insertAfter(t),t.remove()}var a="ttAttrs";return e.mixin(i.prototype,{_onSuggestionClicked:function(t,e){var i;(i=this.dropdown.getDatumForSuggestion(e))&&this._select(i)},_onCursorMoved:function(){var t=this.dropdown.getDatumForCursor();this.input.setInputValue(t.value,!0),this.eventBus.trigger("cursorchanged",t.raw,t.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(t,e){var i,s;i=this.dropdown.getDatumForCursor(),s=this.dropdown.getDatumForTopSuggestion(),i?(this._select(i),e.preventDefault()):this.autoselect&&s&&(this._select(s),e.preventDefault())},_onTabKeyed:function(t,e){var i;(i=this.dropdown.getDatumForCursor())?(this._select(i),e.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(t,e){this.input.clearHintIfInvalid(),e.length>=this.minLength?this.dropdown.update(e):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var t;this.dir!==(t=this.input.getLanguageDirection())&&(this.dir=t,this.$node.css("direction",t),this.dropdown.setLanguageDirection(t))},_updateHint:function(){var t,i,s,n,r,a;t=this.dropdown.getDatumForTopSuggestion(),t&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(i=this.input.getInputValue(),s=f.normalizeQuery(i),n=e.escapeRegExChars(s),r=new RegExp("^(?:"+n+")(.+$)","i"),a=r.exec(t.value),a?this.input.setHint(i+a[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(t){var e,i,s,n;e=this.input.getHint(),i=this.input.getQuery(),s=t||this.input.isCursorAtEnd(),e&&i!==e&&s&&(n=this.dropdown.getDatumForTopSuggestion(),n&&this.input.setInputValue(n.value),this.eventBus.trigger("autocompleted",n.raw,n.datasetName))},_select:function(t){this.input.setQuery(t.value),this.input.setInputValue(t.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",t.raw,t.datasetName),this.dropdown.close(),e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(t){t=e.toStr(t),this.isActivated?this.input.setInputValue(t):(this.input.setQuery(t),this.input.setInputValue(t,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),r(this.$node),this.$node=null}}),i}();!function(){"use strict";var i,s,n;i=t.fn.typeahead,s="ttTypeahead",n={initialize:function(i,n){function r(){var r,a,o=t(this);e.each(n,function(t){t.highlight=!!i.highlight}),a=new v({input:o,eventBus:r=new d({el:o}),withHint:e.isUndefined(i.hint)?!0:!!i.hint,minLength:i.minLength,autoselect:i.autoselect,datasets:n}),o.data(s,a)}return n=e.isArray(n)?n:[].slice.call(arguments,1),i=i||{},this.each(r)},open:function(){function e(){var e,i=t(this);(e=i.data(s))&&e.open()}return this.each(e)},close:function(){function e(){var e,i=t(this);(e=i.data(s))&&e.close()}return this.each(e)},val:function(e){function i(){var i,n=t(this);(i=n.data(s))&&i.setVal(e)}function n(t){var e,i;return(e=t.data(s))&&(i=e.getVal()),i}return arguments.length?this.each(i):n(this.first())},destroy:function(){function e(){var e,i=t(this);(e=i.data(s))&&(e.destroy(),i.removeData(s))}return this.each(e)}},t.fn.typeahead=function(e){var i;return n[e]&&"initialize"!==e?(i=this.filter(function(){return!!t(this).data(s)}),n[e].apply(i,[].slice.call(arguments,1))):n.initialize.apply(this,arguments)},t.fn.typeahead.noConflict=function(){return t.fn.typeahead=i,this}}()}(window.jQuery);var Handlebars=function(){var t=function(){"use strict";function t(t){this.string=t}var e;return t.prototype.toString=function(){return""+this.string},e=t}(),e=function(t){"use strict";function e(t){return o[t]||"&amp;"}function i(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}function s(t){return t instanceof a?t.toString():t||0===t?(t=""+t,h.test(t)?t.replace(l,e):t):""}function n(t){return t||0===t?p(t)&&0===t.length?!0:!1:!0}var r={},a=t,o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,h=/[&<>"'`]/;r.extend=i;var c=Object.prototype.toString;r.toString=c;var d=function(t){return"function"==typeof t};d(/x/)&&(d=function(t){return"function"==typeof t&&"[object Function]"===c.call(t)});var d;r.isFunction=d;var p=Array.isArray||function(t){return t&&"object"==typeof t?"[object Array]"===c.call(t):!1};return r.isArray=p,r.escapeExpression=s,r.isEmpty=n,r}(t),i=function(){"use strict";function t(t,e){var s;e&&e.firstLine&&(s=e.firstLine,t+=" - "+s+":"+e.firstColumn);for(var n=Error.prototype.constructor.call(this,t),r=0;r<i.length;r++)this[i[r]]=n[i[r]];s&&(this.lineNumber=s,this.column=e.firstColumn)}var e,i=["description","fileName","lineNumber","message","name","number","stack"];return t.prototype=new Error,e=t}(),s=function(t,e){"use strict";function i(t,e){this.helpers=t||{},this.partials=e||{},s(this)}function s(t){t.registerHelper("helperMissing",function(t){if(2===arguments.length)return void 0;throw new o("Missing helper: '"+t+"'")}),t.registerHelper("blockHelperMissing",function(e,i){var s=i.inverse||function(){},n=i.fn;return p(e)&&(e=e.call(this)),e===!0?n(this):e===!1||null==e?s(this):d(e)?e.length>0?t.helpers.each(e,i):s(this):n(e)}),t.registerHelper("each",function(t,e){var i,s=e.fn,n=e.inverse,r=0,a="";if(p(t)&&(t=t.call(this)),e.data&&(i=m(e.data)),t&&"object"==typeof t)if(d(t))for(var o=t.length;o>r;r++)i&&(i.index=r,i.first=0===r,i.last=r===t.length-1),a+=s(t[r],{data:i});else for(var l in t)t.hasOwnProperty(l)&&(i&&(i.key=l,i.index=r,i.first=0===r),a+=s(t[l],{data:i}),r++);return 0===r&&(a=n(this)),a}),t.registerHelper("if",function(t,e){return p(t)&&(t=t.call(this)),!e.hash.includeZero&&!t||a.isEmpty(t)?e.inverse(this):e.fn(this)}),t.registerHelper("unless",function(e,i){return t.helpers["if"].call(this,e,{fn:i.inverse,inverse:i.fn,hash:i.hash})}),t.registerHelper("with",function(t,e){return p(t)&&(t=t.call(this)),a.isEmpty(t)?void 0:e.fn(t)}),t.registerHelper("log",function(e,i){var s=i.data&&null!=i.data.level?parseInt(i.data.level,10):1;t.log(s,e)})}function n(t,e){g.log(t,e)}var r={},a=t,o=e,l="1.3.0";r.VERSION=l;var h=4;r.COMPILER_REVISION=h;var c={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};r.REVISION_CHANGES=c;var d=a.isArray,p=a.isFunction,u=a.toString,f="[object Object]";r.HandlebarsEnvironment=i,i.prototype={constructor:i,logger:g,log:n,registerHelper:function(t,e,i){if(u.call(t)===f){if(i||e)throw new o("Arg not supported with multiple helpers");a.extend(this.helpers,t)}else i&&(e.not=i),this.helpers[t]=e},registerPartial:function(t,e){u.call(t)===f?a.extend(this.partials,t):this.partials[t]=e}};var g={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(t,e){if(g.level<=t){var i=g.methodMap[t];"undefined"!=typeof console&&console[i]&&console[i].call(console,e)}}};r.logger=g,r.log=n;var m=function(t){var e={};return a.extend(e,t),e};return r.createFrame=m,r}(e,i),n=function(t,e,i){"use strict";function s(t){var e=t&&t[0]||1,i=p;if(e!==i){if(i>e){var s=u[i],n=u[e];throw new d("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+s+") or downgrade your runtime to an older version ("+n+").")}throw new d("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+t[1]+").")}}function n(t,e){if(!e)throw new d("No environment passed to template");var i=function(t,i,s,n,r,a){var o=e.VM.invokePartial.apply(this,arguments);if(null!=o)return o;if(e.compile){var l={helpers:n,partials:r,data:a};return r[i]=e.compile(t,{data:void 0!==a},e),r[i](s,l)}throw new d("The partial "+i+" could not be compiled when running in runtime-only mode")},s={escapeExpression:c.escapeExpression,invokePartial:i,programs:[],program:function(t,e,i){var s=this.programs[t];return i?s=a(t,e,i):s||(s=this.programs[t]=a(t,e)),s},merge:function(t,e){var i=t||e;return t&&e&&t!==e&&(i={},c.extend(i,e),c.extend(i,t)),i},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop,compilerInfo:null};return function(i,n){n=n||{};var r,a,o=n.partial?n:e;n.partial||(r=n.helpers,a=n.partials);var l=t.call(s,o,i,r,a,n.data);return n.partial||e.VM.checkRevision(s.compilerInfo),l}}function r(t,e,i){var s=Array.prototype.slice.call(arguments,3),n=function(t,n){return n=n||{},e.apply(this,[t,n.data||i].concat(s))};return n.program=t,n.depth=s.length,n}function a(t,e,i){var s=function(t,s){return s=s||{},e(t,s.data||i)};return s.program=t,s.depth=0,s}function o(t,e,i,s,n,r){var a={partial:!0,helpers:s,partials:n,data:r};if(void 0===t)throw new d("The partial "+e+" could not be found");return t instanceof Function?t(i,a):void 0}function l(){return""}var h={},c=t,d=e,p=i.COMPILER_REVISION,u=i.REVISION_CHANGES;return h.checkRevision=s,h.template=n,h.programWithDepth=r,h.program=a,h.invokePartial=o,h.noop=l,h}(e,i,s),r=function(t,e,i,s,n){"use strict";var r,a=t,o=e,l=i,h=s,c=n,d=function(){var t=new a.HandlebarsEnvironment;return h.extend(t,a),t.SafeString=o,t.Exception=l,t.Utils=h,t.VM=c,t.template=function(e){return c.template(e,t)},t},p=d();return p.create=d,r=p}(s,t,i,e,n),a=function(t){"use strict";function e(t){t=t||{},this.firstLine=t.first_line,this.firstColumn=t.first_column,this.lastColumn=t.last_column,this.lastLine=t.last_line}var i,s=t,n={ProgramNode:function(t,i,s,r){var a,o;3===arguments.length?(r=s,s=null):2===arguments.length&&(r=i,i=null),e.call(this,r),this.type="program",this.statements=t,this.strip={},s?(o=s[0],o?(a={first_line:o.firstLine,last_line:o.lastLine,last_column:o.lastColumn,first_column:o.firstColumn},this.inverse=new n.ProgramNode(s,i,a)):this.inverse=new n.ProgramNode(s,i),this.strip.right=i.left):i&&(this.strip.left=i.right)},MustacheNode:function(t,i,s,r,a){if(e.call(this,a),this.type="mustache",this.strip=r,null!=s&&s.charAt){var o=s.charAt(3)||s.charAt(2);this.escaped="{"!==o&&"&"!==o}else this.escaped=!!s;t instanceof n.SexprNode?this.sexpr=t:this.sexpr=new n.SexprNode(t,i),this.sexpr.isRoot=!0,this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(t,i,s){e.call(this,s),this.type="sexpr",this.hash=i;var n=this.id=t[0],r=this.params=t.slice(1),a=this.eligibleHelper=n.isSimple;this.isHelper=a&&(r.length||i)},PartialNode:function(t,i,s,n){e.call(this,n),this.type="partial",this.partialName=t,this.context=i,this.strip=s},BlockNode:function(t,i,n,r,a){if(e.call(this,a),t.sexpr.id.original!==r.path.original)throw new s(t.sexpr.id.original+" doesn't match "+r.path.original,this);this.type="block",this.mustache=t,this.program=i,this.inverse=n,this.strip={left:t.strip.left,right:r.strip.right},(i||n).strip.left=t.strip.right,(n||i).strip.right=r.strip.left,n&&!i&&(this.isInverse=!0)},ContentNode:function(t,i){e.call(this,i),this.type="content",this.string=t},HashNode:function(t,i){e.call(this,i),this.type="hash",this.pairs=t},IdNode:function(t,i){e.call(this,i),this.type="ID";for(var n="",r=[],a=0,o=0,l=t.length;l>o;o++){var h=t[o].part;if(n+=(t[o].separator||"")+h,".."===h||"."===h||"this"===h){if(r.length>0)throw new s("Invalid path: "+n,this);".."===h?a++:this.isScoped=!0}else r.push(h)}this.original=n,this.parts=r,this.string=r.join("."),this.depth=a,this.isSimple=1===t.length&&!this.isScoped&&0===a,this.stringModeValue=this.string},PartialNameNode:function(t,i){e.call(this,i),this.type="PARTIAL_NAME",this.name=t.original},DataNode:function(t,i){e.call(this,i),this.type="DATA",this.id=t},StringNode:function(t,i){e.call(this,i),this.type="STRING",this.original=this.string=this.stringModeValue=t},IntegerNode:function(t,i){e.call(this,i),this.type="INTEGER",this.original=this.integer=t,this.stringModeValue=Number(t)},BooleanNode:function(t,i){e.call(this,i),this.type="BOOLEAN",this.bool=t,this.stringModeValue="true"===t},CommentNode:function(t,i){e.call(this,i),this.type="comment",this.comment=t}};return i=n}(i),o=function(){"use strict";var t,e=function(){function t(t,e){return{left:"~"===t.charAt(2),right:"~"===e.charAt(0)||"~"===e.charAt(1)}}function e(){this.yy={}}var i={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,sexpr:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,sexpr_repetition0:28,sexpr_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,OPEN_SEXPR:35,CLOSE_SEXPR:36,hash:37,hash_repetition_plus0:38,hashSegment:39,ID:40,EQUALS:41,DATA:42,pathSegments:43,SEP:44,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],performAction:function(e,i,s,n,r,a,o){var l=a.length-1;switch(r){case 1:return new n.ProgramNode(a[l-1],this._$);case 2:return new n.ProgramNode([],this._$);case 3:this.$=new n.ProgramNode([],a[l-1],a[l],this._$);break;case 4:this.$=new n.ProgramNode(a[l-2],a[l-1],a[l],this._$);break;case 5:this.$=new n.ProgramNode(a[l-1],a[l],[],this._$);break;case 6:this.$=new n.ProgramNode(a[l],this._$);break;case 7:this.$=new n.ProgramNode([],this._$);break;case 8:this.$=new n.ProgramNode([],this._$);break;case 9:this.$=[a[l]];break;case 10:a[l-1].push(a[l]),this.$=a[l-1];break;case 11:this.$=new n.BlockNode(a[l-2],a[l-1].inverse,a[l-1],a[l],this._$);break;case 12:this.$=new n.BlockNode(a[l-2],a[l-1],a[l-1].inverse,a[l],this._$);break;case 13:this.$=a[l];break;case 14:this.$=a[l];break;case 15:this.$=new n.ContentNode(a[l],this._$);break;case 16:this.$=new n.CommentNode(a[l],this._$);break;case 17:this.$=new n.MustacheNode(a[l-1],null,a[l-2],t(a[l-2],a[l]),this._$);break;case 18:this.$=new n.MustacheNode(a[l-1],null,a[l-2],t(a[l-2],a[l]),this._$);break;case 19:this.$={path:a[l-1],strip:t(a[l-2],a[l])};break;case 20:this.$=new n.MustacheNode(a[l-1],null,a[l-2],t(a[l-2],a[l]),this._$);break;case 21:this.$=new n.MustacheNode(a[l-1],null,a[l-2],t(a[l-2],a[l]),this._$);break;case 22:this.$=new n.PartialNode(a[l-2],a[l-1],t(a[l-3],a[l]),this._$);break;case 23:this.$=t(a[l-1],a[l]);break;case 24:this.$=new n.SexprNode([a[l-2]].concat(a[l-1]),a[l],this._$);break;case 25:this.$=new n.SexprNode([a[l]],null,this._$);break;case 26:this.$=a[l];break;case 27:this.$=new n.StringNode(a[l],this._$);break;case 28:this.$=new n.IntegerNode(a[l],this._$);break;case 29:this.$=new n.BooleanNode(a[l],this._$);break;case 30:this.$=a[l];break;case 31:a[l-1].isHelper=!0,this.$=a[l-1];break;case 32:this.$=new n.HashNode(a[l],this._$);break;case 33:this.$=[a[l-2],a[l]];break;case 34:this.$=new n.PartialNameNode(a[l],this._$);break;case 35:this.$=new n.PartialNameNode(new n.StringNode(a[l],this._$),this._$);break;case 36:this.$=new n.PartialNameNode(new n.IntegerNode(a[l],this._$));break;case 37:this.$=new n.DataNode(a[l],this._$);break;case 38:this.$=new n.IdNode(a[l],this._$);break;case 39:a[l-2].push({part:a[l],separator:a[l-1]}),this.$=a[l-2];break;case 40:this.$=[{part:a[l]}];break;case 43:this.$=[];break;case 44:a[l-1].push(a[l]);break;case 47:this.$=[a[l]];break;case 48:a[l-1].push(a[l])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],
16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],defaultActions:{3:[2,2],16:[2,1],50:[2,42]},parseError:function(t,e){throw new Error(t)},parse:function(t){function e(){var t;return t=i.lexer.lex()||1,"number"!=typeof t&&(t=i.symbols_[t]||t),t}var i=this,s=[0],n=[null],r=[],a=this.table,o="",l=0,h=0,c=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;r.push(d);var p=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var u,f,g,m,v,b,y,$,_,k={};;){if(g=s[s.length-1],this.defaultActions[g]?m=this.defaultActions[g]:((null===u||"undefined"==typeof u)&&(u=e()),m=a[g]&&a[g][u]),"undefined"==typeof m||!m.length||!m[0]){var w="";if(!c){_=[];for(b in a[g])this.terminals_[b]&&b>2&&_.push("'"+this.terminals_[b]+"'");w=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[u]||u)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==u?"end of input":"'"+(this.terminals_[u]||u)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[u]||u,line:this.lexer.yylineno,loc:d,expected:_})}}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+u);switch(m[0]){case 1:s.push(u),n.push(this.lexer.yytext),r.push(this.lexer.yylloc),s.push(m[1]),u=null,f?(u=f,f=null):(h=this.lexer.yyleng,o=this.lexer.yytext,l=this.lexer.yylineno,d=this.lexer.yylloc,c>0&&c--);break;case 2:if(y=this.productions_[m[1]][1],k.$=n[n.length-y],k._$={first_line:r[r.length-(y||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(y||1)].first_column,last_column:r[r.length-1].last_column},p&&(k._$.range=[r[r.length-(y||1)].range[0],r[r.length-1].range[1]]),v=this.performAction.call(k,o,h,l,this.yy,m[1],n,r),"undefined"!=typeof v)return v;y&&(s=s.slice(0,-1*y*2),n=n.slice(0,-1*y),r=r.slice(0,-1*y)),s.push(this.productions_[m[1]][0]),n.push(k.$),r.push(k._$),$=a[s[s.length-2]][s[s.length-1]],s.push($);break;case 3:return!0}}return!0}},s=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e-1),this.offset-=e;var s=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===s.length?this.yylloc.first_column:0)+s[s.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-e]),this},more:function(){return this._more=!0,this},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,s,n;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),a=0;a<r.length&&(i=this._input.match(this.rules[r[a]]),!i||e&&!(i[0].length>e[0].length)||(e=i,s=a,this.options.flex));a++);return e?(n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,r[s],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.options={},t.performAction=function(t,e,i,s){function n(t,i){return e.yytext=e.yytext.substr(t,e.yyleng-i)}switch(i){case 0:if("\\\\"===e.yytext.slice(-2)?(n(0,1),this.begin("mu")):"\\"===e.yytext.slice(-1)?(n(0,1),this.begin("emu")):this.begin("mu"),e.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return n(0,4),this.popState(),15;case 4:return 35;case 5:return 36;case 6:return 25;case 7:return 16;case 8:return 20;case 9:return 19;case 10:return 19;case 11:return 23;case 12:return 22;case 13:this.popState(),this.begin("com");break;case 14:return n(3,5),this.popState(),15;case 15:return 22;case 16:return 41;case 17:return 40;case 18:return 40;case 19:return 44;case 20:break;case 21:return this.popState(),24;case 22:return this.popState(),18;case 23:return e.yytext=n(1,2).replace(/\\"/g,'"'),32;case 24:return e.yytext=n(1,2).replace(/\\'/g,"'"),32;case 25:return 42;case 26:return 34;case 27:return 34;case 28:return 33;case 29:return 40;case 30:return e.yytext=n(1,2),40;case 31:return"INVALID";case 32:return 5}},t.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],t.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},t}();return i.lexer=s,e.prototype=i,i.Parser=e,new e}();return t=e}(),l=function(t,e){"use strict";function i(t){return t.constructor===r.ProgramNode?t:(n.yy=r,n.parse(t))}var s={},n=t,r=e;return s.parser=n,s.parse=i,s}(o,a),h=function(t){"use strict";function e(){}function i(t,e,i){if(null==t||"string"!=typeof t&&t.constructor!==i.AST.ProgramNode)throw new r("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+t);e=e||{},"data"in e||(e.data=!0);var s=i.parse(t),n=(new i.Compiler).compile(s,e);return(new i.JavaScriptCompiler).compile(n,e)}function s(t,e,i){function s(){var s=i.parse(t),n=(new i.Compiler).compile(s,e),r=(new i.JavaScriptCompiler).compile(n,e,void 0,!0);return i.template(r)}if(null==t||"string"!=typeof t&&t.constructor!==i.AST.ProgramNode)throw new r("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+t);e=e||{},"data"in e||(e.data=!0);var n;return function(t,e){return n||(n=s()),n.call(this,t,e)}}var n={},r=t;return n.Compiler=e,e.prototype={compiler:e,disassemble:function(){for(var t,e,i,s=this.opcodes,n=[],r=0,a=s.length;a>r;r++)if(t=s[r],"DECLARE"===t.opcode)n.push("DECLARE "+t.name+"="+t.value);else{e=[];for(var o=0;o<t.args.length;o++)i=t.args[o],"string"==typeof i&&(i='"'+i.replace("\n","\\n")+'"'),e.push(i);n.push(t.opcode+" "+e.join(" "))}return n.join("\n")},equals:function(t){var e=this.opcodes.length;if(t.opcodes.length!==e)return!1;for(var i=0;e>i;i++){var s=this.opcodes[i],n=t.opcodes[i];if(s.opcode!==n.opcode||s.args.length!==n.args.length)return!1;for(var r=0;r<s.args.length;r++)if(s.args[r]!==n.args[r])return!1}if(e=this.children.length,t.children.length!==e)return!1;for(i=0;e>i;i++)if(!this.children[i].equals(t.children[i]))return!1;return!0},guid:0,compile:function(t,e){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=e;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},i)for(var s in i)this.options.knownHelpers[s]=i[s];return this.accept(t)},accept:function(t){var e,i=t.strip||{};return i.left&&this.opcode("strip"),e=this[t.type](t),i.right&&this.opcode("strip"),e},program:function(t){for(var e=t.statements,i=0,s=e.length;s>i;i++)this.accept(e[i]);return this.isSimple=1===s,this.depths.list=this.depths.list.sort(function(t,e){return t-e}),this},compileProgram:function(t){var e,i=(new this.compiler).compile(t,this.options),s=this.guid++;this.usePartial=this.usePartial||i.usePartial,this.children[s]=i;for(var n=0,r=i.depths.list.length;r>n;n++)e=i.depths.list[n],2>e||this.addDepth(e-1);return s},block:function(t){var e=t.mustache,i=t.program,s=t.inverse;i&&(i=this.compileProgram(i)),s&&(s=this.compileProgram(s));var n=e.sexpr,r=this.classifySexpr(n);"helper"===r?this.helperSexpr(n,i,s):"simple"===r?(this.simpleSexpr(n),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousSexpr(n,i,s),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(t){var e,i,s=t.pairs;this.opcode("pushHash");for(var n=0,r=s.length;r>n;n++)e=s[n],i=e[1],this.options.stringParams?(i.depth&&this.addDepth(i.depth),this.opcode("getContext",i.depth||0),this.opcode("pushStringParam",i.stringModeValue,i.type),"sexpr"===i.type&&this.sexpr(i)):this.accept(i),this.opcode("assignToHash",e[0]);this.opcode("popHash")},partial:function(t){var e=t.partialName;this.usePartial=!0,t.context?this.ID(t.context):this.opcode("push","depth0"),this.opcode("invokePartial",e.name),this.opcode("append")},content:function(t){this.opcode("appendContent",t.string)},mustache:function(t){this.sexpr(t.sexpr),t.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(t,e,i){var s=t.id,n=s.parts[0],r=null!=e||null!=i;this.opcode("getContext",s.depth),this.opcode("pushProgram",e),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",n,r)},simpleSexpr:function(t){var e=t.id;"DATA"===e.type?this.DATA(e):e.parts.length?this.ID(e):(this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(t,e,i){var s=this.setupFullMustacheParams(t,e,i),n=t.id.parts[0];if(this.options.knownHelpers[n])this.opcode("invokeKnownHelper",s.length,n);else{if(this.options.knownHelpersOnly)throw new r("You specified knownHelpersOnly, but used the unknown helper "+n,t);this.opcode("invokeHelper",s.length,n,t.isRoot)}},sexpr:function(t){var e=this.classifySexpr(t);"simple"===e?this.simpleSexpr(t):"helper"===e?this.helperSexpr(t):this.ambiguousSexpr(t)},ID:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth);var e=t.parts[0];e?this.opcode("lookupOnContext",t.parts[0]):this.opcode("pushContext");for(var i=1,s=t.parts.length;s>i;i++)this.opcode("lookup",t.parts[i])},DATA:function(t){if(this.options.data=!0,t.id.isScoped||t.id.depth)throw new r("Scoped data references are not supported: "+t.original,t);this.opcode("lookupData");for(var e=t.id.parts,i=0,s=e.length;s>i;i++)this.opcode("lookup",e[i])},STRING:function(t){this.opcode("pushString",t.string)},INTEGER:function(t){this.opcode("pushLiteral",t.integer)},BOOLEAN:function(t){this.opcode("pushLiteral",t.bool)},comment:function(){},opcode:function(t){this.opcodes.push({opcode:t,args:[].slice.call(arguments,1)})},declare:function(t,e){this.opcodes.push({opcode:"DECLARE",name:t,value:e})},addDepth:function(t){0!==t&&(this.depths[t]||(this.depths[t]=!0,this.depths.list.push(t)))},classifySexpr:function(t){var e=t.isHelper,i=t.eligibleHelper,s=this.options;if(i&&!e){var n=t.id.parts[0];s.knownHelpers[n]?e=!0:s.knownHelpersOnly&&(i=!1)}return e?"helper":i?"ambiguous":"simple"},pushParams:function(t){for(var e,i=t.length;i--;)e=t[i],this.options.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.stringModeValue,e.type),"sexpr"===e.type&&this.sexpr(e)):this[e.type](e)},setupFullMustacheParams:function(t,e,i){var s=t.params;return this.pushParams(s),this.opcode("pushProgram",e),this.opcode("pushProgram",i),t.hash?this.hash(t.hash):this.opcode("emptyHash"),s}},n.precompile=i,n.compile=s,n}(i),c=function(t,e){"use strict";function i(t){this.value=t}function s(){}var n,r=t.COMPILER_REVISION,a=t.REVISION_CHANGES,o=t.log,l=e;s.prototype={nameLookup:function(t,e){var i,n;return 0===t.indexOf("depth")&&(i=!0),n=/^[0-9]+$/.test(e)?t+"["+e+"]":s.isValidJavaScriptVariableName(e)?t+"."+e:t+"['"+e+"']",i?"("+t+" && "+n+")":n},compilerInfo:function(){var t=r,e=a[t];return"this.compilerInfo = ["+t+",'"+e+"'];\n"},appendToBuffer:function(t){return this.environment.isSimple?"return "+t+";":{appendToBuffer:!0,content:t,toString:function(){return"buffer += "+t+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(t,e,i,s){this.environment=t,this.options=e||{},o("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!i,this.context=i||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(t,e);var n,r=t.opcodes;this.i=0;for(var a=r.length;this.i<a;this.i++)n=r[this.i],"DECLARE"===n.opcode?this[n.name]=n.value:this[n.opcode].apply(this,n.args),n.opcode!==this.stripNext&&(this.stripNext=!1);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new l("Compile completed with content left on stack");return this.createFunctionContext(s)},preamble:function(){var t=[];if(this.isChild)t.push("");else{var e=this.namespace,i="helpers = this.merge(helpers, "+e+".helpers);";this.environment.usePartial&&(i=i+" partials = this.merge(partials, "+e+".partials);"),this.options.data&&(i+=" data = data || {};"),t.push(i)}this.environment.isSimple?t.push(""):t.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=t},createFunctionContext:function(t){var e=this.stackVars.concat(this.registers.list);if(e.length>0&&(this.source[1]=this.source[1]+", "+e.join(", ")),!this.isChild)for(var i in this.context.aliases)this.context.aliases.hasOwnProperty(i)&&(this.source[1]=this.source[1]+", "+i+"="+this.context.aliases[i]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var s=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],n=0,r=this.environment.depths.list.length;r>n;n++)s.push("depth"+this.environment.depths.list[n]);var a=this.mergeSource();if(this.isChild||(a=this.compilerInfo()+a),t)return s.push(a),Function.apply(this,s);var l="function "+(this.name||"")+"("+s.join(",")+") {\n  "+a+"}";return o("debug",l+"\n\n"),l},mergeSource:function(){for(var t,e="",i=0,s=this.source.length;s>i;i++){var n=this.source[i];n.appendToBuffer?t=t?t+"\n    + "+n.content:n.content:(t&&(e+="buffer += "+t+";\n  ",t=void 0),e+=n+"\n  ")}return e},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t),this.replaceStack(function(e){return t.splice(1,0,e),"blockHelperMissing.call("+t.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t);var e=this.topStack();t.splice(1,0,e),this.pushSource("if (!"+this.lastHelper+") { "+e+" = blockHelperMissing.call("+t.join(", ")+"); }")},appendContent:function(t){this.pendingContent&&(t=this.pendingContent+t),this.stripNext&&(t=t.replace(/^\s+/,"")),this.pendingContent=t},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var t=this.popStack();this.pushSource("if("+t+" || "+t+" === 0) { "+this.appendToBuffer(t)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(t){this.lastContext!==t&&(this.lastContext=t)},lookupOnContext:function(t){this.push(this.nameLookup("depth"+this.lastContext,t,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(t){return"typeof "+t+" === functionType ? "+t+".apply(depth0) : "+t})},lookup:function(t){this.replaceStack(function(e){return e+" == null || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")})},lookupData:function(){this.pushStackLiteral("data")},pushStringParam:function(t,e){this.pushStackLiteral("depth"+this.lastContext),this.pushString(e),"sexpr"!==e&&("string"==typeof t?this.pushString(t):this.pushStackLiteral(t))},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[]}},popHash:function(){var t=this.hash;this.hash=this.hashes.pop(),this.options.stringParams&&(this.push("{"+t.contexts.join(",")+"}"),this.push("{"+t.types.join(",")+"}")),this.push("{\n    "+t.values.join(",\n    ")+"\n  }")},pushString:function(t){this.pushStackLiteral(this.quotedString(t))},push:function(t){return this.inlineStack.push(t),t},pushLiteral:function(t){this.pushStackLiteral(t)},pushProgram:function(t){null!=t?this.pushStackLiteral(this.programExpression(t)):this.pushStackLiteral(null)},invokeHelper:function(t,e,i){this.context.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var s=this.lastHelper=this.setupHelper(t,e,!0),n=this.nameLookup("depth"+this.lastContext,e,"context"),r="helper = "+s.name+" || "+n;s.paramsInit&&(r+=","+s.paramsInit),this.push("("+r+",helper ? helper.call("+s.callParams+") : helperMissing.call("+s.helperMissingParams+"))"),i||this.flushInline()},invokeKnownHelper:function(t,e){var i=this.setupHelper(t,e);this.push(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(t,e){this.context.aliases.functionType='"function"',this.useRegister("helper"),this.emptyHash();var i=this.setupHelper(0,t,e),s=this.lastHelper=this.nameLookup("helpers",t,"helper"),n=this.nameLookup("depth"+this.lastContext,t,"context"),r=this.nextStack();i.paramsInit&&this.pushSource(i.paramsInit),this.pushSource("if (helper = "+s+") { "+r+" = helper.call("+i.callParams+"); }"),this.pushSource("else { helper = "+n+"; "+r+" = typeof helper === functionType ? helper.call("+i.callParams+") : helper; }")},invokePartial:function(t){var e=[this.nameLookup("partials",t,"partial"),"'"+t+"'",this.popStack(),"helpers","partials"];this.options.data&&e.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+e.join(", ")+")")},assignToHash:function(t){var e,i,s=this.popStack();this.options.stringParams&&(i=this.popStack(),e=this.popStack());var n=this.hash;e&&n.contexts.push("'"+t+"': "+e),i&&n.types.push("'"+t+"': "+i),n.values.push("'"+t+"': ("+s+")")},compiler:s,compileChildren:function(t,e){for(var i,s,n=t.children,r=0,a=n.length;a>r;r++){i=n[r],s=new this.compiler;var o=this.matchExistingProgram(i);null==o?(this.context.programs.push(""),o=this.context.programs.length,i.index=o,i.name="program"+o,this.context.programs[o]=s.compile(i,e,this.context),this.context.environments[o]=i):(i.index=o,i.name="program"+o)}},matchExistingProgram:function(t){for(var e=0,i=this.context.environments.length;i>e;e++){var s=this.context.environments[e];if(s&&s.equals(t))return e}},programExpression:function(t){if(this.context.aliases.self="this",null==t)return"self.noop";for(var e,i=this.environment.children[t],s=i.depths.list,n=[i.index,i.name,"data"],r=0,a=s.length;a>r;r++)e=s[r],1===e?n.push("depth0"):n.push("depth"+(e-1));return(0===s.length?"self.program(":"self.programWithDepth(")+n.join(", ")+")"},register:function(t,e){this.useRegister(t),this.pushSource(t+" = "+e+";")},useRegister:function(t){this.registers[t]||(this.registers[t]=!0,this.registers.list.push(t))},pushStackLiteral:function(t){return this.push(new i(t))},pushSource:function(t){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),t&&this.source.push(t)},pushStack:function(t){this.flushInline();var e=this.incrStack();return t&&this.pushSource(e+" = "+t+";"),this.compileStack.push(e),e},replaceStack:function(t){var e,s,n,r="",a=this.isInline();if(a){var o=this.popStack(!0);if(o instanceof i)e=o.value,n=!0;else{s=!this.stackSlot;var l=s?this.incrStack():this.topStackName();r="("+this.push(l)+" = "+o+"),",e=this.topStack()}}else e=this.topStack();var h=t.call(this,e);return a?(n||this.popStack(),s&&this.stackSlot--,this.push("("+r+h+")")):(/^stack/.test(e)||(e=this.nextStack()),this.pushSource(e+" = ("+r+h+");")),e},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var t=this.inlineStack;if(t.length){this.inlineStack=[];for(var e=0,s=t.length;s>e;e++){var n=t[e];n instanceof i?this.compileStack.push(n):this.pushStack(n)}}},isInline:function(){return this.inlineStack.length},popStack:function(t){var e=this.isInline(),s=(e?this.inlineStack:this.compileStack).pop();if(!t&&s instanceof i)return s.value;if(!e){if(!this.stackSlot)throw new l("Invalid stack pop");this.stackSlot--}return s},topStack:function(t){var e=this.isInline()?this.inlineStack:this.compileStack,s=e[e.length-1];return!t&&s instanceof i?s.value:s},quotedString:function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(t,e,i){var s=[],n=this.setupParams(t,s,i),r=this.nameLookup("helpers",e,"helper");return{params:s,paramsInit:n,name:r,callParams:["depth0"].concat(s).join(", "),helperMissingParams:i&&["depth0",this.quotedString(e)].concat(s).join(", ")}},setupOptions:function(t,e){var i,s,n,r=[],a=[],o=[];r.push("hash:"+this.popStack()),this.options.stringParams&&(r.push("hashTypes:"+this.popStack()),r.push("hashContexts:"+this.popStack())),s=this.popStack(),n=this.popStack(),(n||s)&&(n||(this.context.aliases.self="this",n="self.noop"),s||(this.context.aliases.self="this",s="self.noop"),r.push("inverse:"+s),r.push("fn:"+n));for(var l=0;t>l;l++)i=this.popStack(),e.push(i),this.options.stringParams&&(o.push(this.popStack()),a.push(this.popStack()));return this.options.stringParams&&(r.push("contexts:["+a.join(",")+"]"),r.push("types:["+o.join(",")+"]")),this.options.data&&r.push("data:data"),r},setupParams:function(t,e,i){var s="{"+this.setupOptions(t,e).join(",")+"}";return i?(this.useRegister("options"),e.push("options"),"options="+s):(e.push(s),"")}};for(var h="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),c=s.RESERVED_WORDS={},d=0,p=h.length;p>d;d++)c[h[d]]=!0;return s.isValidJavaScriptVariableName=function(t){return!s.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(t)?!0:!1},n=s}(s,i),d=function(t,e,i,s,n){"use strict";var r,a=t,o=e,l=i.parser,h=i.parse,c=s.Compiler,d=s.compile,p=s.precompile,u=n,f=a.create,g=function(){var t=f();return t.compile=function(e,i){return d(e,i,t)},t.precompile=function(e,i){return p(e,i,t)},t.AST=o,t.Compiler=c,t.JavaScriptCompiler=u,t.Parser=l,t.parse=h,t};return a=g(),a.create=g,r=a}(r,a,l,h,c);return d}();!function(t,e){function i(){return new Date(Date.UTC.apply(Date,arguments))}function s(){var t=new Date;return i(t.getFullYear(),t.getMonth(),t.getDate())}function n(t){return function(){return this[t].apply(this,arguments)}}function r(e,i){function s(t,e){return e.toLowerCase()}var n,r=t(e).data(),a={},o=new RegExp("^"+i.toLowerCase()+"([A-Z])");i=new RegExp("^"+i.toLowerCase());for(var l in r)i.test(l)&&(n=l.replace(o,s),a[n]=r[l]);return a}function a(e){var i={};if(f[e]||(e=e.split("-")[0],f[e])){var s=f[e];return t.each(u,function(t,e){e in s&&(i[e]=s[e])}),i}}var o=t(window),l=function(){var e={get:function(t){return this.slice(t)[0]},contains:function(t){for(var e=t&&t.valueOf(),i=0,s=this.length;s>i;i++)if(this[i].valueOf()===e)return i;return-1},remove:function(t){this.splice(t,1)},replace:function(e){e&&(t.isArray(e)||(e=[e]),this.clear(),this.push.apply(this,e))},clear:function(){this.length=0},copy:function(){var t=new l;return t.replace(this),t}};return function(){var i=[];return i.push.apply(i,arguments),t.extend(i,e),i}}(),h=function(e,i){this.dates=new l,this.viewDate=s(),this.focusDate=null,this._process_options(i),this.element=t(e),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=t(g.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today, tfoot th.clear").attr("colspan",function(t,e){return parseInt(e)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};h.prototype={constructor:h,_process_options:function(e){this._o=t.extend({},this._o,e);var i=this.o=t.extend({},this._o),s=i.language;switch(f[s]||(s=s.split("-")[0],f[s]||(s=p.language)),i.language=s,i.startView){case 2:case"decade":i.startView=2;break;case 1:case"year":i.startView=1;break;default:i.startView=0}switch(i.minViewMode){case 1:case"months":i.minViewMode=1;break;case 2:case"years":i.minViewMode=2;break;default:i.minViewMode=0}i.startView=Math.max(i.startView,i.minViewMode),i.multidate!==!0&&(i.multidate=Number(i.multidate)||!1,i.multidate!==!1?i.multidate=Math.max(0,i.multidate):i.multidate=1),i.multidateSeparator=String(i.multidateSeparator),i.weekStart%=7,i.weekEnd=(i.weekStart+6)%7;var n=g.parseFormat(i.format);i.startDate!==-(1/0)&&(i.startDate?i.startDate instanceof Date?i.startDate=this._local_to_utc(this._zero_time(i.startDate)):i.startDate=g.parseDate(i.startDate,n,i.language):i.startDate=-(1/0)),i.endDate!==1/0&&(i.endDate?i.endDate instanceof Date?i.endDate=this._local_to_utc(this._zero_time(i.endDate)):i.endDate=g.parseDate(i.endDate,n,i.language):i.endDate=1/0),i.daysOfWeekDisabled=i.daysOfWeekDisabled||[],t.isArray(i.daysOfWeekDisabled)||(i.daysOfWeekDisabled=i.daysOfWeekDisabled.split(/[,\s]*/)),i.daysOfWeekDisabled=t.map(i.daysOfWeekDisabled,function(t){return parseInt(t,10)});var r=String(i.orientation).toLowerCase().split(/\s+/g),a=i.orientation.toLowerCase();if(r=t.grep(r,function(t){return/^auto|left|right|top|bottom$/.test(t)}),i.orientation={
x:"auto",y:"auto"},a&&"auto"!==a)if(1===r.length)switch(r[0]){case"top":case"bottom":i.orientation.y=r[0];break;case"left":case"right":i.orientation.x=r[0]}else a=t.grep(r,function(t){return/^left|right$/.test(t)}),i.orientation.x=a[0]||"auto",a=t.grep(r,function(t){return/^top|bottom$/.test(t)}),i.orientation.y=a[0]||"auto";else;},_events:[],_secondaryEvents:[],_applyEvents:function(t){for(var i,s,n,r=0;r<t.length;r++)i=t[r][0],2===t[r].length?(s=e,n=t[r][1]):3===t[r].length&&(s=t[r][1],n=t[r][2]),i.on(n,s)},_unapplyEvents:function(t){for(var i,s,n,r=0;r<t.length;r++)i=t[r][0],2===t[r].length?(n=e,s=t[r][1]):3===t[r].length&&(n=t[r][1],s=t[r][2]),i.off(s,n)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:t.proxy(this.show,this),keyup:t.proxy(function(e){-1===t.inArray(e.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:t.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:t.proxy(this.show,this),keyup:t.proxy(function(e){-1===t.inArray(e.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:t.proxy(this.keydown,this)}],[this.component,{click:t.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:t.proxy(function(t){this._focused_from=t.target},this)}],[this.element,{blur:t.proxy(function(t){this._focused_from=t.target},this)}]),this._secondaryEvents=[[this.picker,{click:t.proxy(this.click,this)}],[t(window),{resize:t.proxy(this.place,this)}],[t(document),{"mousedown touchstart":t.proxy(function(t){this.element.is(t.target)||this.element.find(t.target).length||this.picker.is(t.target)||this.picker.find(t.target).length||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(e,i){var s=i||this.dates.get(-1),n=this._utc_to_local(s);this.element.trigger({type:e,date:n,dates:t.map(this.dates,this._utc_to_local),format:t.proxy(function(t,e){0===arguments.length?(t=this.dates.length-1,e=this.o.format):"string"==typeof t&&(e=t,t=this.dates.length-1),e=e||this.o.format;var i=this.dates.get(t);return g.formatDate(i,e,this.o.language)},this)})},show:function(){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.place(),this._attachSecondaryEvents(),this._trigger("show")},hide:function(){this.isInline||this.picker.is(":visible")&&(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},_utc_to_local:function(t){return t&&new Date(t.getTime()+6e4*t.getTimezoneOffset())},_local_to_utc:function(t){return t&&new Date(t.getTime()-6e4*t.getTimezoneOffset())},_zero_time:function(t){return t&&new Date(t.getFullYear(),t.getMonth(),t.getDate())},_zero_utc_time:function(t){return t&&new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()))},getDates:function(){return t.map(this.dates,this._utc_to_local)},getUTCDates:function(){return t.map(this.dates,function(t){return new Date(t)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){return new Date(this.dates.get(-1))},setDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,e),this._trigger("changeDate"),this.setValue()},setUTCDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,t.map(e,this._utc_to_local)),this._trigger("changeDate"),this.setValue()},setDate:n("setDates"),setUTCDate:n("setUTCDates"),setValue:function(){var t=this.getFormattedDate();this.isInput?this.element.val(t).change():this.component&&this.element.find("input").val(t).change()},getFormattedDate:function(i){i===e&&(i=this.o.format);var s=this.o.language;return t.map(this.dates,function(t){return g.formatDate(t,i,s)}).join(this.o.multidateSeparator)},setStartDate:function(t){this._process_options({startDate:t}),this.update(),this.updateNavArrows()},setEndDate:function(t){this._process_options({endDate:t}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(t){this._process_options({daysOfWeekDisabled:t}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var e=this.picker.outerWidth(),i=this.picker.outerHeight(),s=10,n=o.width(),r=o.height(),a=o.scrollTop(),l=[];this.element.parents().each(function(){var e=t(this).css("z-index");"auto"!==e&&0!==e&&l.push(parseInt(e))});var h=Math.max.apply(Math,l)+10,c=this.component?this.component.parent().offset():this.element.offset(),d=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),p=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),u=c.left,f=c.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(u-=e-p)):(this.picker.addClass("datepicker-orient-left"),c.left<0?u-=c.left-s:c.left+e>n&&(u=n-e-s));var g,m,v=this.o.orientation.y;"auto"===v&&(g=-a+c.top-i,m=a+r-(c.top+d+i),v=Math.max(g,m)===m?"top":"bottom"),this.picker.addClass("datepicker-orient-"+v),"top"===v?f+=d:f-=i+parseInt(this.picker.css("padding-top")),this.picker.css({top:f,left:u,zIndex:h})}},_allow_update:!0,update:function(){if(this._allow_update){var e=this.dates.copy(),i=[],s=!1;arguments.length?(t.each(arguments,t.proxy(function(t,e){e instanceof Date&&(e=this._local_to_utc(e)),i.push(e)},this)),s=!0):(i=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),i=i&&this.o.multidate?i.split(this.o.multidateSeparator):[i],delete this.element.data().date),i=t.map(i,t.proxy(function(t){return g.parseDate(t,this.o.format,this.o.language)},this)),i=t.grep(i,t.proxy(function(t){return t<this.o.startDate||t>this.o.endDate||!t},this),!0),this.dates.replace(i),this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate&&(this.viewDate=new Date(this.o.endDate)),s?this.setValue():i.length&&String(e)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&e.length&&this._trigger("clearDate"),this.fill()}},fillDow:function(){var t=this.o.weekStart,e="<tr>";if(this.o.calendarWeeks){var i='<th class="cw">&nbsp;</th>';e+=i,this.picker.find(".datepicker-days thead tr:first-child").prepend(i)}for(;t<this.o.weekStart+7;)e+='<th class="dow">'+f[this.o.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;12>e;)t+='<span class="month">'+f[this.o.language].monthsShort[e++]+"</span>";this.picker.find(".datepicker-months td").html(t)},setRange:function(e){e&&e.length?this.range=t.map(e,function(t){return t.valueOf()}):delete this.range,this.fill()},getClassNames:function(e){var i=[],s=this.viewDate.getUTCFullYear(),n=this.viewDate.getUTCMonth(),r=new Date;return e.getUTCFullYear()<s||e.getUTCFullYear()===s&&e.getUTCMonth()<n?i.push("old"):(e.getUTCFullYear()>s||e.getUTCFullYear()===s&&e.getUTCMonth()>n)&&i.push("new"),this.focusDate&&e.valueOf()===this.focusDate.valueOf()&&i.push("focused"),this.o.todayHighlight&&e.getUTCFullYear()===r.getFullYear()&&e.getUTCMonth()===r.getMonth()&&e.getUTCDate()===r.getDate()&&i.push("today"),-1!==this.dates.contains(e)&&i.push("active"),(e.valueOf()<this.o.startDate||e.valueOf()>this.o.endDate||-1!==t.inArray(e.getUTCDay(),this.o.daysOfWeekDisabled))&&i.push("disabled"),this.range&&(e>this.range[0]&&e<this.range[this.range.length-1]&&i.push("range"),-1!==t.inArray(e.valueOf(),this.range)&&i.push("selected")),i},fill:function(){var s,n=new Date(this.viewDate),r=n.getUTCFullYear(),a=n.getUTCMonth(),o=this.o.startDate!==-(1/0)?this.o.startDate.getUTCFullYear():-(1/0),l=this.o.startDate!==-(1/0)?this.o.startDate.getUTCMonth():-(1/0),h=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,c=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,d=f[this.o.language].today||f.en.today||"",p=f[this.o.language].clear||f.en.clear||"";if(!isNaN(r)&&!isNaN(a)){this.picker.find(".datepicker-days thead th.datepicker-switch").text(f[this.o.language].months[a]+" "+r),this.picker.find("tfoot th.today").text(d).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot th.clear").text(p).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var u=i(r,a-1,28),m=g.getDaysInMonth(u.getUTCFullYear(),u.getUTCMonth());u.setUTCDate(m),u.setUTCDate(m-(u.getUTCDay()-this.o.weekStart+7)%7);var v=new Date(u);v.setUTCDate(v.getUTCDate()+42),v=v.valueOf();for(var b,y=[];u.valueOf()<v;){if(u.getUTCDay()===this.o.weekStart&&(y.push("<tr>"),this.o.calendarWeeks)){var $=new Date(+u+(this.o.weekStart-u.getUTCDay()-7)%7*864e5),_=new Date(Number($)+(11-$.getUTCDay())%7*864e5),k=new Date(Number(k=i(_.getUTCFullYear(),0,1))+(11-k.getUTCDay())%7*864e5),w=(_-k)/864e5/7+1;y.push('<td class="cw">'+w+"</td>")}if(b=this.getClassNames(u),b.push("day"),this.o.beforeShowDay!==t.noop){var x=this.o.beforeShowDay(this._utc_to_local(u));x===e?x={}:"boolean"==typeof x?x={enabled:x}:"string"==typeof x&&(x={classes:x}),x.enabled===!1&&b.push("disabled"),x.classes&&(b=b.concat(x.classes.split(/\s+/))),x.tooltip&&(s=x.tooltip)}b=t.unique(b),y.push('<td class="'+b.join(" ")+'"'+(s?' title="'+s+'"':"")+">"+u.getUTCDate()+"</td>"),s=null,u.getUTCDay()===this.o.weekEnd&&y.push("</tr>"),u.setUTCDate(u.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(y.join(""));var S=this.picker.find(".datepicker-months").find("th:eq(1)").text(r).end().find("span").removeClass("active");t.each(this.dates,function(t,e){e.getUTCFullYear()===r&&S.eq(e.getUTCMonth()).addClass("active")}),(o>r||r>h)&&S.addClass("disabled"),r===o&&S.slice(0,l).addClass("disabled"),r===h&&S.slice(c+1).addClass("disabled"),y="",r=10*parseInt(r/10,10);var C=this.picker.find(".datepicker-years").find("th:eq(1)").text(r+"-"+(r+9)).end().find("td");r-=1;for(var T,D=t.map(this.dates,function(t){return t.getUTCFullYear()}),E=-1;11>E;E++)T=["year"],-1===E?T.push("old"):10===E&&T.push("new"),-1!==t.inArray(r,D)&&T.push("active"),(o>r||r>h)&&T.push("disabled"),y+='<span class="'+T.join(" ")+'">'+r+"</span>",r+=1;C.html(y)}},updateNavArrows:function(){if(this._allow_update){var t=new Date(this.viewDate),e=t.getUTCFullYear(),i=t.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-(1/0)&&e<=this.o.startDate.getUTCFullYear()&&i<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==1/0&&e>=this.o.endDate.getUTCFullYear()&&i>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-(1/0)&&e<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==1/0&&e>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}}},click:function(e){e.preventDefault();var s,n,r,a=t(e.target).closest("span, td, th");if(1===a.length)switch(a[0].nodeName.toLowerCase()){case"th":switch(a[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var o=g.modes[this.viewMode].navStep*("prev"===a[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,o),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,o),1===this.viewMode&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var l=new Date;l=i(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),this.showMode(-2);var h="linked"===this.o.todayBtn?null:"view";this._setDate(l,h);break;case"clear":var c;this.isInput?c=this.element:this.component&&(c=this.element.find("input")),c&&c.val("").change(),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()}break;case"span":a.is(".disabled")||(this.viewDate.setUTCDate(1),a.is(".month")?(r=1,n=a.parent().find("span").index(a),s=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(n),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(i(s,n,r))):(r=1,n=0,s=parseInt(a.text(),10)||0,this.viewDate.setUTCFullYear(s),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(i(s,n,r))),this.showMode(-1),this.fill());break;case"td":a.is(".day")&&!a.is(".disabled")&&(r=parseInt(a.text(),10)||1,s=this.viewDate.getUTCFullYear(),n=this.viewDate.getUTCMonth(),a.is(".old")?0===n?(n=11,s-=1):n-=1:a.is(".new")&&(11===n?(n=0,s+=1):n+=1),this._setDate(i(s,n,r)))}this.picker.is(":visible")&&this._focused_from&&t(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(t){var e=this.dates.contains(t);if(t||this.dates.clear(),1===this.o.multidate&&0===e||(-1!==e?this.dates.remove(e):this.dates.push(t)),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(t,e){e&&"date"!==e||this._toggle_multidate(t&&new Date(t)),e&&"view"!==e||(this.viewDate=t&&new Date(t)),this.fill(),this.setValue(),this._trigger("changeDate");var i;this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&i.change(),!this.o.autoclose||e&&"date"!==e||this.hide()},moveMonth:function(t,i){if(!t)return e;if(!i)return t;var s,n,r=new Date(t.valueOf()),a=r.getUTCDate(),o=r.getUTCMonth(),l=Math.abs(i);if(i=i>0?1:-1,1===l)n=-1===i?function(){return r.getUTCMonth()===o}:function(){return r.getUTCMonth()!==s},s=o+i,r.setUTCMonth(s),(0>s||s>11)&&(s=(s+12)%12);else{for(var h=0;l>h;h++)r=this.moveMonth(r,i);s=r.getUTCMonth(),r.setUTCDate(a),n=function(){return s!==r.getUTCMonth()}}for(;n();)r.setUTCDate(--a),r.setUTCMonth(s);return r},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.o.startDate&&t<=this.o.endDate},keydown:function(t){if(this.picker.is(":not(:visible)"))return void(27===t.keyCode&&this.show());var e,i,n,r=!1,a=this.focusDate||this.viewDate;switch(t.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),t.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;e=37===t.keyCode?-1:1,t.ctrlKey?(i=this.moveYear(this.dates.get(-1)||s(),e),n=this.moveYear(a,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(i=this.moveMonth(this.dates.get(-1)||s(),e),n=this.moveMonth(a,e),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||s()),i.setUTCDate(i.getUTCDate()+e),n=new Date(a),n.setUTCDate(a.getUTCDate()+e)),this.dateWithinRange(i)&&(this.focusDate=this.viewDate=n,this.setValue(),this.fill(),t.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;e=38===t.keyCode?-1:1,t.ctrlKey?(i=this.moveYear(this.dates.get(-1)||s(),e),n=this.moveYear(a,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(i=this.moveMonth(this.dates.get(-1)||s(),e),n=this.moveMonth(a,e),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||s()),i.setUTCDate(i.getUTCDate()+7*e),n=new Date(a),n.setUTCDate(a.getUTCDate()+7*e)),this.dateWithinRange(i)&&(this.focusDate=this.viewDate=n,this.setValue(),this.fill(),t.preventDefault());break;case 32:break;case 13:a=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(a),r=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(t.preventDefault(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(r){this.dates.length?this._trigger("changeDate"):this._trigger("clearDate");var o;this.isInput?o=this.element:this.component&&(o=this.element.find("input")),o&&o.change()}},showMode:function(t){t&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+t))),this.picker.find(">div").hide().filter(".datepicker-"+g.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var c=function(e,i){this.element=t(e),this.inputs=t.map(i.inputs,function(t){return t.jquery?t[0]:t}),delete i.inputs,t(this.inputs).datepicker(i).bind("changeDate",t.proxy(this.dateUpdated,this)),this.pickers=t.map(this.inputs,function(e){return t(e).data("datepicker")}),this.updateDates()};c.prototype={updateDates:function(){this.dates=t.map(this.pickers,function(t){return t.getUTCDate()}),this.updateRanges()},updateRanges:function(){var e=t.map(this.dates,function(t){return t.valueOf()});t.each(this.pickers,function(t,i){i.setRange(e)})},dateUpdated:function(e){if(!this.updating){this.updating=!0;var i=t(e.target).data("datepicker"),s=i.getUTCDate(),n=t.inArray(e.target,this.inputs),r=this.inputs.length;if(-1!==n){if(t.each(this.pickers,function(t,e){e.getUTCDate()||e.setUTCDate(s)}),s<this.dates[n])for(;n>=0&&s<this.dates[n];)this.pickers[n--].setUTCDate(s);else if(s>this.dates[n])for(;r>n&&s>this.dates[n];)this.pickers[n++].setUTCDate(s);this.updateDates(),delete this.updating}}},remove:function(){t.map(this.pickers,function(t){t.remove()}),delete this.element.data().datepicker}};var d=t.fn.datepicker;t.fn.datepicker=function(i){var s=Array.apply(null,arguments);s.shift();var n;return this.each(function(){var o=t(this),l=o.data("datepicker"),d="object"==typeof i&&i;if(!l){var u=r(this,"date"),f=t.extend({},p,u,d),g=a(f.language),m=t.extend({},p,g,u,d);if(o.is(".input-daterange")||m.inputs){var v={inputs:m.inputs||o.find("input").toArray()};o.data("datepicker",l=new c(this,t.extend(m,v)))}else o.data("datepicker",l=new h(this,m))}return"string"==typeof i&&"function"==typeof l[i]&&(n=l[i].apply(l,s),n!==e)?!1:void 0}),n!==e?n:this};var p=t.fn.datepicker.defaults={autoclose:!1,beforeShowDay:t.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-(1/0),startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},u=t.fn.datepicker.locale_opts=["format","rtl","weekStart"];t.fn.datepicker.Constructor=h;var f=t.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},g={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(t){return t%4===0&&t%100!==0||t%400===0},getDaysInMonth:function(t,e){return[31,g.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(t){var e=t.replace(this.validParts,"\x00").split("\x00"),i=t.match(this.validParts);if(!e||!e.length||!i||0===i.length)throw new Error("Invalid date format.");return{separators:e,parts:i}},parseDate:function(s,n,r){function a(){var t=this.slice(0,p[c].length),e=p[c].slice(0,t.length);return t===e}if(!s)return e;if(s instanceof Date)return s;"string"==typeof n&&(n=g.parseFormat(n));var o,l,c,d=/([\-+]\d+)([dmwy])/,p=s.match(/([\-+]\d+)([dmwy])/g);if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(s)){for(s=new Date,c=0;c<p.length;c++)switch(o=d.exec(p[c]),l=parseInt(o[1]),o[2]){case"d":s.setUTCDate(s.getUTCDate()+l);break;case"m":s=h.prototype.moveMonth.call(h.prototype,s,l);break;case"w":s.setUTCDate(s.getUTCDate()+7*l);break;case"y":s=h.prototype.moveYear.call(h.prototype,s,l)}return i(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),0,0,0)}p=s&&s.match(this.nonpunctuation)||[],s=new Date;var u,m,v={},b=["yyyy","yy","M","MM","m","mm","d","dd"],y={yyyy:function(t,e){return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){if(isNaN(t))return t;for(e-=1;0>e;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!==e;)t.setUTCDate(t.getUTCDate()-1);return t},d:function(t,e){return t.setUTCDate(e)}};y.M=y.MM=y.mm=y.m,y.dd=y.d,s=i(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0);var $=n.parts.slice();if(p.length!==$.length&&($=t($).filter(function(e,i){return-1!==t.inArray(i,b)}).toArray()),p.length===$.length){var _;for(c=0,_=$.length;_>c;c++){if(u=parseInt(p[c],10),o=$[c],isNaN(u))switch(o){case"MM":m=t(f[r].months).filter(a),u=t.inArray(m[0],f[r].months)+1;break;case"M":m=t(f[r].monthsShort).filter(a),u=t.inArray(m[0],f[r].monthsShort)+1}v[o]=u}var k,w;for(c=0;c<b.length;c++)w=b[c],w in v&&!isNaN(v[w])&&(k=new Date(s),y[w](k,v[w]),isNaN(k)||(s=k))}return s},formatDate:function(e,i,s){if(!e)return"";"string"==typeof i&&(i=g.parseFormat(i));var n={d:e.getUTCDate(),D:f[s].daysShort[e.getUTCDay()],DD:f[s].days[e.getUTCDay()],m:e.getUTCMonth()+1,M:f[s].monthsShort[e.getUTCMonth()],MM:f[s].months[e.getUTCMonth()],yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear()};n.dd=(n.d<10?"0":"")+n.d,n.mm=(n.m<10?"0":"")+n.m,e=[];for(var r=t.extend([],i.separators),a=0,o=i.parts.length;o>=a;a++)r.length&&e.push(r.shift()),e.push(n[i.parts[a]]);return e.join("")},headTemplate:'<thead><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};g.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+g.headTemplate+"<tbody></tbody>"+g.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+g.headTemplate+g.contTemplate+g.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+g.headTemplate+g.contTemplate+g.footTemplate+"</table></div></div>",t.fn.datepicker.DPGlobal=g,t.fn.datepicker.noConflict=function(){return t.fn.datepicker=d,this},t(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(e){var i=t(this);i.data("datepicker")||(e.preventDefault(),i.datepicker("show"))}),t(function(){t('[data-provide="datepicker-inline"]').datepicker()})}(window.jQuery),function(t){t.fn.datepicker.dates.fr={days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],daysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],daysMin:["D","L","Ma","Me","J","V","S","D"],months:["Janvier","FÃ©vrier","Mars","Avril","Mai","Juin","Juillet","AoÃ»t","Septembre","Octobre","Novembre","DÃ©cembre"],monthsShort:["Jan","FÃ©v","Mar","Avr","Mai","Jui","Jul","Aou","Sep","Oct","Nov","DÃ©c"],today:"Aujourd'hui",clear:"Effacer",weekStart:1,format:"dd/mm/yyyy"}}(jQuery),function(t){function e(){t.ajax({url:Routing.generate("service_civique_approval_show",{approval_number:t("#service_civique_mission_approvalNumber").val()}),beforeSend:function(){n("loading")}}).done(function(t){i(t)}).fail(function(){i(null,!0)})}function i(e,i){n("ok"),t("[data-approval]").each(function(){var n=t(this),r="Information non disponible";if(i||(r=e[n.attr("data-approval")]),"pdf_url"===n.attr("data-approval"))""==r||i||n.html('<div class="btn-box center"><a class="btn-sc-red-2 btn btn-lg" href="'+r+'" title="TÃ©lÃ©charger l\'agrÃ©ment"><i class="icon-download"></i>  TÃ©lÃ©charger l\'agrÃ©ment</a></div>');else if("term_date"===n.attr("data-approval")||"decision_date"===n.attr("data-approval")){if(""!=r&&"Information non disponible"!=r){var a=new Date(r);n.html(s(a.getDate())+"/"+s(a.getMonth()+1)+"/"+a.getFullYear())}}else n.html(r)})}function s(t){return 10>t?"0"+t:t}function n(e){"loading"===e?(t(".agreement-content").hide(),t(".agreement-loader").show()):(t(".agreement-loader").hide(),t(".agreement-content").show())}function r(){var e=t("#service_civique_mission_location_area, #service_civique_mission_location_department"),i=t("#service_civique_mission_location_country");t("#service_civique_mission_is_overseas_1").is(":checked")?(e.removeAttr("disabled").parent().show(),i.attr("disabled","disabled").parent().hide()):(i.removeAttr("disabled").parent().show(),e.attr("disabled","disabled").parent().hide())}function a(){var e=t("#service_civique_mission_organization_new_organization_user_email, #service_civique_mission_organization_new_organization_name"),i=t("#service_civique_mission_organization_organization");t("#service_civique_mission_organization_is_new_organization_1").is(":checked")?(e.removeAttr("disabled").parent().show(),i.attr("disabled","disabled").parent().hide()):(i.removeAttr("disabled").parent().show(),e.attr("disabled","disabled").parent().hide())}function o(){t("#service_civique_mission_approved_choice_1").is(":checked")?(t(".form-group-is_new_organization").show(),t(".form-group-organization-select").hide()):(t(".form-group-is_new_organization").hide(),t(".form-group-organization-select").hide())}a(),t('input[name="service_civique_mission\\[organization\\]\\[is_new_organization\\]"]').on("ifChecked",function(t){a()}),r(),t('input[name="service_civique_mission\\[is_overseas\\]"]').on("ifChecked",function(t){r()}),null!=t("#service_civique_mission_approvalNumber").val()&&e(),t("#service_civique_mission_approvalNumber").on("blur",function(t){e()}),t(".form-group-approved_choice").length&&(t(".form-group-is_new_organization").hide(),t(".form-group-organization-select").hide()),t("#service_civique_mission_approved_choice input").on("ifChecked",function(t){o()}),o()}(jQuery),function(t){function e(t,e,n){var r=t[0],a=/er/.test(n)?_indeterminate:/bl/.test(n)?u:d,o=n==_update?{checked:r[d],disabled:r[u],indeterminate:"true"==t.attr(_indeterminate)||"false"==t.attr(_determinate)}:r[a];if(/^(ch|di|in)/.test(n)&&!o)i(t,a);else if(/^(un|en|de)/.test(n)&&o)s(t,a);else if(n==_update)for(var l in o)o[l]?i(t,l,!0):s(t,l,!0);else e&&"toggle"!=n||(e||t[_callback]("ifClicked"),o?r[_type]!==c&&s(t,a):i(t,a))}function i(e,i,n){var f=e[0],g=e.parent(),m=i==d,v=i==_indeterminate,b=i==u,y=v?_determinate:m?p:"enabled",$=r(e,y+a(f[_type])),_=r(e,i+a(f[_type]));if(!0!==f[i]){if(!n&&i==d&&f[_type]==c&&f.name){var k=e.closest("form"),w='input[name="'+f.name+'"]',w=k.length?k.find(w):t(w);w.each(function(){this!==f&&t(this).data(l)&&s(t(this),i)})}v?(f[i]=!0,f[d]&&s(e,d,"force")):(n||(f[i]=!0),m&&f[_indeterminate]&&s(e,_indeterminate,!1)),o(e,m,i,n)}f[u]&&r(e,_cursor,!0)&&g.find("."+h).css(_cursor,"default"),g[_add](_||r(e,i)||""),g.attr("role")&&!v&&g.attr("aria-"+(b?u:d),"true"),g[_remove]($||r(e,y)||"")}function s(t,e,i){var s=t[0],n=t.parent(),l=e==d,c=e==_indeterminate,f=e==u,g=c?_determinate:l?p:"enabled",m=r(t,g+a(s[_type])),v=r(t,e+a(s[_type]));!1!==s[e]&&((c||!i||"force"==i)&&(s[e]=!1),o(t,l,g,i)),!s[u]&&r(t,_cursor,!0)&&n.find("."+h).css(_cursor,"pointer"),n[_remove](v||r(t,e)||""),n.attr("role")&&!c&&n.attr("aria-"+(f?u:d),"false"),n[_add](m||r(t,g)||"")}function n(e,i){e.data(l)&&(e.parent().html(e.attr("style",e.data(l).s||"")),i&&e[_callback](i),e.off(".i").unwrap(),t(_label+'[for="'+e[0].id+'"]').add(e.closest(_label)).off(".i"))}function r(t,e,i){return t.data(l)?t.data(l).o[e+(i?"":"Class")]:void 0}function a(t){return t.charAt(0).toUpperCase()+t.slice(1)}function o(t,e,i,s){s||(e&&t[_callback]("ifToggled"),t[_callback]("ifChanged")[_callback]("if"+a(i)))}var l="iCheck",h=l+"-helper",c="radio",d="checked",p="un"+d,u="disabled";_determinate="determinate",_indeterminate="in"+_determinate,_update="update",_type="type",_click="click",_touch="touchbegin.i touchend.i",_add="addClass",_remove="removeClass",_callback="trigger",_label="label",_cursor="cursor",_mobile=/ipad|iphone|ipod|android|blackberry|windows phone|opera mini|silk/i.test(navigator.userAgent),t.fn[l]=function(r,a){var o='input[type="checkbox"], input[type="'+c+'"]',p=t(),f=function(e){e.each(function(){var e=t(this);p=e.is(o)?p.add(e):p.add(e.find(o))})};if(/^(check|uncheck|toggle|indeterminate|determinate|disable|enable|update|destroy)$/i.test(r))return r=r.toLowerCase(),f(this),p.each(function(){var i=t(this);"destroy"==r?n(i,"ifDestroyed"):e(i,!0,r),t.isFunction(a)&&a()});if("object"!=typeof r&&r)return this;var g=t.extend({checkedClass:d,disabledClass:u,indeterminateClass:_indeterminate,labelHover:!0},r),m=g.handle,v=g.hoverClass||"hover",b=g.focusClass||"focus",y=g.activeClass||"active",$=!!g.labelHover,_=g.labelHoverClass||"hover",k=0|(""+g.increaseArea).replace("%","");return("checkbox"==m||m==c)&&(o='input[type="'+m+'"]'),-50>k&&(k=-50),f(this),p.each(function(){var r=t(this);n(r);var a=this,o=a.id,p=-k+"%",f=100+2*k+"%",f={position:"absolute",top:p,left:p,display:"block",width:f,height:f,margin:0,padding:0,background:"#fff",border:0,opacity:0},p=_mobile?{position:"absolute",visibility:"hidden"}:k?f:{position:"absolute",opacity:0},m="checkbox"==a[_type]?g.checkboxClass||"icheckbox":g.radioClass||"i"+c,w=t(_label+'[for="'+o+'"]').add(r.closest(_label)),x=!!g.aria,S=l+"-"+Math.random().toString(36).substr(2,6),C='<div class="'+m+'" '+(x?'role="'+a[_type]+'" ':"");x&&w.each(function(){C+='aria-labelledby="',this.id?C+=this.id:(this.id=S,C+=S),C+='"'}),C=r.wrap(C+"/>")[_callback]("ifCreated").parent().append(g.insert),f=t('<ins class="'+h+'"/>').css(f).appendTo(C),r.data(l,{o:g,s:r.attr("style")}).css(p),g.inheritClass&&C[_add](a.className||""),g.inheritID&&o&&C.attr("id",l+"-"+o),"static"==C.css("position")&&C.css("position","relative"),e(r,!0,_update),w.length&&w.on(_click+".i mouseover.i mouseout.i "+_touch,function(i){var s=i[_type],n=t(this);if(!a[u]){if(s==_click){if(t(i.target).is("a"))return;e(r,!1,!0)}else $&&(/ut|nd/.test(s)?(C[_remove](v),n[_remove](_)):(C[_add](v),n[_add](_)));if(!_mobile)return!1;i.stopPropagation()}}),r.on(_click+".i focus.i blur.i keyup.i keydown.i keypress.i",function(t){var e=t[_type];return t=t.keyCode,e==_click?!1:"keydown"==e&&32==t?(a[_type]==c&&a[d]||(a[d]?s(r,d):i(r,d)),!1):void("keyup"==e&&a[_type]==c?!a[d]&&i(r,d):/us|ur/.test(e)&&C["blur"==e?_remove:_add](b))}),f.on(_click+" mousedown mouseup mouseover mouseout "+_touch,function(t){var i=t[_type],s=/wn|up/.test(i)?y:v;if(!a[u]){if(i==_click?e(r,!1,!0):(/wn|er|in/.test(i)?C[_add](s):C[_remove](s+" "+y),w.length&&$&&s==v&&w[/ut|nd/.test(i)?_remove:_add](_)),!_mobile)return!1;t.stopPropagation()}})})}}(window.jQuery||window.Zepto),function(t){var e=t(".city-input"),i=t(".country-input"),s=t(".zipcode-input"),n=t(".area-input"),r=t(".departement-input"),a=function(e,i){var s=e.prop("attributes"),n=[];if(i.length>0)n.push('<select name="'+s.name.value+'" class="'+s["class"].value+'" id="'+s.id.value+'">'),t.each(i,function(t,e){n.push('<option value="'+e.name+'">'+e.name+"</option>")}),n.push("</select>");else{var r=i;n.push('<input type="text" name="'+s.name.value+'" class="'+s["class"].value+'" id="'+s.id.value+'" value="'+r+'" />')}return n=n.join(""),e.replaceWith(n),e=t(e.selector);
};i.on("input",function(){"FR"!=t(this).val()&&(e=a(e,""))}),n.on("change",function(e){var i=t(this).attr("data-departements-datas-url"),s=t(t(this).attr("data-target"));t.getJSON(i,{region:t(this).val()},function(e){var i=[];e=e.sort(function(t,e){return t.name>e.name}),i.push('<option value="">Tous les dÃ©partements</option>'),t.each(e,function(t,e){i.push('<option value="'+e.code+'">'+e.name+"</option>")}),s.html(i)})}),r.on("change",function(e){var i=t(this).attr("data-area-datas-url");t(t(this).attr("data-target"));t.getJSON(i,{departement:t(this).val()},function(t){n.children("option[value="+t+"]").attr("selected","selected")})}),s.on("input",function(){var s=t(this).val();if("FR"==i.val())return 5!=s.length?void(e=a(e,"")):void t.ajax({url:t(this).attr("data-cities-url")+"?zipcode="+s,success:function(t){e=a(e,t)},error:function(){}})})}(jQuery),function(t){function e(){t.ajax({url:Routing.generate("service_civique_approval_show",{approval_number:t("#service_civique_mission_admin_approvalNumber").val()}),beforeSend:function(){s("loading")}}).done(function(t){i(t)}).fail(function(){i(null,!0)})}function i(e,i){s("ok"),t("[data-approval]").each(function(){var s=t(this),n="Information non disponible";i||(n=e[s.attr("data-approval")]),"pdf_url"===s.attr("data-approval")?""==n||i||s.html('<div class="btn-box center"><a class="btn-sc-red-2 btn btn-lg" href="'+n+'" title="TÃ©lÃ©charger l\'agrÃ©ment"><i class="icon-download"></i>  TÃ©lÃ©charger l\'agrÃ©ment</a></div>'):s.html(n)})}function s(e){"loading"===e?(t(".agreement-content").hide(),t(".agreement-loader").show()):(t(".agreement-loader").hide(),t(".agreement-content").show())}function n(e){var i=l+" - "+e.title,s=e.text+"\n\n---\n"+l+"\n"+h,n="mailto:"+c+"?subject="+encodeURIComponent(i)+"&body="+encodeURIComponent(s);t(".mailto-link").attr("href",n)}var r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:Routing.generate("service_civique_backend_static_content_list_autocomplete"),filter:function(e){return t.map(e,function(t){return t})}}});r.initialize(),t("input").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal",increaseArea:"20%"}),t(".form-group-route .typeahead").typeahead(null,{name:"routes",displayKey:"url",source:r.ttAdapter(),templates:{empty:['<div class="empty-message">',"</div>"].join("\n"),suggestion:Handlebars.compile("<p><strong>{{title}}</strong> â {{url}}</p>")}}),t(".wysiwyg").redactor({lang:"fr",imageUpload:Routing.generate("service_civique_backend_upload_image"),imageGetJson:Routing.generate("service_civique_backend_get_image"),fileUpload:Routing.generate("service_civique_backend_upload_file"),plugins:["fontcolor"],buttons:["html","formatting","bold","italic","deleted","underline","justify","unorderedlist","orderedlist","outdent","indent","image","video","file","table","link","alignment","horizontalrule","fontcolor","backcolor"]}),t(".sortable").sortable({appendTo:document.body,cursor:"move",update:function(e,i){var s=[];t("table tbody tr").each(function(){t(this).attr("data-position",t(this).index()),s.push({id:t(this).attr("data-id"),position:t(this).attr("data-position")})}),t.ajax({type:"POST",url:Routing.generate("service_civique_backend_menu_item_update_position"),data:{data:s}}).done(function(){})}}),null!=t("#service_civique_mission_admin_approvalNumber").val()&&e(),t("#service_civique_mission_admin_approvalNumber").on("blur",function(t){e()});var a=function(){var e="open",i=function(t,i,s){"true"==t.attr("aria-expanded")?(t.addClass(e),i.addClass(e).removeClass("sr-only"),s?i.slideDown():i.show()):(t.removeClass(e),s?i.removeClass(e).slideUp():i.hide().removeClass("sr-only"))},s=function(t,e){var s="true"===t.attr("aria-expanded")?"false":"true",n="undefined"==typeof t.attr("data-animated")||"true"===t.attr("data-animated");t.attr("aria-expanded",s),i(t,e,n)};t("a[aria-expanded]").each(function(){var e=t(this),s=t("#"+e.attr("aria-controls"));i(e,s,!1)}).on("click",function(e){var i=t(this),n=t("#"+i.attr("aria-controls"));s(i,n),e.preventDefault()})};if(a(),t("#service_civique_mission_answer_mail_answer_mail")){var o=t("#mailto-vars"),l=o.attr("data-missiontTitle"),h=o.attr("data-missiontUrl"),c=o.attr("data-mailtoContacts");t("#service_civique_mission_answer_mail_answer_mail").change(function(){""!=t(this).val()&&t.ajax({type:"GET",url:Routing.generate("service_civique_backend_answer_mail_get_description",{id:t(this).val()})}).done(function(t){n(t)})})}var d=function(){if(Modernizr.inputtypes.date)t(".input-group.date .input-group-addon").hide().parent().removeClass("input-group");else{var e=t(".input-group.date"),i=e.children("input");i.val(i.attr("data-formatted")),e.datepicker({autoclose:!0,format:"dd/mm/yyyy",language:"fr"})}};d(),t("#delete-pin").on("click",function(){$this=t(this),t.ajax({type:"POST",url:Routing.generate("service_civique_backend_header_delete_pin",{id:$this.attr("data-id")})}).done(function(){$this.parent(".imageWrapper").children("img").hide()})}),t(".paginate-url").change(function(e){t(this.form).submit()});var p=[];t('input[name="mass_update_mission"]').on("ifChecked",function(){p.push(t(this).val())}),t('input[name="mass_update_mission"]').on("ifUnchecked",function(){var e=p.indexOf(t(this).val());e>-1&&p.splice(e,1)}),t(".select-all-checkbox-mass-update").on("ifChecked",function(){t("input[type=checkbox].mass-update-mission-checkbox").each(function(){t(this).iCheck("check"),p.push(t(this).val())})}),t(".select-all-checkbox-mass-update").on("ifUnchecked",function(){t("input[type=checkbox].mass-update-mission-checkbox").each(function(){t(this).iCheck("uncheck");var e=p.indexOf(t(this).val());e>-1&&p.splice(e,1)})}),t(".mass-update-btn").on("click",function(){var e=t(".mass-update-btn").attr("data-base-mass-update-url");t.ajax({type:"GET",url:e,data:{missions:p.toString()}}).done(function(){location.reload()})})}(jQuery);